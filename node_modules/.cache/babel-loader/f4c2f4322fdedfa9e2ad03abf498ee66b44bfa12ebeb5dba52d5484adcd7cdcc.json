{"ast":null,"code":"//\nimport { ConstantsUtil, SafeLocalStorage, SafeLocalStorageKeys } from '@reown/appkit-common';\nimport { ApiController } from '../../controllers/ApiController.js';\nimport { BlockchainApiController } from '../../controllers/BlockchainApiController.js';\nimport { ChainController } from '../../controllers/ChainController.js';\nimport { getActiveCaipNetwork } from '../../utils/ChainControllerUtil.js';\nimport { ReownAuthenticationMessenger } from './ReownAuthenticationMessenger.js';\n/**\n * This is the configuration for using SIWX with Reown Authentication service.\n * It allows you to authenticate and capture user sessions through the Cloud Dashboard.\n */\nexport class ReownAuthentication {\n  constructor() {\n    var _params$required;\n    let params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.otpUuid = null;\n    this.listeners = {\n      sessionChanged: []\n    };\n    this.localAuthStorageKey = params.localAuthStorageKey || SafeLocalStorageKeys.SIWX_AUTH_TOKEN;\n    this.localNonceStorageKey = params.localNonceStorageKey || SafeLocalStorageKeys.SIWX_NONCE_TOKEN;\n    this.required = (_params$required = params.required) !== null && _params$required !== void 0 ? _params$required : true;\n    this.messenger = new ReownAuthenticationMessenger({\n      getNonce: this.getNonce.bind(this)\n    });\n  }\n  async createMessage(input) {\n    return this.messenger.createMessage(input);\n  }\n  async addSession(session) {\n    const response = await this.request({\n      method: 'POST',\n      key: 'authenticate',\n      body: {\n        data: session.data,\n        message: session.message,\n        signature: session.signature,\n        clientId: this.getClientId(),\n        walletInfo: this.getWalletInfo()\n      },\n      headers: ['nonce', 'otp']\n    });\n    this.setStorageToken(response.token, this.localAuthStorageKey);\n    this.emit('sessionChanged', session);\n    this.setAppKitAccountUser(jwtDecode(response.token));\n    this.otpUuid = null;\n  }\n  async getSessions(chainId, address) {\n    try {\n      if (!this.getStorageToken(this.localAuthStorageKey)) {\n        return [];\n      }\n      const account = await this.request({\n        method: 'GET',\n        key: 'me',\n        query: {},\n        headers: ['auth']\n      });\n      if (!account) {\n        return [];\n      }\n      const isSameAddress = account.address.toLowerCase() === address.toLowerCase();\n      const isSameNetwork = account.caip2Network === chainId;\n      if (!isSameAddress || !isSameNetwork) {\n        return [];\n      }\n      const session = {\n        data: {\n          accountAddress: account.address,\n          chainId: account.caip2Network\n        },\n        message: '',\n        signature: ''\n      };\n      this.emit('sessionChanged', session);\n      this.setAppKitAccountUser(account);\n      return [session];\n    } catch (_unused) {\n      return [];\n    }\n  }\n  async revokeSession(_chainId, _address) {\n    return Promise.resolve(this.clearStorageTokens());\n  }\n  async setSessions(sessions) {\n    if (sessions.length === 0) {\n      this.clearStorageTokens();\n    } else {\n      const session = sessions.find(s => {\n        var _getActiveCaipNetwork;\n        return s.data.chainId === ((_getActiveCaipNetwork = getActiveCaipNetwork()) === null || _getActiveCaipNetwork === void 0 ? void 0 : _getActiveCaipNetwork.caipNetworkId);\n      }) || sessions[0];\n      await this.addSession(session);\n    }\n  }\n  getRequired() {\n    return this.required;\n  }\n  async getSessionAccount() {\n    if (!this.getStorageToken(this.localAuthStorageKey)) {\n      throw new Error('Not authenticated');\n    }\n    return this.request({\n      method: 'GET',\n      key: 'me',\n      body: undefined,\n      query: {\n        includeAppKitAccount: true\n      },\n      headers: ['auth']\n    });\n  }\n  async setSessionAccountMetadata() {\n    let metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    if (!this.getStorageToken(this.localAuthStorageKey)) {\n      throw new Error('Not authenticated');\n    }\n    return this.request({\n      method: 'PUT',\n      key: 'account-metadata',\n      body: {\n        metadata\n      },\n      headers: ['auth']\n    });\n  }\n  on(event, callback) {\n    this.listeners[event].push(callback);\n    return () => {\n      this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);\n    };\n  }\n  removeAllListeners() {\n    const keys = Object.keys(this.listeners);\n    keys.forEach(key => {\n      this.listeners[key] = [];\n    });\n  }\n  async requestEmailOtp(_ref) {\n    let {\n      email,\n      account\n    } = _ref;\n    const otp = await this.request({\n      method: 'POST',\n      key: 'otp',\n      body: {\n        email,\n        account\n      }\n    });\n    this.otpUuid = otp.uuid;\n    this.messenger.resources = [\"email:\".concat(email)];\n    return otp;\n  }\n  confirmEmailOtp(_ref2) {\n    let {\n      code\n    } = _ref2;\n    return this.request({\n      method: 'PUT',\n      key: 'otp',\n      body: {\n        code\n      },\n      headers: ['otp']\n    });\n  }\n  async request(_ref3) {\n    var _response$headers$get;\n    let {\n      method,\n      key,\n      query,\n      body,\n      headers\n    } = _ref3;\n    const {\n      projectId,\n      st,\n      sv\n    } = this.getSDKProperties();\n    const url = new URL(\"\".concat(ConstantsUtil.W3M_API_URL, \"/auth/v1/\").concat(String(key)));\n    url.searchParams.set('projectId', projectId);\n    url.searchParams.set('st', st);\n    url.searchParams.set('sv', sv);\n    if (query) {\n      Object.entries(query).forEach(_ref4 => {\n        let [queryKey, queryValue] = _ref4;\n        return url.searchParams.set(queryKey, String(queryValue));\n      });\n    }\n    const response = await fetch(url, {\n      method,\n      body: body ? JSON.stringify(body) : undefined,\n      headers: Array.isArray(headers) ? headers.reduce((acc, header) => {\n        switch (header) {\n          case 'nonce':\n            acc['x-nonce-jwt'] = \"Bearer \".concat(this.getStorageToken(this.localNonceStorageKey));\n            break;\n          case 'auth':\n            acc['Authorization'] = \"Bearer \".concat(this.getStorageToken(this.localAuthStorageKey));\n            break;\n          case 'otp':\n            if (this.otpUuid) {\n              acc['x-otp'] = this.otpUuid;\n            }\n            break;\n          default:\n            break;\n        }\n        return acc;\n      }, {}) : undefined\n    });\n    if (!response.ok) {\n      throw new Error(await response.text());\n    }\n    if ((_response$headers$get = response.headers.get('content-type')) !== null && _response$headers$get !== void 0 && _response$headers$get.includes('application/json')) {\n      return response.json();\n    }\n    return null;\n  }\n  getStorageToken(key) {\n    return SafeLocalStorage.getItem(key);\n  }\n  setStorageToken(token, key) {\n    SafeLocalStorage.setItem(key, token);\n  }\n  clearStorageTokens() {\n    this.otpUuid = null;\n    SafeLocalStorage.removeItem(this.localAuthStorageKey);\n    SafeLocalStorage.removeItem(this.localNonceStorageKey);\n    this.emit('sessionChanged', undefined);\n  }\n  async getNonce() {\n    const {\n      nonce,\n      token\n    } = await this.request({\n      method: 'GET',\n      key: 'nonce'\n    });\n    this.setStorageToken(token, this.localNonceStorageKey);\n    return nonce;\n  }\n  getClientId() {\n    return BlockchainApiController.state.clientId;\n  }\n  getWalletInfo() {\n    var _ChainController$getA;\n    const walletInfo = (_ChainController$getA = ChainController.getAccountData()) === null || _ChainController$getA === void 0 ? void 0 : _ChainController$getA.connectedWalletInfo;\n    if (!walletInfo) {\n      return undefined;\n    }\n    if ('social' in walletInfo && 'identifier' in walletInfo) {\n      const social = walletInfo['social'];\n      const identifier = walletInfo['identifier'];\n      return {\n        type: 'social',\n        social,\n        identifier\n      };\n    }\n    const {\n      name,\n      icon\n    } = walletInfo;\n    let type = 'unknown';\n    switch (walletInfo.type) {\n      case 'EXTERNAL':\n      case 'INJECTED':\n      case 'ANNOUNCED':\n        type = 'extension';\n        break;\n      case 'WALLET_CONNECT':\n        type = 'walletconnect';\n        break;\n      default:\n        type = 'unknown';\n    }\n    return {\n      type,\n      name,\n      icon\n    };\n  }\n  getSDKProperties() {\n    return ApiController._getSdkProperties();\n  }\n  emit(event, data) {\n    this.listeners[event].forEach(listener => listener(data));\n  }\n  setAppKitAccountUser(session) {\n    const {\n      email\n    } = session;\n    if (email) {\n      Object.values(ConstantsUtil.CHAIN).forEach(chainNamespace => {\n        ChainController.setAccountProp('user', {\n          email\n        }, chainNamespace);\n      });\n    }\n  }\n}\n/**\n * Decodes a JWT token and returns its payload\n * @param token - The JWT token to decode\n * @returns The decoded payload or null if invalid\n */\nfunction jwtDecode(token) {\n  // Split the token into parts\n  const parts = token.split('.');\n  // Check if the token has the correct format (header.payload.signature)\n  if (parts.length !== 3) {\n    throw new Error('Invalid token');\n  }\n  // Decode the payload (second part)\n  const payload = parts[1];\n  if (typeof payload !== 'string') {\n    throw new Error('Invalid token');\n  }\n  // Convert base64url to base64\n  const base64 = payload.replace(/-/g, '+').replace(/_/g, '/');\n  // Add padding if needed\n  const padded = base64.padEnd(base64.length + (4 - base64.length % 4) % 4, '=');\n  // Decode and parse the JSON\n  const decoded = JSON.parse(atob(padded));\n  return decoded;\n}","map":{"version":3,"names":["ConstantsUtil","SafeLocalStorage","SafeLocalStorageKeys","ApiController","BlockchainApiController","ChainController","getActiveCaipNetwork","ReownAuthenticationMessenger","ReownAuthentication","constructor","_params$required","params","arguments","length","undefined","otpUuid","listeners","sessionChanged","localAuthStorageKey","SIWX_AUTH_TOKEN","localNonceStorageKey","SIWX_NONCE_TOKEN","required","messenger","getNonce","bind","createMessage","input","addSession","session","response","request","method","key","body","data","message","signature","clientId","getClientId","walletInfo","getWalletInfo","headers","setStorageToken","token","emit","setAppKitAccountUser","jwtDecode","getSessions","chainId","address","getStorageToken","account","query","isSameAddress","toLowerCase","isSameNetwork","caip2Network","accountAddress","_unused","revokeSession","_chainId","_address","Promise","resolve","clearStorageTokens","setSessions","sessions","find","s","_getActiveCaipNetwork","caipNetworkId","getRequired","getSessionAccount","Error","includeAppKitAccount","setSessionAccountMetadata","metadata","on","event","callback","push","filter","cb","removeAllListeners","keys","Object","forEach","requestEmailOtp","_ref","email","otp","uuid","resources","concat","confirmEmailOtp","_ref2","code","_ref3","_response$headers$get","projectId","st","sv","getSDKProperties","url","URL","W3M_API_URL","String","searchParams","set","entries","_ref4","queryKey","queryValue","fetch","JSON","stringify","Array","isArray","reduce","acc","header","ok","text","get","includes","json","getItem","setItem","removeItem","nonce","state","_ChainController$getA","getAccountData","connectedWalletInfo","social","identifier","type","name","icon","_getSdkProperties","listener","values","CHAIN","chainNamespace","setAccountProp","parts","split","payload","base64","replace","padded","padEnd","decoded","parse","atob"],"sources":["../../../../../src/features/reown-authentication/ReownAuthentication.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}