{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport '@reown/appkit-common';\nimport { EnsUtil } from '../utils/EnsUtil.js';\nimport { StorageUtil } from '../utils/StorageUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectionController } from './ConnectionController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { RouterController } from './RouterController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  suggestions: [],\n  loading: false\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  async resolveName(name) {\n    try {\n      return await BlockchainApiController.lookupEnsName(name);\n    } catch (e) {\n      var _error$reasons;\n      const error = e;\n      throw new Error((error === null || error === void 0 || (_error$reasons = error.reasons) === null || _error$reasons === void 0 || (_error$reasons = _error$reasons[0]) === null || _error$reasons === void 0 ? void 0 : _error$reasons.description) || 'Error resolving name');\n    }\n  },\n  async isNameRegistered(name) {\n    try {\n      await BlockchainApiController.lookupEnsName(name);\n      return true;\n    } catch (_unused) {\n      return false;\n    }\n  },\n  async getSuggestions(value) {\n    try {\n      state.loading = true;\n      state.suggestions = [];\n      const response = await BlockchainApiController.getEnsNameSuggestions(value);\n      state.suggestions = response.suggestions || [];\n      return state.suggestions;\n    } catch (e) {\n      const errorMessage = EnsController.parseEnsApiError(e, 'Error fetching name suggestions');\n      throw new Error(errorMessage);\n    } finally {\n      state.loading = false;\n    }\n  },\n  async getNamesForAddress(address) {\n    try {\n      const network = ChainController.state.activeCaipNetwork;\n      if (!network) {\n        return [];\n      }\n      const cachedEns = StorageUtil.getEnsFromCacheForAddress(address);\n      if (cachedEns) {\n        return cachedEns;\n      }\n      const response = await BlockchainApiController.reverseLookupEnsName({\n        address\n      });\n      StorageUtil.updateEnsCache({\n        address,\n        ens: response,\n        timestamp: Date.now()\n      });\n      return response;\n    } catch (e) {\n      const errorMessage = EnsController.parseEnsApiError(e, 'Error fetching names for address');\n      throw new Error(errorMessage);\n    }\n  },\n  async registerName(name) {\n    var _ChainController$getA;\n    const network = ChainController.state.activeCaipNetwork;\n    const address = (_ChainController$getA = ChainController.getAccountData(network === null || network === void 0 ? void 0 : network.chainNamespace)) === null || _ChainController$getA === void 0 ? void 0 : _ChainController$getA.address;\n    const emailConnector = ConnectorController.getAuthConnector();\n    if (!network) {\n      throw new Error('Network not found');\n    }\n    if (!address || !emailConnector) {\n      throw new Error('Address or auth connector not found');\n    }\n    state.loading = true;\n    try {\n      const message = JSON.stringify({\n        name,\n        attributes: {},\n        // Unix timestamp\n        timestamp: Math.floor(Date.now() / 1000)\n      });\n      RouterController.pushTransactionStack({\n        onCancel() {\n          RouterController.replace('RegisterAccountName');\n        }\n      });\n      const signature = await ConnectionController.signMessage(message);\n      state.loading = false;\n      const networkId = network.id;\n      if (!networkId) {\n        throw new Error('Network not found');\n      }\n      const coinType = EnsUtil.convertEVMChainIdToCoinType(Number(networkId));\n      await BlockchainApiController.registerEnsName({\n        coinType,\n        address: address,\n        signature: signature,\n        message\n      });\n      ChainController.setAccountProp('profileName', name, network.chainNamespace);\n      StorageUtil.updateEnsCache({\n        address,\n        ens: [{\n          name,\n          registered_at: new Date().toISOString(),\n          updated_at: undefined,\n          addresses: {},\n          attributes: []\n        }],\n        timestamp: Date.now()\n      });\n      RouterController.replace('RegisterAccountNameSuccess');\n    } catch (e) {\n      const errorMessage = EnsController.parseEnsApiError(e, \"Error registering name \".concat(name));\n      RouterController.replace('RegisterAccountName');\n      throw new Error(errorMessage);\n    } finally {\n      state.loading = false;\n    }\n  },\n  validateName(name) {\n    return /^[\\x2D0-9A-Za-z]{4,}$/.test(name);\n  },\n  parseEnsApiError(error, defaultError) {\n    var _ensError$reasons;\n    const ensError = error;\n    return (ensError === null || ensError === void 0 || (_ensError$reasons = ensError.reasons) === null || _ensError$reasons === void 0 || (_ensError$reasons = _ensError$reasons[0]) === null || _ensError$reasons === void 0 ? void 0 : _ensError$reasons.description) || defaultError;\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const EnsController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","EnsUtil","StorageUtil","withErrorBoundary","BlockchainApiController","ChainController","ConnectionController","ConnectorController","RouterController","state","suggestions","loading","controller","callback","key","resolveName","name","lookupEnsName","e","_error$reasons","error","Error","reasons","description","isNameRegistered","_unused","getSuggestions","value","response","getEnsNameSuggestions","errorMessage","EnsController","parseEnsApiError","getNamesForAddress","address","network","activeCaipNetwork","cachedEns","getEnsFromCacheForAddress","reverseLookupEnsName","updateEnsCache","ens","timestamp","Date","now","registerName","_ChainController$getA","getAccountData","chainNamespace","emailConnector","getAuthConnector","message","JSON","stringify","attributes","Math","floor","pushTransactionStack","onCancel","replace","signature","signMessage","networkId","id","coinType","convertEVMChainIdToCoinType","Number","registerEnsName","setAccountProp","registered_at","toISOString","updated_at","undefined","addresses","concat","validateName","test","defaultError","_ensError$reasons","ensError"],"sources":["../../../../src/controllers/EnsController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}