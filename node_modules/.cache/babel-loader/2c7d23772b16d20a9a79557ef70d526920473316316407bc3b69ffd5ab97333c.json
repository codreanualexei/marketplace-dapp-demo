{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { NumberUtil } from '@reown/appkit-common';\nimport { ConstantsUtil as CommonConstantsUtil } from '@reown/appkit-common';\nimport { W3mFrameRpcConstants } from '@reown/appkit-wallet/utils';\nimport { BalanceUtil } from '../utils/BalanceUtil.js';\nimport { getActiveNetworkTokenAddress, getPreferredAccountType } from '../utils/ChainControllerUtil.js';\nimport { ConstantsUtil } from '../utils/ConstantsUtil.js';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { SwapApiUtil } from '../utils/SwapApiUtil.js';\nimport { SwapCalculationUtil } from '../utils/SwapCalculationUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { AlertController } from './AlertController.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectionController } from './ConnectionController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { EventsController } from './EventsController.js';\nimport { RouterController } from './RouterController.js';\nimport { SnackController } from './SnackController.js';\n// -- Constants ---------------------------------------- //\nexport const INITIAL_GAS_LIMIT = 150000;\nexport const TO_AMOUNT_DECIMALS = 6;\nclass TransactionError extends Error {\n  constructor(message, displayMessage) {\n    super(message);\n    this.name = 'TransactionError';\n    this.displayMessage = displayMessage;\n  }\n}\n// -- State --------------------------------------------- //\nconst initialState = {\n  // Loading states\n  initializing: false,\n  initialized: false,\n  loadingPrices: false,\n  loadingQuote: false,\n  loadingApprovalTransaction: false,\n  loadingBuildTransaction: false,\n  loadingTransaction: false,\n  // Control states\n  switchingTokens: false,\n  // Error states\n  fetchError: false,\n  // Approval & Swap transaction states\n  approvalTransaction: undefined,\n  swapTransaction: undefined,\n  transactionError: undefined,\n  // Input values\n  sourceToken: undefined,\n  sourceTokenAmount: '',\n  sourceTokenPriceInUSD: 0,\n  toToken: undefined,\n  toTokenAmount: '',\n  toTokenPriceInUSD: 0,\n  networkPrice: '0',\n  networkBalanceInUSD: '0',\n  networkTokenSymbol: '',\n  inputError: undefined,\n  // Request values\n  slippage: ConstantsUtil.CONVERT_SLIPPAGE_TOLERANCE,\n  // Tokens\n  tokens: undefined,\n  popularTokens: undefined,\n  suggestedTokens: undefined,\n  foundTokens: undefined,\n  myTokensWithBalance: undefined,\n  tokensPriceMap: {},\n  // Calculations\n  gasFee: '0',\n  gasPriceInUSD: 0,\n  priceImpact: undefined,\n  maxSlippage: undefined,\n  providerFee: undefined\n};\nconst state = proxy({\n  ...initialState\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  getParams() {\n    const namespace = ChainController.state.activeChain;\n    const caipAddress = ChainController.getAccountData(namespace)?.caipAddress ?? ChainController.state.activeCaipAddress;\n    const address = CoreHelperUtil.getPlainAddress(caipAddress);\n    const networkAddress = getActiveNetworkTokenAddress();\n    const connectorId = ConnectorController.getConnectorId(ChainController.state.activeChain);\n    if (!address) {\n      throw new Error('No address found to swap the tokens from.');\n    }\n    const invalidToToken = !state.toToken?.address || !state.toToken?.decimals;\n    const invalidSourceToken = !state.sourceToken?.address || !state.sourceToken?.decimals || !NumberUtil.bigNumber(state.sourceTokenAmount).gt(0);\n    const invalidSourceTokenAmount = !state.sourceTokenAmount;\n    return {\n      networkAddress,\n      fromAddress: address,\n      fromCaipAddress: caipAddress,\n      sourceTokenAddress: state.sourceToken?.address,\n      toTokenAddress: state.toToken?.address,\n      toTokenAmount: state.toTokenAmount,\n      toTokenDecimals: state.toToken?.decimals,\n      sourceTokenAmount: state.sourceTokenAmount,\n      sourceTokenDecimals: state.sourceToken?.decimals,\n      invalidToToken,\n      invalidSourceToken,\n      invalidSourceTokenAmount,\n      availableToSwap: caipAddress && !invalidToToken && !invalidSourceToken && !invalidSourceTokenAmount,\n      isAuthConnector: connectorId === CommonConstantsUtil.CONNECTOR_ID.AUTH\n    };\n  },\n  async setSourceToken(sourceToken) {\n    if (!sourceToken) {\n      state.sourceToken = sourceToken;\n      state.sourceTokenAmount = '';\n      state.sourceTokenPriceInUSD = 0;\n      return;\n    }\n    state.sourceToken = sourceToken;\n    await SwapController.setTokenPrice(sourceToken.address, 'sourceToken');\n  },\n  setSourceTokenAmount(amount) {\n    state.sourceTokenAmount = amount;\n  },\n  async setToToken(toToken) {\n    if (!toToken) {\n      state.toToken = toToken;\n      state.toTokenAmount = '';\n      state.toTokenPriceInUSD = 0;\n      return;\n    }\n    state.toToken = toToken;\n    await SwapController.setTokenPrice(toToken.address, 'toToken');\n  },\n  setToTokenAmount(amount) {\n    state.toTokenAmount = amount ? NumberUtil.toFixed(amount, TO_AMOUNT_DECIMALS) : '';\n  },\n  async setTokenPrice(address, target) {\n    let price = state.tokensPriceMap[address] || 0;\n    if (!price) {\n      state.loadingPrices = true;\n      price = await SwapController.getAddressPrice(address);\n    }\n    if (target === 'sourceToken') {\n      state.sourceTokenPriceInUSD = price;\n    } else if (target === 'toToken') {\n      state.toTokenPriceInUSD = price;\n    }\n    if (state.loadingPrices) {\n      state.loadingPrices = false;\n    }\n    if (SwapController.getParams().availableToSwap && !state.switchingTokens) {\n      SwapController.swapTokens();\n    }\n  },\n  async switchTokens() {\n    if (state.initializing || !state.initialized || state.switchingTokens) {\n      return;\n    }\n    state.switchingTokens = true;\n    try {\n      const newSourceToken = state.toToken ? {\n        ...state.toToken\n      } : undefined;\n      const newToToken = state.sourceToken ? {\n        ...state.sourceToken\n      } : undefined;\n      const newSourceTokenAmount = newSourceToken && state.toTokenAmount === '' ? '1' : state.toTokenAmount;\n      SwapController.setSourceTokenAmount(newSourceTokenAmount);\n      SwapController.setToTokenAmount('');\n      await SwapController.setSourceToken(newSourceToken);\n      await SwapController.setToToken(newToToken);\n      state.switchingTokens = false;\n      SwapController.swapTokens();\n    } catch (error) {\n      state.switchingTokens = false;\n      throw error;\n    }\n  },\n  resetState() {\n    state.myTokensWithBalance = initialState.myTokensWithBalance;\n    state.tokensPriceMap = initialState.tokensPriceMap;\n    state.initialized = initialState.initialized;\n    state.initializing = initialState.initializing;\n    state.switchingTokens = initialState.switchingTokens;\n    state.sourceToken = initialState.sourceToken;\n    state.sourceTokenAmount = initialState.sourceTokenAmount;\n    state.sourceTokenPriceInUSD = initialState.sourceTokenPriceInUSD;\n    state.toToken = initialState.toToken;\n    state.toTokenAmount = initialState.toTokenAmount;\n    state.toTokenPriceInUSD = initialState.toTokenPriceInUSD;\n    state.networkPrice = initialState.networkPrice;\n    state.networkTokenSymbol = initialState.networkTokenSymbol;\n    state.networkBalanceInUSD = initialState.networkBalanceInUSD;\n    state.inputError = initialState.inputError;\n  },\n  resetValues() {\n    const {\n      networkAddress\n    } = SwapController.getParams();\n    const networkToken = state.tokens?.find(token => token.address === networkAddress);\n    SwapController.setSourceToken(networkToken);\n    SwapController.setToToken(undefined);\n  },\n  getApprovalLoadingState() {\n    return state.loadingApprovalTransaction;\n  },\n  clearError() {\n    state.transactionError = undefined;\n  },\n  async initializeState() {\n    if (state.initializing) {\n      return;\n    }\n    state.initializing = true;\n    if (!state.initialized) {\n      try {\n        await SwapController.fetchTokens();\n        state.initialized = true;\n      } catch (error) {\n        state.initialized = false;\n        SnackController.showError('Failed to initialize swap');\n        RouterController.goBack();\n      }\n    }\n    state.initializing = false;\n  },\n  async fetchTokens() {\n    const {\n      networkAddress\n    } = SwapController.getParams();\n    await SwapController.getNetworkTokenPrice();\n    await SwapController.getMyTokensWithBalance();\n    const networkToken = state.myTokensWithBalance?.find(token => token.address === networkAddress);\n    if (networkToken) {\n      state.networkTokenSymbol = networkToken.symbol;\n      SwapController.setSourceToken(networkToken);\n      SwapController.setSourceTokenAmount('0');\n    }\n  },\n  async getTokenList() {\n    const activeCaipNetworkId = ChainController.state.activeCaipNetwork?.caipNetworkId;\n    if (state.caipNetworkId === activeCaipNetworkId && state.tokens) {\n      return;\n    }\n    try {\n      state.tokensLoading = true;\n      const tokens = await SwapApiUtil.getTokenList(activeCaipNetworkId);\n      state.tokens = tokens;\n      state.caipNetworkId = activeCaipNetworkId;\n      state.popularTokens = tokens.sort((aTokenInfo, bTokenInfo) => {\n        if (aTokenInfo.symbol < bTokenInfo.symbol) {\n          return -1;\n        }\n        if (aTokenInfo.symbol > bTokenInfo.symbol) {\n          return 1;\n        }\n        return 0;\n      });\n      state.suggestedTokens = tokens.filter(token => {\n        if (ConstantsUtil.SWAP_SUGGESTED_TOKENS.includes(token.symbol)) {\n          return true;\n        }\n        return false;\n      });\n    } catch (error) {\n      state.tokens = [];\n      state.popularTokens = [];\n      state.suggestedTokens = [];\n    } finally {\n      state.tokensLoading = false;\n    }\n  },\n  async getAddressPrice(address) {\n    const existPrice = state.tokensPriceMap[address];\n    if (existPrice) {\n      return existPrice;\n    }\n    const response = await BlockchainApiController.fetchTokenPrice({\n      addresses: [address]\n    });\n    const fungibles = response?.fungibles || [];\n    const allTokens = [...(state.tokens || []), ...(state.myTokensWithBalance || [])];\n    const symbol = allTokens?.find(token => token.address === address)?.symbol;\n    const price = fungibles.find(p => p.symbol.toLowerCase() === symbol?.toLowerCase())?.price || 0;\n    const priceAsFloat = parseFloat(price.toString());\n    state.tokensPriceMap[address] = priceAsFloat;\n    return priceAsFloat;\n  },\n  async getNetworkTokenPrice() {\n    const {\n      networkAddress\n    } = SwapController.getParams();\n    const response = await BlockchainApiController.fetchTokenPrice({\n      addresses: [networkAddress]\n    }).catch(() => {\n      SnackController.showError('Failed to fetch network token price');\n      return {\n        fungibles: []\n      };\n    });\n    const token = response.fungibles?.[0];\n    const price = token?.price.toString() || '0';\n    state.tokensPriceMap[networkAddress] = parseFloat(price);\n    state.networkTokenSymbol = token?.symbol || '';\n    state.networkPrice = price;\n  },\n  async getMyTokensWithBalance(forceUpdate) {\n    const balances = await BalanceUtil.getMyTokensWithBalance(forceUpdate);\n    const swapBalances = SwapApiUtil.mapBalancesToSwapTokens(balances);\n    if (!swapBalances) {\n      return;\n    }\n    await SwapController.getInitialGasPrice();\n    SwapController.setBalances(swapBalances);\n  },\n  setBalances(balances) {\n    const {\n      networkAddress\n    } = SwapController.getParams();\n    const caipNetwork = ChainController.state.activeCaipNetwork;\n    if (!caipNetwork) {\n      return;\n    }\n    const networkToken = balances.find(token => token.address === networkAddress);\n    balances.forEach(token => {\n      state.tokensPriceMap[token.address] = token.price || 0;\n    });\n    state.myTokensWithBalance = balances.filter(token => token.address.startsWith(caipNetwork.caipNetworkId));\n    state.networkBalanceInUSD = networkToken ? NumberUtil.multiply(networkToken.quantity.numeric, networkToken.price).toString() : '0';\n  },\n  async getInitialGasPrice() {\n    const res = await SwapApiUtil.fetchGasPrice();\n    if (!res) {\n      return {\n        gasPrice: null,\n        gasPriceInUSD: null\n      };\n    }\n    switch (ChainController.state?.activeCaipNetwork?.chainNamespace) {\n      case CommonConstantsUtil.CHAIN.SOLANA:\n        state.gasFee = res.standard ?? '0';\n        state.gasPriceInUSD = NumberUtil.multiply(res.standard, state.networkPrice).div(1e9).toNumber();\n        return {\n          gasPrice: BigInt(state.gasFee),\n          gasPriceInUSD: Number(state.gasPriceInUSD)\n        };\n      case CommonConstantsUtil.CHAIN.EVM:\n      default:\n        // eslint-disable-next-line no-case-declarations\n        const value = res.standard ?? '0';\n        // eslint-disable-next-line no-case-declarations\n        const gasFee = BigInt(value);\n        // eslint-disable-next-line no-case-declarations\n        const gasLimit = BigInt(INITIAL_GAS_LIMIT);\n        // eslint-disable-next-line no-case-declarations\n        const gasPrice = SwapCalculationUtil.getGasPriceInUSD(state.networkPrice, gasLimit, gasFee);\n        state.gasFee = value;\n        state.gasPriceInUSD = gasPrice;\n        return {\n          gasPrice: gasFee,\n          gasPriceInUSD: gasPrice\n        };\n    }\n  },\n  // -- Swap -------------------------------------- //\n  async swapTokens() {\n    const address = ChainController.getAccountData()?.address;\n    const sourceToken = state.sourceToken;\n    const toToken = state.toToken;\n    const haveSourceTokenAmount = NumberUtil.bigNumber(state.sourceTokenAmount).gt(0);\n    if (!haveSourceTokenAmount) {\n      SwapController.setToTokenAmount('');\n    }\n    if (!toToken || !sourceToken || state.loadingPrices || !haveSourceTokenAmount || !address) {\n      return;\n    }\n    state.loadingQuote = true;\n    const amountDecimal = NumberUtil.bigNumber(state.sourceTokenAmount).times(10 ** sourceToken.decimals).round(0);\n    try {\n      const quoteResponse = await BlockchainApiController.fetchSwapQuote({\n        userAddress: address,\n        from: sourceToken.address,\n        to: toToken.address,\n        gasPrice: state.gasFee,\n        amount: amountDecimal.toString()\n      });\n      state.loadingQuote = false;\n      const quoteToAmount = quoteResponse?.quotes?.[0]?.toAmount;\n      if (!quoteToAmount) {\n        AlertController.open({\n          displayMessage: 'Incorrect amount',\n          debugMessage: 'Please enter a valid amount'\n        }, 'error');\n        return;\n      }\n      const toTokenAmount = NumberUtil.bigNumber(quoteToAmount).div(10 ** toToken.decimals).toString();\n      SwapController.setToTokenAmount(toTokenAmount);\n      const isInsufficientToken = SwapController.hasInsufficientToken(state.sourceTokenAmount, sourceToken.address);\n      if (isInsufficientToken) {\n        state.inputError = 'Insufficient balance';\n      } else {\n        state.inputError = undefined;\n        SwapController.setTransactionDetails();\n      }\n    } catch (error) {\n      const response = await SwapApiUtil.handleSwapError(error);\n      state.loadingQuote = false;\n      state.inputError = response || 'Insufficient balance';\n    }\n  },\n  // -- Create Transactions -------------------------------------- //\n  async getTransaction() {\n    const {\n      fromCaipAddress,\n      availableToSwap\n    } = SwapController.getParams();\n    const sourceToken = state.sourceToken;\n    const toToken = state.toToken;\n    if (!fromCaipAddress || !availableToSwap || !sourceToken || !toToken || state.loadingQuote) {\n      return undefined;\n    }\n    try {\n      state.loadingBuildTransaction = true;\n      const hasAllowance = await SwapApiUtil.fetchSwapAllowance({\n        userAddress: fromCaipAddress,\n        tokenAddress: sourceToken.address,\n        sourceTokenAmount: state.sourceTokenAmount,\n        sourceTokenDecimals: sourceToken.decimals\n      });\n      let transaction = undefined;\n      if (hasAllowance) {\n        transaction = await SwapController.createSwapTransaction();\n      } else {\n        transaction = await SwapController.createAllowanceTransaction();\n      }\n      state.loadingBuildTransaction = false;\n      state.fetchError = false;\n      return transaction;\n    } catch (error) {\n      RouterController.goBack();\n      SnackController.showError('Failed to check allowance');\n      state.loadingBuildTransaction = false;\n      state.approvalTransaction = undefined;\n      state.swapTransaction = undefined;\n      state.fetchError = true;\n      return undefined;\n    }\n  },\n  async createAllowanceTransaction() {\n    const {\n      fromCaipAddress,\n      sourceTokenAddress,\n      toTokenAddress\n    } = SwapController.getParams();\n    if (!fromCaipAddress || !toTokenAddress) {\n      return undefined;\n    }\n    if (!sourceTokenAddress) {\n      throw new Error('createAllowanceTransaction - No source token address found.');\n    }\n    try {\n      const response = await BlockchainApiController.generateApproveCalldata({\n        from: sourceTokenAddress,\n        to: toTokenAddress,\n        userAddress: fromCaipAddress\n      });\n      const address = CoreHelperUtil.getPlainAddress(response.tx.from);\n      if (!address) {\n        throw new Error('SwapController:createAllowanceTransaction - address is required');\n      }\n      const transaction = {\n        data: response.tx.data,\n        to: address,\n        gasPrice: BigInt(response.tx.eip155.gasPrice),\n        value: BigInt(response.tx.value),\n        toAmount: state.toTokenAmount\n      };\n      state.swapTransaction = undefined;\n      state.approvalTransaction = {\n        data: transaction.data,\n        to: transaction.to,\n        gasPrice: transaction.gasPrice,\n        value: transaction.value,\n        toAmount: transaction.toAmount\n      };\n      return {\n        data: transaction.data,\n        to: transaction.to,\n        gasPrice: transaction.gasPrice,\n        value: transaction.value,\n        toAmount: transaction.toAmount\n      };\n    } catch (error) {\n      RouterController.goBack();\n      SnackController.showError('Failed to create approval transaction');\n      state.approvalTransaction = undefined;\n      state.swapTransaction = undefined;\n      state.fetchError = true;\n      return undefined;\n    }\n  },\n  async createSwapTransaction() {\n    const {\n      networkAddress,\n      fromCaipAddress,\n      sourceTokenAmount\n    } = SwapController.getParams();\n    const sourceToken = state.sourceToken;\n    const toToken = state.toToken;\n    if (!fromCaipAddress || !sourceTokenAmount || !sourceToken || !toToken) {\n      return undefined;\n    }\n    const amount = ConnectionController.parseUnits(sourceTokenAmount, sourceToken.decimals)?.toString();\n    try {\n      const response = await BlockchainApiController.generateSwapCalldata({\n        userAddress: fromCaipAddress,\n        from: sourceToken.address,\n        to: toToken.address,\n        amount: amount,\n        disableEstimate: true\n      });\n      const isSourceTokenIsNetworkToken = sourceToken.address === networkAddress;\n      const gas = BigInt(response.tx.eip155.gas);\n      const gasPrice = BigInt(response.tx.eip155.gasPrice);\n      const address = CoreHelperUtil.getPlainAddress(response.tx.to);\n      if (!address) {\n        throw new Error('SwapController:createSwapTransaction - address is required');\n      }\n      const transaction = {\n        data: response.tx.data,\n        to: address,\n        gas,\n        gasPrice,\n        value: isSourceTokenIsNetworkToken ? BigInt(amount ?? '0') : BigInt('0'),\n        toAmount: state.toTokenAmount\n      };\n      state.gasPriceInUSD = SwapCalculationUtil.getGasPriceInUSD(state.networkPrice, gas, gasPrice);\n      state.approvalTransaction = undefined;\n      state.swapTransaction = transaction;\n      return transaction;\n    } catch (error) {\n      RouterController.goBack();\n      SnackController.showError('Failed to create transaction');\n      state.approvalTransaction = undefined;\n      state.swapTransaction = undefined;\n      state.fetchError = true;\n      return undefined;\n    }\n  },\n  onEmbeddedWalletApprovalSuccess() {\n    SnackController.showLoading('Approve limit increase in your wallet');\n    RouterController.replace('SwapPreview');\n  },\n  // -- Send Transactions --------------------------------- //\n  async sendTransactionForApproval(data) {\n    const {\n      fromAddress,\n      isAuthConnector\n    } = SwapController.getParams();\n    state.loadingApprovalTransaction = true;\n    const approveLimitMessage = `Approve limit increase in your wallet`;\n    if (isAuthConnector) {\n      RouterController.pushTransactionStack({\n        onSuccess: SwapController.onEmbeddedWalletApprovalSuccess\n      });\n    } else {\n      SnackController.showLoading(approveLimitMessage);\n    }\n    try {\n      await ConnectionController.sendTransaction({\n        address: fromAddress,\n        to: data.to,\n        data: data.data,\n        value: data.value,\n        chainNamespace: CommonConstantsUtil.CHAIN.EVM\n      });\n      await SwapController.swapTokens();\n      await SwapController.getTransaction();\n      state.approvalTransaction = undefined;\n      state.loadingApprovalTransaction = false;\n    } catch (err) {\n      const error = err;\n      state.transactionError = error?.displayMessage;\n      state.loadingApprovalTransaction = false;\n      SnackController.showError(error?.displayMessage || 'Transaction error');\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SWAP_APPROVAL_ERROR',\n        properties: {\n          message: error?.displayMessage || error?.message || 'Unknown',\n          network: ChainController.state.activeCaipNetwork?.caipNetworkId || '',\n          swapFromToken: SwapController.state.sourceToken?.symbol || '',\n          swapToToken: SwapController.state.toToken?.symbol || '',\n          swapFromAmount: SwapController.state.sourceTokenAmount || '',\n          swapToAmount: SwapController.state.toTokenAmount || '',\n          isSmartAccount: getPreferredAccountType(CommonConstantsUtil.CHAIN.EVM) === W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT\n        }\n      });\n    }\n  },\n  async sendTransactionForSwap(data) {\n    if (!data) {\n      return undefined;\n    }\n    const {\n      fromAddress,\n      toTokenAmount,\n      isAuthConnector\n    } = SwapController.getParams();\n    state.loadingTransaction = true;\n    const snackbarPendingMessage = `Swapping ${state.sourceToken?.symbol} to ${NumberUtil.formatNumberToLocalString(toTokenAmount, 3)} ${state.toToken?.symbol}`;\n    const snackbarSuccessMessage = `Swapped ${state.sourceToken?.symbol} to ${NumberUtil.formatNumberToLocalString(toTokenAmount, 3)} ${state.toToken?.symbol}`;\n    if (isAuthConnector) {\n      RouterController.pushTransactionStack({\n        onSuccess() {\n          RouterController.replace('Account');\n          SnackController.showLoading(snackbarPendingMessage);\n          controller.resetState();\n        }\n      });\n    } else {\n      SnackController.showLoading('Confirm transaction in your wallet');\n    }\n    try {\n      const forceUpdateAddresses = [state.sourceToken?.address, state.toToken?.address].join(',');\n      const transactionHash = await ConnectionController.sendTransaction({\n        address: fromAddress,\n        to: data.to,\n        data: data.data,\n        value: data.value,\n        chainNamespace: CommonConstantsUtil.CHAIN.EVM\n      });\n      state.loadingTransaction = false;\n      SnackController.showSuccess(snackbarSuccessMessage);\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SWAP_SUCCESS',\n        properties: {\n          network: ChainController.state.activeCaipNetwork?.caipNetworkId || '',\n          swapFromToken: SwapController.state.sourceToken?.symbol || '',\n          swapToToken: SwapController.state.toToken?.symbol || '',\n          swapFromAmount: SwapController.state.sourceTokenAmount || '',\n          swapToAmount: SwapController.state.toTokenAmount || '',\n          isSmartAccount: getPreferredAccountType(CommonConstantsUtil.CHAIN.EVM) === W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT\n        }\n      });\n      controller.resetState();\n      if (!isAuthConnector) {\n        RouterController.replace('Account');\n      }\n      controller.getMyTokensWithBalance(forceUpdateAddresses);\n      return transactionHash;\n    } catch (err) {\n      const error = err;\n      state.transactionError = error?.displayMessage;\n      state.loadingTransaction = false;\n      SnackController.showError(error?.displayMessage || 'Transaction error');\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SWAP_ERROR',\n        properties: {\n          message: error?.displayMessage || error?.message || 'Unknown',\n          network: ChainController.state.activeCaipNetwork?.caipNetworkId || '',\n          swapFromToken: SwapController.state.sourceToken?.symbol || '',\n          swapToToken: SwapController.state.toToken?.symbol || '',\n          swapFromAmount: SwapController.state.sourceTokenAmount || '',\n          swapToAmount: SwapController.state.toTokenAmount || '',\n          isSmartAccount: getPreferredAccountType(CommonConstantsUtil.CHAIN.EVM) === W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT\n        }\n      });\n      return undefined;\n    }\n  },\n  // -- Checks -------------------------------------------- //\n  hasInsufficientToken(sourceTokenAmount, sourceTokenAddress) {\n    const isInsufficientSourceTokenForSwap = SwapCalculationUtil.isInsufficientSourceTokenForSwap(sourceTokenAmount, sourceTokenAddress, state.myTokensWithBalance);\n    return isInsufficientSourceTokenForSwap;\n  },\n  // -- Calculations -------------------------------------- //\n  setTransactionDetails() {\n    const {\n      toTokenAddress,\n      toTokenDecimals\n    } = SwapController.getParams();\n    if (!toTokenAddress || !toTokenDecimals) {\n      return;\n    }\n    state.gasPriceInUSD = SwapCalculationUtil.getGasPriceInUSD(state.networkPrice, BigInt(state.gasFee), BigInt(INITIAL_GAS_LIMIT));\n    state.priceImpact = SwapCalculationUtil.getPriceImpact({\n      sourceTokenAmount: state.sourceTokenAmount,\n      sourceTokenPriceInUSD: state.sourceTokenPriceInUSD,\n      toTokenPriceInUSD: state.toTokenPriceInUSD,\n      toTokenAmount: state.toTokenAmount\n    });\n    state.maxSlippage = SwapCalculationUtil.getMaxSlippage(state.slippage, state.toTokenAmount);\n    state.providerFee = SwapCalculationUtil.getProviderFee(state.sourceTokenAmount);\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const SwapController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","NumberUtil","ConstantsUtil","CommonConstantsUtil","W3mFrameRpcConstants","BalanceUtil","getActiveNetworkTokenAddress","getPreferredAccountType","CoreHelperUtil","SwapApiUtil","SwapCalculationUtil","withErrorBoundary","AlertController","BlockchainApiController","ChainController","ConnectionController","ConnectorController","EventsController","RouterController","SnackController","INITIAL_GAS_LIMIT","TO_AMOUNT_DECIMALS","TransactionError","Error","constructor","message","displayMessage","name","initialState","initializing","initialized","loadingPrices","loadingQuote","loadingApprovalTransaction","loadingBuildTransaction","loadingTransaction","switchingTokens","fetchError","approvalTransaction","undefined","swapTransaction","transactionError","sourceToken","sourceTokenAmount","sourceTokenPriceInUSD","toToken","toTokenAmount","toTokenPriceInUSD","networkPrice","networkBalanceInUSD","networkTokenSymbol","inputError","slippage","CONVERT_SLIPPAGE_TOLERANCE","tokens","popularTokens","suggestedTokens","foundTokens","myTokensWithBalance","tokensPriceMap","gasFee","gasPriceInUSD","priceImpact","maxSlippage","providerFee","state","controller","callback","key","getParams","namespace","activeChain","caipAddress","getAccountData","activeCaipAddress","address","getPlainAddress","networkAddress","connectorId","getConnectorId","invalidToToken","decimals","invalidSourceToken","bigNumber","gt","invalidSourceTokenAmount","fromAddress","fromCaipAddress","sourceTokenAddress","toTokenAddress","toTokenDecimals","sourceTokenDecimals","availableToSwap","isAuthConnector","CONNECTOR_ID","AUTH","setSourceToken","SwapController","setTokenPrice","setSourceTokenAmount","amount","setToToken","setToTokenAmount","toFixed","target","price","getAddressPrice","swapTokens","switchTokens","newSourceToken","newToToken","newSourceTokenAmount","error","resetState","resetValues","networkToken","find","token","getApprovalLoadingState","clearError","initializeState","fetchTokens","showError","goBack","getNetworkTokenPrice","getMyTokensWithBalance","symbol","getTokenList","activeCaipNetworkId","activeCaipNetwork","caipNetworkId","tokensLoading","sort","aTokenInfo","bTokenInfo","filter","SWAP_SUGGESTED_TOKENS","includes","existPrice","response","fetchTokenPrice","addresses","fungibles","allTokens","p","toLowerCase","priceAsFloat","parseFloat","toString","catch","forceUpdate","balances","swapBalances","mapBalancesToSwapTokens","getInitialGasPrice","setBalances","caipNetwork","forEach","startsWith","multiply","quantity","numeric","res","fetchGasPrice","gasPrice","chainNamespace","CHAIN","SOLANA","standard","div","toNumber","BigInt","Number","EVM","value","gasLimit","getGasPriceInUSD","haveSourceTokenAmount","amountDecimal","times","round","quoteResponse","fetchSwapQuote","userAddress","from","to","quoteToAmount","quotes","toAmount","open","debugMessage","isInsufficientToken","hasInsufficientToken","setTransactionDetails","handleSwapError","getTransaction","hasAllowance","fetchSwapAllowance","tokenAddress","transaction","createSwapTransaction","createAllowanceTransaction","generateApproveCalldata","tx","data","eip155","parseUnits","generateSwapCalldata","disableEstimate","isSourceTokenIsNetworkToken","gas","onEmbeddedWalletApprovalSuccess","showLoading","replace","sendTransactionForApproval","approveLimitMessage","pushTransactionStack","onSuccess","sendTransaction","err","sendEvent","type","event","properties","network","swapFromToken","swapToToken","swapFromAmount","swapToAmount","isSmartAccount","ACCOUNT_TYPES","SMART_ACCOUNT","sendTransactionForSwap","snackbarPendingMessage","formatNumberToLocalString","snackbarSuccessMessage","forceUpdateAddresses","join","transactionHash","showSuccess","isInsufficientSourceTokenForSwap","getPriceImpact","getMaxSlippage","getProviderFee"],"sources":["../../../../src/controllers/SwapController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}