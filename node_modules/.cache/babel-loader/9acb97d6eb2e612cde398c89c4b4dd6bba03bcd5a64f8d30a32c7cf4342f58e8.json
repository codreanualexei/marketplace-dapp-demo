{"ast":null,"code":"import { BlockchainApiController } from '../controllers/BlockchainApiController.js';\nimport { ChainController } from '../controllers/ChainController.js';\nimport { ConnectionController } from '../controllers/ConnectionController.js';\nimport { BalanceUtil } from './BalanceUtil.js';\nimport { getActiveNetworkTokenAddress } from './ChainControllerUtil.js';\n// -- Controller ---------------------------------------- //\nexport const SwapApiUtil = {\n  async getTokenList(caipNetworkId) {\n    const response = await BlockchainApiController.fetchSwapTokens({\n      chainId: caipNetworkId\n    });\n    const tokens = response?.tokens?.map(token => ({\n      ...token,\n      eip2612: false,\n      quantity: {\n        decimals: '0',\n        numeric: '0'\n      },\n      price: 0,\n      value: 0\n    })) || [];\n    return tokens;\n  },\n  async fetchGasPrice() {\n    const caipNetwork = ChainController.state.activeCaipNetwork;\n    if (!caipNetwork) {\n      return null;\n    }\n    try {\n      switch (caipNetwork.chainNamespace) {\n        case 'solana':\n          // eslint-disable-next-line no-case-declarations\n          const lamportsPerSignature = (await ConnectionController?.estimateGas({\n            chainNamespace: 'solana'\n          }))?.toString();\n          return {\n            standard: lamportsPerSignature,\n            fast: lamportsPerSignature,\n            instant: lamportsPerSignature\n          };\n        case 'eip155':\n        default:\n          return await BlockchainApiController.fetchGasPrice({\n            chainId: caipNetwork.caipNetworkId\n          });\n      }\n    } catch {\n      return null;\n    }\n  },\n  async fetchSwapAllowance({\n    tokenAddress,\n    userAddress,\n    sourceTokenAmount,\n    sourceTokenDecimals\n  }) {\n    const response = await BlockchainApiController.fetchSwapAllowance({\n      tokenAddress,\n      userAddress\n    });\n    if (response?.allowance && sourceTokenAmount && sourceTokenDecimals) {\n      const parsedValue = ConnectionController.parseUnits(sourceTokenAmount, sourceTokenDecimals) || 0;\n      const hasAllowance = BigInt(response.allowance) >= parsedValue;\n      return hasAllowance;\n    }\n    return false;\n  },\n  async getMyTokensWithBalance(forceUpdate) {\n    const balances = await BalanceUtil.getMyTokensWithBalance(forceUpdate);\n    ChainController.setAccountProp('tokenBalance', balances, ChainController.state.activeChain);\n    return this.mapBalancesToSwapTokens(balances);\n  },\n  /**\n   * Maps the balances from Blockchain API to SwapTokenWithBalance array\n   * @param balances\n   * @returns SwapTokenWithBalance[]\n   */\n  mapBalancesToSwapTokens(balances) {\n    return balances?.map(token => ({\n      ...token,\n      address: token?.address ? token.address : getActiveNetworkTokenAddress(),\n      decimals: parseInt(token.quantity.decimals, 10),\n      logoUri: token.iconUrl,\n      eip2612: false\n    })) || [];\n  },\n  async handleSwapError(error) {\n    try {\n      const cause = error?.cause;\n      if (!cause?.json) {\n        return undefined;\n      }\n      const response = await cause.json();\n      const reason = response?.reasons?.[0]?.description;\n      if (reason?.includes('insufficient liquidity')) {\n        return 'Insufficient liquidity';\n      }\n      return undefined;\n    } catch {\n      return undefined;\n    }\n  }\n};","map":{"version":3,"names":["BlockchainApiController","ChainController","ConnectionController","BalanceUtil","getActiveNetworkTokenAddress","SwapApiUtil","getTokenList","caipNetworkId","response","fetchSwapTokens","chainId","tokens","map","token","eip2612","quantity","decimals","numeric","price","value","fetchGasPrice","caipNetwork","state","activeCaipNetwork","chainNamespace","lamportsPerSignature","estimateGas","toString","standard","fast","instant","fetchSwapAllowance","tokenAddress","userAddress","sourceTokenAmount","sourceTokenDecimals","allowance","parsedValue","parseUnits","hasAllowance","BigInt","getMyTokensWithBalance","forceUpdate","balances","setAccountProp","activeChain","mapBalancesToSwapTokens","address","parseInt","logoUri","iconUrl","handleSwapError","error","cause","json","undefined","reason","reasons","description","includes"],"sources":["../../../../src/utils/SwapApiUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}