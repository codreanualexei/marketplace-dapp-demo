{"ast":null,"code":"import UniversalProvider from '@walletconnect/universal-provider';\nimport { ConstantsUtil as CommonConstantsUtil } from '@reown/appkit-common';\nimport { W3mFrameRpcConstants } from '@reown/appkit-wallet/utils';\nimport { ChainController } from '../controllers/ChainController.js';\nimport { ConnectionController } from '../controllers/ConnectionController.js';\nimport { ConnectorController } from '../controllers/ConnectorController.js';\nimport { EventsController } from '../controllers/EventsController.js';\nimport { ModalController } from '../controllers/ModalController.js';\nimport { OptionsController } from '../controllers/OptionsController.js';\nimport { RouterController } from '../controllers/RouterController.js';\nimport { SnackController } from '../controllers/SnackController.js';\nimport { getActiveCaipNetwork, getPreferredAccountType } from './ChainControllerUtil.js';\nimport { CoreHelperUtil } from './CoreHelperUtil.js';\n/**\n * SIWXUtil holds the methods to interact with the SIWX plugin and must be called internally on AppKit.\n */\nlet addEmbeddedWalletSessionPromise = null;\nexport const SIWXUtil = {\n  getSIWX() {\n    return OptionsController.state.siwx;\n  },\n  async initializeIfEnabled(caipAddress = ChainController.getActiveCaipAddress()) {\n    const siwx = OptionsController.state.siwx;\n    if (!(siwx && caipAddress)) {\n      return;\n    }\n    const [namespace, chainId, address] = caipAddress.split(':');\n    if (!ChainController.checkIfSupportedNetwork(namespace, `${namespace}:${chainId}`)) {\n      return;\n    }\n    try {\n      if (OptionsController.state.remoteFeatures?.emailCapture) {\n        const user = ChainController.getAccountData(namespace)?.user;\n        await ModalController.open({\n          view: 'DataCapture',\n          data: {\n            email: user?.email ?? undefined\n          }\n        });\n        return;\n      }\n      if (addEmbeddedWalletSessionPromise) {\n        await addEmbeddedWalletSessionPromise;\n      }\n      const sessions = await siwx.getSessions(`${namespace}:${chainId}`, address);\n      if (sessions.length) {\n        return;\n      }\n      await ModalController.open({\n        view: 'SIWXSignMessage'\n      });\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error('SIWXUtil:initializeIfEnabled', error);\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SIWX_AUTH_ERROR',\n        properties: this.getSIWXEventProperties(error)\n      });\n      // eslint-disable-next-line no-console\n      await ConnectionController._getClient()?.disconnect().catch(console.error);\n      RouterController.reset('Connect');\n      SnackController.showError('A problem occurred while trying initialize authentication');\n    }\n  },\n  async requestSignMessage() {\n    const siwx = OptionsController.state.siwx;\n    const address = CoreHelperUtil.getPlainAddress(ChainController.getActiveCaipAddress());\n    const network = getActiveCaipNetwork();\n    const client = ConnectionController._getClient();\n    if (!siwx) {\n      throw new Error('SIWX is not enabled');\n    }\n    if (!address) {\n      throw new Error('No ActiveCaipAddress found');\n    }\n    if (!network) {\n      throw new Error('No ActiveCaipNetwork or client found');\n    }\n    if (!client) {\n      throw new Error('No ConnectionController client found');\n    }\n    try {\n      const siwxMessage = await siwx.createMessage({\n        chainId: network.caipNetworkId,\n        accountAddress: address\n      });\n      const message = siwxMessage.toString();\n      const connectorId = ConnectorController.getConnectorId(network.chainNamespace);\n      if (connectorId === CommonConstantsUtil.CONNECTOR_ID.AUTH) {\n        RouterController.pushTransactionStack({});\n      }\n      const signature = await client.signMessage(message);\n      await siwx.addSession({\n        data: siwxMessage,\n        message,\n        signature\n      });\n      ChainController.setLastConnectedSIWECaipNetwork(network);\n      ModalController.close();\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SIWX_AUTH_SUCCESS',\n        properties: this.getSIWXEventProperties()\n      });\n    } catch (error) {\n      if (!ModalController.state.open || RouterController.state.view === 'ApproveTransaction') {\n        await ModalController.open({\n          view: 'SIWXSignMessage'\n        });\n      }\n      SnackController.showError('Error signing message');\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SIWX_AUTH_ERROR',\n        properties: this.getSIWXEventProperties(error)\n      });\n      // eslint-disable-next-line no-console\n      console.error('SWIXUtil:requestSignMessage', error);\n    }\n  },\n  async cancelSignMessage() {\n    try {\n      const siwx = this.getSIWX();\n      const isRequired = siwx?.getRequired?.();\n      if (isRequired) {\n        const lastNetwork = ChainController.getLastConnectedSIWECaipNetwork();\n        if (lastNetwork) {\n          const sessions = await siwx?.getSessions(lastNetwork?.caipNetworkId, CoreHelperUtil.getPlainAddress(ChainController.getActiveCaipAddress()) || '');\n          if (sessions && sessions.length > 0) {\n            await ChainController.switchActiveNetwork(lastNetwork);\n          } else {\n            await ConnectionController.disconnect();\n          }\n        } else {\n          await ConnectionController.disconnect();\n        }\n      } else {\n        ModalController.close();\n      }\n      ModalController.close();\n      EventsController.sendEvent({\n        event: 'CLICK_CANCEL_SIWX',\n        type: 'track',\n        properties: this.getSIWXEventProperties()\n      });\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error('SIWXUtil:cancelSignMessage', error);\n    }\n  },\n  async getAllSessions() {\n    const siwx = this.getSIWX();\n    const allRequestedCaipNetworks = ChainController.getAllRequestedCaipNetworks();\n    const sessions = [];\n    await Promise.all(allRequestedCaipNetworks.map(async caipNetwork => {\n      const session = await siwx?.getSessions(caipNetwork.caipNetworkId, CoreHelperUtil.getPlainAddress(ChainController.getActiveCaipAddress()) || '');\n      if (session) {\n        sessions.push(...session);\n      }\n    }));\n    return sessions;\n  },\n  async getSessions(args) {\n    const siwx = OptionsController.state.siwx;\n    let address = args?.address;\n    if (!address) {\n      const activeCaipAddress = ChainController.getActiveCaipAddress();\n      address = CoreHelperUtil.getPlainAddress(activeCaipAddress);\n    }\n    let network = args?.caipNetworkId;\n    if (!network) {\n      const activeCaipNetwork = ChainController.getActiveCaipNetwork();\n      network = activeCaipNetwork?.caipNetworkId;\n    }\n    if (!(siwx && address && network)) {\n      return [];\n    }\n    return siwx.getSessions(network, address);\n  },\n  async isSIWXCloseDisabled() {\n    const siwx = this.getSIWX();\n    if (siwx) {\n      const isApproveSignScreen = RouterController.state.view === 'ApproveTransaction';\n      const isSiwxSignMessage = RouterController.state.view === 'SIWXSignMessage';\n      if (isApproveSignScreen || isSiwxSignMessage) {\n        return siwx.getRequired?.() && (await this.getSessions()).length === 0;\n      }\n    }\n    return false;\n  },\n  async authConnectorAuthenticate({\n    authConnector,\n    chainId,\n    socialUri,\n    preferredAccountType,\n    chainNamespace\n  }) {\n    const siwx = SIWXUtil.getSIWX();\n    const network = getActiveCaipNetwork();\n    if (!siwx || !chainNamespace.includes(CommonConstantsUtil.CHAIN.EVM) ||\n    // Request to input email and sign message when email capture is enabled\n    OptionsController.state.remoteFeatures?.emailCapture) {\n      const result = await authConnector.connect({\n        chainId,\n        socialUri,\n        preferredAccountType\n      });\n      return {\n        address: result.address,\n        chainId: result.chainId,\n        accounts: result.accounts\n      };\n    }\n    const caipNetwork = `${chainNamespace}:${chainId}`;\n    const siwxMessage = await siwx.createMessage({\n      chainId: caipNetwork,\n      accountAddress: '<<AccountAddress>>'\n    });\n    // Extract only the serializable data properties for postMessage, toString() is not possible to include in the postMessage\n    const siwxMessageData = {\n      accountAddress: siwxMessage.accountAddress,\n      chainId: siwxMessage.chainId,\n      domain: siwxMessage.domain,\n      uri: siwxMessage.uri,\n      version: siwxMessage.version,\n      nonce: siwxMessage.nonce,\n      notBefore: siwxMessage.notBefore,\n      statement: siwxMessage.statement,\n      resources: siwxMessage.resources,\n      requestId: siwxMessage.requestId,\n      issuedAt: siwxMessage.issuedAt,\n      expirationTime: siwxMessage.expirationTime,\n      serializedMessage: siwxMessage.toString()\n    };\n    const result = await authConnector.connect({\n      chainId,\n      socialUri,\n      siwxMessage: siwxMessageData,\n      preferredAccountType\n    });\n    siwxMessageData.accountAddress = result.address;\n    siwxMessageData.serializedMessage = result.message || '';\n    if (result.signature && result.message) {\n      const promise = SIWXUtil.addEmbeddedWalletSession(siwxMessageData, result.message, result.signature);\n      await promise;\n    }\n    ChainController.setLastConnectedSIWECaipNetwork(network);\n    return {\n      address: result.address,\n      chainId: result.chainId,\n      accounts: result.accounts\n    };\n  },\n  async addEmbeddedWalletSession(siwxMessageData, message, signature) {\n    if (addEmbeddedWalletSessionPromise) {\n      return addEmbeddedWalletSessionPromise;\n    }\n    const siwx = SIWXUtil.getSIWX();\n    if (!siwx) {\n      return Promise.resolve();\n    }\n    addEmbeddedWalletSessionPromise = siwx.addSession({\n      data: siwxMessageData,\n      message,\n      signature\n    }).finally(() => {\n      addEmbeddedWalletSessionPromise = null;\n    });\n    return addEmbeddedWalletSessionPromise;\n  },\n  async universalProviderAuthenticate({\n    universalProvider,\n    chains,\n    methods\n  }) {\n    const siwx = SIWXUtil.getSIWX();\n    const network = getActiveCaipNetwork();\n    const namespaces = new Set(chains.map(chain => chain.split(':')[0]));\n    if (!siwx || namespaces.size !== 1 || !namespaces.has('eip155')) {\n      return false;\n    }\n    // Ignores chainId and account address to get other message data\n    const siwxMessage = await siwx.createMessage({\n      chainId: getActiveCaipNetwork()?.caipNetworkId || '',\n      accountAddress: ''\n    });\n    const result = await universalProvider.authenticate({\n      nonce: siwxMessage.nonce,\n      domain: siwxMessage.domain,\n      uri: siwxMessage.uri,\n      exp: siwxMessage.expirationTime,\n      iat: siwxMessage.issuedAt,\n      nbf: siwxMessage.notBefore,\n      requestId: siwxMessage.requestId,\n      version: siwxMessage.version,\n      resources: siwxMessage.resources,\n      statement: siwxMessage.statement,\n      chainId: siwxMessage.chainId,\n      methods,\n      // The first chainId is what is used for universal provider to build the message\n      chains: [siwxMessage.chainId, ...chains.filter(chain => chain !== siwxMessage.chainId)]\n    });\n    SnackController.showLoading('Authenticating...', {\n      autoClose: false\n    });\n    const walletInfo = {\n      ...result.session.peer.metadata,\n      name: result.session.peer.metadata.name,\n      icon: result.session.peer.metadata.icons?.[0],\n      type: 'WALLET_CONNECT'\n    };\n    ChainController.setAccountProp('connectedWalletInfo', walletInfo, Array.from(namespaces)[0]);\n    if (result?.auths?.length) {\n      const sessions = result.auths.map(cacao => {\n        const message = universalProvider.client.formatAuthMessage({\n          request: cacao.p,\n          iss: cacao.p.iss\n        });\n        return {\n          data: {\n            ...cacao.p,\n            accountAddress: cacao.p.iss.split(':').slice(-1).join(''),\n            chainId: cacao.p.iss.split(':').slice(2, 4).join(':'),\n            uri: cacao.p.aud,\n            version: cacao.p.version || siwxMessage.version,\n            expirationTime: cacao.p.exp,\n            issuedAt: cacao.p.iat,\n            notBefore: cacao.p.nbf\n          },\n          message,\n          signature: cacao.s.s,\n          cacao\n        };\n      });\n      try {\n        await siwx.setSessions(sessions);\n        if (network) {\n          ChainController.setLastConnectedSIWECaipNetwork(network);\n        }\n        EventsController.sendEvent({\n          type: 'track',\n          event: 'SIWX_AUTH_SUCCESS',\n          properties: SIWXUtil.getSIWXEventProperties()\n        });\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('SIWX:universalProviderAuth - failed to set sessions', error);\n        EventsController.sendEvent({\n          type: 'track',\n          event: 'SIWX_AUTH_ERROR',\n          properties: SIWXUtil.getSIWXEventProperties(error)\n        });\n        // eslint-disable-next-line no-console\n        await universalProvider.disconnect().catch(console.error);\n        throw error;\n      } finally {\n        SnackController.hide();\n      }\n    }\n    return true;\n  },\n  getSIWXEventProperties(error) {\n    const namespace = ChainController.state.activeChain;\n    if (!namespace) {\n      throw new Error('SIWXUtil:getSIWXEventProperties - namespace is required');\n    }\n    return {\n      network: ChainController.state.activeCaipNetwork?.caipNetworkId || '',\n      isSmartAccount: getPreferredAccountType(namespace) === W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT,\n      message: error ? CoreHelperUtil.parseError(error) : undefined\n    };\n  },\n  async clearSessions() {\n    const siwx = this.getSIWX();\n    if (siwx) {\n      await siwx.setSessions([]);\n    }\n  }\n};","map":{"version":3,"names":["UniversalProvider","ConstantsUtil","CommonConstantsUtil","W3mFrameRpcConstants","ChainController","ConnectionController","ConnectorController","EventsController","ModalController","OptionsController","RouterController","SnackController","getActiveCaipNetwork","getPreferredAccountType","CoreHelperUtil","addEmbeddedWalletSessionPromise","SIWXUtil","getSIWX","state","siwx","initializeIfEnabled","caipAddress","getActiveCaipAddress","namespace","chainId","address","split","checkIfSupportedNetwork","remoteFeatures","emailCapture","user","getAccountData","open","view","data","email","undefined","sessions","getSessions","length","error","console","sendEvent","type","event","properties","getSIWXEventProperties","_getClient","disconnect","catch","reset","showError","requestSignMessage","getPlainAddress","network","client","Error","siwxMessage","createMessage","caipNetworkId","accountAddress","message","toString","connectorId","getConnectorId","chainNamespace","CONNECTOR_ID","AUTH","pushTransactionStack","signature","signMessage","addSession","setLastConnectedSIWECaipNetwork","close","cancelSignMessage","isRequired","getRequired","lastNetwork","getLastConnectedSIWECaipNetwork","switchActiveNetwork","getAllSessions","allRequestedCaipNetworks","getAllRequestedCaipNetworks","Promise","all","map","caipNetwork","session","push","args","activeCaipAddress","activeCaipNetwork","isSIWXCloseDisabled","isApproveSignScreen","isSiwxSignMessage","authConnectorAuthenticate","authConnector","socialUri","preferredAccountType","includes","CHAIN","EVM","result","connect","accounts","siwxMessageData","domain","uri","version","nonce","notBefore","statement","resources","requestId","issuedAt","expirationTime","serializedMessage","promise","addEmbeddedWalletSession","resolve","finally","universalProviderAuthenticate","universalProvider","chains","methods","namespaces","Set","chain","size","has","authenticate","exp","iat","nbf","filter","showLoading","autoClose","walletInfo","peer","metadata","name","icon","icons","setAccountProp","Array","from","auths","cacao","formatAuthMessage","request","p","iss","slice","join","aud","s","setSessions","hide","activeChain","isSmartAccount","ACCOUNT_TYPES","SMART_ACCOUNT","parseError","clearSessions"],"sources":["../../../../src/utils/SIWXUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}