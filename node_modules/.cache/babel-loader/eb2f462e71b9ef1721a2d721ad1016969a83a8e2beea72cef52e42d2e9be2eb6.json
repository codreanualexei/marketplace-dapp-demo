{"ast":null,"code":"import _objectSpread from \"/Users/alex.codreanu/Desktop/marketplace-dapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { NumberUtil } from '@reown/appkit-common';\nimport { getActiveNetworkTokenAddress } from '../utils/ChainControllerUtil.js';\nimport { ConstantsUtil } from '../utils/ConstantsUtil.js';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { formatCaip19Asset, getBuyStatus, getExchanges, getPayUrl, getPaymentAssetsForNetwork } from '../utils/ExchangeUtil.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { EventsController } from './EventsController.js';\nimport { OptionsController } from './OptionsController.js';\nimport { SnackController } from './SnackController.js';\n// -- Constants ----------------------------------------- //\nconst DEFAULT_PAGE = 0;\nexport const DEFAULT_STATE = {\n  paymentAsset: null,\n  amount: null,\n  tokenAmount: 0,\n  priceLoading: false,\n  error: null,\n  exchanges: [],\n  isLoading: false,\n  currentPayment: undefined,\n  isPaymentInProgress: false,\n  paymentId: '',\n  assets: []\n};\n// -- State --------------------------------------------- //\nconst state = proxy(DEFAULT_STATE);\n// -- Controller ---------------------------------------- //\nexport const ExchangeController = {\n  state,\n  // -- Subscriptions ----------------------------------- //\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  resetState() {\n    Object.assign(state, _objectSpread({}, DEFAULT_STATE));\n  },\n  async getAssetsForNetwork(network) {\n    const assets = getPaymentAssetsForNetwork(network);\n    const metadata = await ExchangeController.getAssetsImageAndPrice(assets);\n    const assetsWithPrice = assets.map(asset => {\n      var _assetMetadata$fungib, _assetMetadata$fungib2;\n      const assetAddress = asset.asset === 'native' ? getActiveNetworkTokenAddress() : \"\".concat(asset.network, \":\").concat(asset.asset);\n      const assetMetadata = metadata.find(m => {\n        var _m$fungibles;\n        return ((_m$fungibles = m.fungibles) === null || _m$fungibles === void 0 || (_m$fungibles = _m$fungibles[0]) === null || _m$fungibles === void 0 || (_m$fungibles = _m$fungibles.address) === null || _m$fungibles === void 0 ? void 0 : _m$fungibles.toLowerCase()) === assetAddress.toLowerCase();\n      });\n      return _objectSpread(_objectSpread({}, asset), {}, {\n        price: (assetMetadata === null || assetMetadata === void 0 || (_assetMetadata$fungib = assetMetadata.fungibles) === null || _assetMetadata$fungib === void 0 || (_assetMetadata$fungib = _assetMetadata$fungib[0]) === null || _assetMetadata$fungib === void 0 ? void 0 : _assetMetadata$fungib.price) || 1,\n        metadata: _objectSpread(_objectSpread({}, asset.metadata), {}, {\n          iconUrl: assetMetadata === null || assetMetadata === void 0 || (_assetMetadata$fungib2 = assetMetadata.fungibles) === null || _assetMetadata$fungib2 === void 0 || (_assetMetadata$fungib2 = _assetMetadata$fungib2[0]) === null || _assetMetadata$fungib2 === void 0 ? void 0 : _assetMetadata$fungib2.iconUrl\n        })\n      });\n    });\n    state.assets = assetsWithPrice;\n    return assetsWithPrice;\n  },\n  async getAssetsImageAndPrice(assets) {\n    const addresses = assets.map(asset => asset.asset === 'native' ? getActiveNetworkTokenAddress() : \"\".concat(asset.network, \":\").concat(asset.asset));\n    const metadata = await Promise.all(addresses.map(address => BlockchainApiController.fetchTokenPrice({\n      addresses: [address]\n    })));\n    return metadata;\n  },\n  getTokenAmount() {\n    var _state$paymentAsset, _state$amount;\n    if (!(state !== null && state !== void 0 && (_state$paymentAsset = state.paymentAsset) !== null && _state$paymentAsset !== void 0 && _state$paymentAsset.price)) {\n      throw new Error('Cannot get token price');\n    }\n    const bigAmount = NumberUtil.bigNumber((_state$amount = state.amount) !== null && _state$amount !== void 0 ? _state$amount : 0).round(8);\n    const bigPrice = NumberUtil.bigNumber(state.paymentAsset.price).round(8);\n    return bigAmount.div(bigPrice).round(8).toNumber();\n  },\n  setAmount(amount) {\n    var _state$paymentAsset2;\n    state.amount = amount;\n    if ((_state$paymentAsset2 = state.paymentAsset) !== null && _state$paymentAsset2 !== void 0 && _state$paymentAsset2.price) {\n      state.tokenAmount = ExchangeController.getTokenAmount();\n    }\n  },\n  setPaymentAsset(asset) {\n    state.paymentAsset = asset;\n  },\n  isPayWithExchangeEnabled() {\n    var _OptionsController$st, _OptionsController$st2, _OptionsController$st3;\n    return ((_OptionsController$st = OptionsController.state.remoteFeatures) === null || _OptionsController$st === void 0 ? void 0 : _OptionsController$st.payWithExchange) || ((_OptionsController$st2 = OptionsController.state.remoteFeatures) === null || _OptionsController$st2 === void 0 ? void 0 : _OptionsController$st2.payments) || ((_OptionsController$st3 = OptionsController.state.features) === null || _OptionsController$st3 === void 0 ? void 0 : _OptionsController$st3.pay);\n  },\n  isPayWithExchangeSupported() {\n    return ExchangeController.isPayWithExchangeEnabled() && ChainController.state.activeCaipNetwork && ConstantsUtil.PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES.includes(ChainController.state.activeCaipNetwork.chainNamespace);\n  },\n  // -- Getters ----------------------------------------- //\n  async fetchExchanges() {\n    try {\n      var _state$amount$toStrin, _state$amount2;\n      const isPayWithExchangeSupported = ExchangeController.isPayWithExchangeSupported();\n      if (!state.paymentAsset || !isPayWithExchangeSupported) {\n        state.exchanges = [];\n        state.isLoading = false;\n        return;\n      }\n      state.isLoading = true;\n      const response = await getExchanges({\n        page: DEFAULT_PAGE,\n        asset: formatCaip19Asset(state.paymentAsset.network, state.paymentAsset.asset),\n        amount: (_state$amount$toStrin = (_state$amount2 = state.amount) === null || _state$amount2 === void 0 ? void 0 : _state$amount2.toString()) !== null && _state$amount$toStrin !== void 0 ? _state$amount$toStrin : '0'\n      });\n      // Putting this here in order to maintain backawrds compatibility with the UI when we introduce more exchanges\n      state.exchanges = response.exchanges.slice(0, 2);\n    } catch (error) {\n      SnackController.showError('Unable to get exchanges');\n      throw new Error('Unable to get exchanges');\n    } finally {\n      state.isLoading = false;\n    }\n  },\n  async getPayUrl(exchangeId, params) {\n    try {\n      const numericAmount = Number(params.amount);\n      const response = await getPayUrl({\n        exchangeId,\n        asset: formatCaip19Asset(params.network, params.asset),\n        amount: numericAmount.toString(),\n        recipient: \"\".concat(params.network, \":\").concat(params.recipient)\n      });\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'PAY_EXCHANGE_SELECTED',\n        properties: {\n          exchange: {\n            id: exchangeId\n          },\n          configuration: {\n            network: params.network,\n            asset: params.asset,\n            recipient: params.recipient,\n            amount: numericAmount\n          },\n          currentPayment: {\n            type: 'exchange',\n            exchangeId\n          },\n          source: 'fund-from-exchange',\n          headless: false\n        }\n      });\n      return response;\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('is not supported')) {\n        throw new Error('Asset not supported');\n      }\n      throw new Error(error.message);\n    }\n  },\n  async handlePayWithExchange(exchangeId) {\n    try {\n      var _ChainController$getA;\n      const address = (_ChainController$getA = ChainController.getAccountData()) === null || _ChainController$getA === void 0 ? void 0 : _ChainController$getA.address;\n      if (!address) {\n        throw new Error('No account connected');\n      }\n      if (!state.paymentAsset) {\n        throw new Error('No payment asset selected');\n      }\n      const popupWindow = CoreHelperUtil.returnOpenHref('', 'popupWindow', 'scrollbar=yes,width=480,height=720');\n      if (!popupWindow) {\n        throw new Error('Could not create popup window');\n      }\n      state.isPaymentInProgress = true;\n      state.paymentId = crypto.randomUUID();\n      state.currentPayment = {\n        type: 'exchange',\n        exchangeId\n      };\n      const {\n        network,\n        asset\n      } = state.paymentAsset;\n      const payUrlParams = {\n        network,\n        asset,\n        amount: state.tokenAmount,\n        recipient: address\n      };\n      const payUrl = await ExchangeController.getPayUrl(exchangeId, payUrlParams);\n      if (!payUrl) {\n        try {\n          popupWindow.close();\n        } catch (err) {\n          // eslint-disable-next-line no-console\n          console.error('Unable to close popup window', err);\n        }\n        throw new Error('Unable to initiate payment');\n      }\n      state.currentPayment.sessionId = payUrl.sessionId;\n      state.currentPayment.status = 'IN_PROGRESS';\n      state.currentPayment.exchangeId = exchangeId;\n      popupWindow.location.href = payUrl.url;\n    } catch (error) {\n      state.error = 'Unable to initiate payment';\n      SnackController.showError(state.error);\n    }\n  },\n  async waitUntilComplete(_ref) {\n    let {\n      exchangeId,\n      sessionId,\n      paymentId,\n      retries = 20\n    } = _ref;\n    const status = await ExchangeController.getBuyStatus(exchangeId, sessionId, paymentId);\n    if (status.status === 'SUCCESS' || status.status === 'FAILED') {\n      return status;\n    }\n    if (retries === 0) {\n      throw new Error('Unable to get deposit status');\n    }\n    // Wait 5 seconds before checking again\n    await new Promise(resolve => {\n      setTimeout(resolve, 5000);\n    });\n    return ExchangeController.waitUntilComplete({\n      exchangeId,\n      sessionId,\n      paymentId,\n      retries: retries - 1\n    });\n  },\n  async getBuyStatus(exchangeId, sessionId, paymentId) {\n    try {\n      if (!state.currentPayment) {\n        throw new Error('No current payment');\n      }\n      const status = await getBuyStatus({\n        sessionId,\n        exchangeId\n      });\n      state.currentPayment.status = status.status;\n      if (status.status === 'SUCCESS' || status.status === 'FAILED') {\n        var _ChainController$getA2, _state$paymentAsset3, _state$paymentAsset4, _state$amount3, _state$currentPayment, _state$currentPayment2;\n        const address = (_ChainController$getA2 = ChainController.getAccountData()) === null || _ChainController$getA2 === void 0 ? void 0 : _ChainController$getA2.address;\n        state.currentPayment.result = status.txHash;\n        state.isPaymentInProgress = false;\n        EventsController.sendEvent({\n          type: 'track',\n          event: status.status === 'SUCCESS' ? 'PAY_SUCCESS' : 'PAY_ERROR',\n          properties: {\n            message: status.status === 'FAILED' ? CoreHelperUtil.parseError(state.error) : undefined,\n            source: 'fund-from-exchange',\n            paymentId,\n            configuration: {\n              network: ((_state$paymentAsset3 = state.paymentAsset) === null || _state$paymentAsset3 === void 0 ? void 0 : _state$paymentAsset3.network) || '',\n              asset: ((_state$paymentAsset4 = state.paymentAsset) === null || _state$paymentAsset4 === void 0 ? void 0 : _state$paymentAsset4.asset) || '',\n              recipient: address || '',\n              amount: (_state$amount3 = state.amount) !== null && _state$amount3 !== void 0 ? _state$amount3 : 0\n            },\n            currentPayment: {\n              type: 'exchange',\n              exchangeId: (_state$currentPayment = state.currentPayment) === null || _state$currentPayment === void 0 ? void 0 : _state$currentPayment.exchangeId,\n              sessionId: (_state$currentPayment2 = state.currentPayment) === null || _state$currentPayment2 === void 0 ? void 0 : _state$currentPayment2.sessionId,\n              result: status.txHash\n            }\n          }\n        });\n      }\n      return status;\n    } catch (error) {\n      return {\n        status: 'UNKNOWN',\n        txHash: ''\n      };\n    }\n  },\n  reset() {\n    state.currentPayment = undefined;\n    state.isPaymentInProgress = false;\n    state.paymentId = '';\n    state.paymentAsset = null;\n    state.amount = 0;\n    state.tokenAmount = 0;\n    state.priceLoading = false;\n    state.error = null;\n    state.exchanges = [];\n    state.isLoading = false;\n  }\n};","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","NumberUtil","getActiveNetworkTokenAddress","ConstantsUtil","CoreHelperUtil","formatCaip19Asset","getBuyStatus","getExchanges","getPayUrl","getPaymentAssetsForNetwork","BlockchainApiController","ChainController","EventsController","OptionsController","SnackController","DEFAULT_PAGE","DEFAULT_STATE","paymentAsset","amount","tokenAmount","priceLoading","error","exchanges","isLoading","currentPayment","undefined","isPaymentInProgress","paymentId","assets","state","ExchangeController","callback","key","resetState","Object","assign","_objectSpread","getAssetsForNetwork","network","metadata","getAssetsImageAndPrice","assetsWithPrice","map","asset","_assetMetadata$fungib","_assetMetadata$fungib2","assetAddress","concat","assetMetadata","find","m","_m$fungibles","fungibles","address","toLowerCase","price","iconUrl","addresses","Promise","all","fetchTokenPrice","getTokenAmount","_state$paymentAsset","_state$amount","Error","bigAmount","bigNumber","round","bigPrice","div","toNumber","setAmount","_state$paymentAsset2","setPaymentAsset","isPayWithExchangeEnabled","_OptionsController$st","_OptionsController$st2","_OptionsController$st3","remoteFeatures","payWithExchange","payments","features","pay","isPayWithExchangeSupported","activeCaipNetwork","PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES","includes","chainNamespace","fetchExchanges","_state$amount$toStrin","_state$amount2","response","page","toString","slice","showError","exchangeId","params","numericAmount","Number","recipient","sendEvent","type","event","properties","exchange","id","configuration","source","headless","message","handlePayWithExchange","_ChainController$getA","getAccountData","popupWindow","returnOpenHref","crypto","randomUUID","payUrlParams","payUrl","close","err","console","sessionId","status","location","href","url","waitUntilComplete","_ref","retries","resolve","setTimeout","_ChainController$getA2","_state$paymentAsset3","_state$paymentAsset4","_state$amount3","_state$currentPayment","_state$currentPayment2","result","txHash","parseError","reset"],"sources":["../../../../src/controllers/ExchangeController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}