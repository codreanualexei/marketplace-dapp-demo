{"ast":null,"code":"import { ApiController, ConnectorController, CoreHelperUtil, OptionsController, StorageUtil } from '@reown/appkit-controllers';\nimport { HelpersUtil } from '@reown/appkit-utils';\nimport { ConnectorUtil } from './ConnectorUtil.js';\nimport { ConstantsUtil } from './ConstantsUtil.js';\nexport const WalletUtil = {\n  filterOutDuplicatesByRDNS(wallets) {\n    const connectors = OptionsController.state.enableEIP6963 ? ConnectorController.state.connectors : [];\n    const recent = StorageUtil.getRecentWallets();\n    const connectorRDNSs = connectors.map(connector => connector.info?.rdns).filter(Boolean);\n    const recentRDNSs = recent.map(wallet => wallet.rdns).filter(Boolean);\n    const allRDNSs = connectorRDNSs.concat(recentRDNSs);\n    if (allRDNSs.includes('io.metamask.mobile') && CoreHelperUtil.isMobile()) {\n      const index = allRDNSs.indexOf('io.metamask.mobile');\n      allRDNSs[index] = 'io.metamask';\n    }\n    const filtered = wallets.filter(wallet => {\n      if (wallet?.rdns && allRDNSs.includes(String(wallet.rdns))) {\n        return false;\n      }\n      if (!wallet?.rdns) {\n        const hasMatchingConnectorName = connectors.some(connector => connector.name === wallet.name);\n        if (hasMatchingConnectorName) {\n          return false;\n        }\n      }\n      return true;\n    });\n    return filtered;\n  },\n  filterOutDuplicatesByIds(wallets) {\n    const connectors = ConnectorController.state.connectors.filter(connector => connector.type === 'ANNOUNCED' || connector.type === 'INJECTED');\n    const recent = StorageUtil.getRecentWallets();\n    const connectorIds = connectors.map(connector => connector.explorerId);\n    const recentIds = recent.map(wallet => wallet.id);\n    const allIds = connectorIds.concat(recentIds);\n    const filtered = wallets.filter(wallet => !allIds.includes(wallet?.id));\n    return filtered;\n  },\n  filterOutDuplicateWallets(wallets) {\n    const uniqueByRDNS = this.filterOutDuplicatesByRDNS(wallets);\n    const uniqueWallets = this.filterOutDuplicatesByIds(uniqueByRDNS);\n    return uniqueWallets;\n  },\n  markWalletsAsInstalled(wallets) {\n    const {\n      connectors\n    } = ConnectorController.state;\n    const {\n      featuredWalletIds\n    } = OptionsController.state;\n    const installedWalletRdnsMap = connectors.filter(connector => connector.type === 'ANNOUNCED').reduce((rdnsMap, connector) => {\n      if (!connector.info?.rdns) {\n        return rdnsMap;\n      }\n      rdnsMap[connector.info.rdns] = true;\n      return rdnsMap;\n    }, {});\n    const walletsWithInstallationStatus = wallets.map(wallet => ({\n      ...wallet,\n      installed: Boolean(wallet.rdns) && Boolean(installedWalletRdnsMap[wallet.rdns ?? ''])\n    }));\n    const sortedWallets = walletsWithInstallationStatus.sort((walletA, walletB) => {\n      const installationComparison = Number(walletB.installed) - Number(walletA.installed);\n      if (installationComparison !== 0) {\n        return installationComparison;\n      }\n      if (featuredWalletIds?.length) {\n        const walletAFeaturedIndex = featuredWalletIds.indexOf(walletA.id);\n        const walletBFeaturedIndex = featuredWalletIds.indexOf(walletB.id);\n        if (walletAFeaturedIndex !== -1 && walletBFeaturedIndex !== -1) {\n          return walletAFeaturedIndex - walletBFeaturedIndex;\n        }\n        if (walletAFeaturedIndex !== -1) {\n          return -1;\n        }\n        if (walletBFeaturedIndex !== -1) {\n          return 1;\n        }\n      }\n      return 0;\n    });\n    return sortedWallets;\n  },\n  getConnectOrderMethod(_features, _connectors) {\n    const connectMethodOrder = _features?.connectMethodsOrder || OptionsController.state.features?.connectMethodsOrder;\n    const connectors = _connectors || ConnectorController.state.connectors;\n    if (connectMethodOrder) {\n      return connectMethodOrder;\n    }\n    const {\n      injected,\n      announced\n    } = ConnectorUtil.getConnectorsByType(connectors, ApiController.state.recommended, ApiController.state.featured);\n    const shownInjected = injected.filter(ConnectorUtil.showConnector);\n    const shownAnnounced = announced.filter(ConnectorUtil.showConnector);\n    if (shownInjected.length || shownAnnounced.length) {\n      return ['wallet', 'email', 'social'];\n    }\n    return ConstantsUtil.DEFAULT_CONNECT_METHOD_ORDER;\n  },\n  isExcluded(wallet) {\n    const isRDNSExcluded = Boolean(wallet.rdns) && ApiController.state.excludedWallets.some(w => w.rdns === wallet.rdns);\n    const isNameExcluded = Boolean(wallet.name) && ApiController.state.excludedWallets.some(w => HelpersUtil.isLowerCaseMatch(w.name, wallet.name));\n    return isRDNSExcluded || isNameExcluded;\n  },\n  markWalletsWithDisplayIndex(wallets) {\n    return wallets.map((w, index) => ({\n      ...w,\n      display_index: index\n    }));\n  }\n};","map":{"version":3,"names":["ApiController","ConnectorController","CoreHelperUtil","OptionsController","StorageUtil","HelpersUtil","ConnectorUtil","ConstantsUtil","WalletUtil","filterOutDuplicatesByRDNS","wallets","connectors","state","enableEIP6963","recent","getRecentWallets","connectorRDNSs","map","connector","info","rdns","filter","Boolean","recentRDNSs","wallet","allRDNSs","concat","includes","isMobile","index","indexOf","filtered","String","hasMatchingConnectorName","some","name","filterOutDuplicatesByIds","type","connectorIds","explorerId","recentIds","id","allIds","filterOutDuplicateWallets","uniqueByRDNS","uniqueWallets","markWalletsAsInstalled","featuredWalletIds","installedWalletRdnsMap","reduce","rdnsMap","walletsWithInstallationStatus","installed","sortedWallets","sort","walletA","walletB","installationComparison","Number","length","walletAFeaturedIndex","walletBFeaturedIndex","getConnectOrderMethod","_features","_connectors","connectMethodOrder","connectMethodsOrder","features","injected","announced","getConnectorsByType","recommended","featured","shownInjected","showConnector","shownAnnounced","DEFAULT_CONNECT_METHOD_ORDER","isExcluded","isRDNSExcluded","excludedWallets","w","isNameExcluded","isLowerCaseMatch","markWalletsWithDisplayIndex","display_index"],"sources":["../../../../src/utils/WalletUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}