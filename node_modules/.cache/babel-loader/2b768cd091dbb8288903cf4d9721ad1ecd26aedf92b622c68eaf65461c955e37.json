{"ast":null,"code":"import _objectSpread from \"/Users/alex.codreanu/Desktop/marketplace-dapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { BlockchainApiController } from '../controllers/BlockchainApiController.js';\nimport { ChainController } from '../controllers/ChainController.js';\nimport { ConnectionController } from '../controllers/ConnectionController.js';\nimport { BalanceUtil } from './BalanceUtil.js';\nimport { getActiveNetworkTokenAddress } from './ChainControllerUtil.js';\n// -- Controller ---------------------------------------- //\nexport const SwapApiUtil = {\n  async getTokenList(caipNetworkId) {\n    var _response$tokens;\n    const response = await BlockchainApiController.fetchSwapTokens({\n      chainId: caipNetworkId\n    });\n    const tokens = (response === null || response === void 0 || (_response$tokens = response.tokens) === null || _response$tokens === void 0 ? void 0 : _response$tokens.map(token => _objectSpread(_objectSpread({}, token), {}, {\n      eip2612: false,\n      quantity: {\n        decimals: '0',\n        numeric: '0'\n      },\n      price: 0,\n      value: 0\n    }))) || [];\n    return tokens;\n  },\n  async fetchGasPrice() {\n    var _await$ConnectionCont;\n    const caipNetwork = ChainController.state.activeCaipNetwork;\n    if (!caipNetwork) {\n      return null;\n    }\n    try {\n      switch (caipNetwork.chainNamespace) {\n        case 'solana':\n          // eslint-disable-next-line no-case-declarations\n          const lamportsPerSignature = (_await$ConnectionCont = await (ConnectionController === null || ConnectionController === void 0 ? void 0 : ConnectionController.estimateGas({\n            chainNamespace: 'solana'\n          }))) === null || _await$ConnectionCont === void 0 ? void 0 : _await$ConnectionCont.toString();\n          return {\n            standard: lamportsPerSignature,\n            fast: lamportsPerSignature,\n            instant: lamportsPerSignature\n          };\n        case 'eip155':\n        default:\n          return await BlockchainApiController.fetchGasPrice({\n            chainId: caipNetwork.caipNetworkId\n          });\n      }\n    } catch (_unused) {\n      return null;\n    }\n  },\n  async fetchSwapAllowance(_ref) {\n    let {\n      tokenAddress,\n      userAddress,\n      sourceTokenAmount,\n      sourceTokenDecimals\n    } = _ref;\n    const response = await BlockchainApiController.fetchSwapAllowance({\n      tokenAddress,\n      userAddress\n    });\n    if (response !== null && response !== void 0 && response.allowance && sourceTokenAmount && sourceTokenDecimals) {\n      const parsedValue = ConnectionController.parseUnits(sourceTokenAmount, sourceTokenDecimals) || 0;\n      const hasAllowance = BigInt(response.allowance) >= parsedValue;\n      return hasAllowance;\n    }\n    return false;\n  },\n  async getMyTokensWithBalance(forceUpdate) {\n    const balances = await BalanceUtil.getMyTokensWithBalance(forceUpdate);\n    ChainController.setAccountProp('tokenBalance', balances, ChainController.state.activeChain);\n    return this.mapBalancesToSwapTokens(balances);\n  },\n  /**\n   * Maps the balances from Blockchain API to SwapTokenWithBalance array\n   * @param balances\n   * @returns SwapTokenWithBalance[]\n   */\n  mapBalancesToSwapTokens(balances) {\n    return (balances === null || balances === void 0 ? void 0 : balances.map(token => _objectSpread(_objectSpread({}, token), {}, {\n      address: token !== null && token !== void 0 && token.address ? token.address : getActiveNetworkTokenAddress(),\n      decimals: parseInt(token.quantity.decimals, 10),\n      logoUri: token.iconUrl,\n      eip2612: false\n    }))) || [];\n  },\n  async handleSwapError(error) {\n    try {\n      var _response$reasons;\n      const cause = error === null || error === void 0 ? void 0 : error.cause;\n      if (!(cause !== null && cause !== void 0 && cause.json)) {\n        return undefined;\n      }\n      const response = await cause.json();\n      const reason = response === null || response === void 0 || (_response$reasons = response.reasons) === null || _response$reasons === void 0 || (_response$reasons = _response$reasons[0]) === null || _response$reasons === void 0 ? void 0 : _response$reasons.description;\n      if (reason !== null && reason !== void 0 && reason.includes('insufficient liquidity')) {\n        return 'Insufficient liquidity';\n      }\n      return undefined;\n    } catch (_unused2) {\n      return undefined;\n    }\n  }\n};","map":{"version":3,"names":["BlockchainApiController","ChainController","ConnectionController","BalanceUtil","getActiveNetworkTokenAddress","SwapApiUtil","getTokenList","caipNetworkId","_response$tokens","response","fetchSwapTokens","chainId","tokens","map","token","_objectSpread","eip2612","quantity","decimals","numeric","price","value","fetchGasPrice","_await$ConnectionCont","caipNetwork","state","activeCaipNetwork","chainNamespace","lamportsPerSignature","estimateGas","toString","standard","fast","instant","_unused","fetchSwapAllowance","_ref","tokenAddress","userAddress","sourceTokenAmount","sourceTokenDecimals","allowance","parsedValue","parseUnits","hasAllowance","BigInt","getMyTokensWithBalance","forceUpdate","balances","setAccountProp","activeChain","mapBalancesToSwapTokens","address","parseInt","logoUri","iconUrl","handleSwapError","error","_response$reasons","cause","json","undefined","reason","reasons","description","includes","_unused2"],"sources":["../../../../src/utils/SwapApiUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}