{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { ConstantsUtil } from '@reown/appkit-common';\nimport { MELD_PUBLIC_KEY, ONRAMP_PROVIDERS } from '../utils/ConstantsUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { ApiController } from './ApiController.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { OptionsController } from './OptionsController.js';\nexport const USDC_CURRENCY_DEFAULT = {\n  id: '2b92315d-eab7-5bef-84fa-089a131333f5',\n  name: 'USD Coin',\n  symbol: 'USDC',\n  networks: [{\n    name: 'ethereum-mainnet',\n    display_name: 'Ethereum',\n    chain_id: '1',\n    contract_address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48'\n  }, {\n    name: 'polygon-mainnet',\n    display_name: 'Polygon',\n    chain_id: '137',\n    contract_address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174'\n  }]\n};\nexport const USD_CURRENCY_DEFAULT = {\n  id: 'USD',\n  payment_method_limits: [{\n    id: 'card',\n    min: '10.00',\n    max: '7500.00'\n  }, {\n    id: 'ach_bank_account',\n    min: '10.00',\n    max: '25000.00'\n  }]\n};\nconst defaultState = {\n  providers: ONRAMP_PROVIDERS,\n  selectedProvider: null,\n  error: null,\n  purchaseCurrency: USDC_CURRENCY_DEFAULT,\n  paymentCurrency: USD_CURRENCY_DEFAULT,\n  purchaseCurrencies: [USDC_CURRENCY_DEFAULT],\n  paymentCurrencies: [],\n  quotesLoading: false\n};\n// -- State --------------------------------------------- //\nconst state = proxy(defaultState);\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  setSelectedProvider(provider) {\n    if (provider && provider.name === 'meld') {\n      const activeChain = ChainController.state.activeChain;\n      const currency = activeChain === ConstantsUtil.CHAIN.SOLANA ? 'SOL' : 'USDC';\n      const address = activeChain ? ChainController.state.chains.get(activeChain)?.accountState?.address ?? '' : '';\n      const url = new URL(provider.url);\n      url.searchParams.append('publicKey', MELD_PUBLIC_KEY);\n      url.searchParams.append('destinationCurrencyCode', currency);\n      url.searchParams.append('walletAddress', address);\n      url.searchParams.append('externalCustomerId', OptionsController.state.projectId);\n      state.selectedProvider = {\n        ...provider,\n        url: url.toString()\n      };\n    } else {\n      state.selectedProvider = provider;\n    }\n  },\n  setOnrampProviders(providers) {\n    if (Array.isArray(providers) && providers.every(item => typeof item === 'string')) {\n      const validOnramp = providers;\n      const newProviders = ONRAMP_PROVIDERS.filter(provider => validOnramp.includes(provider.name));\n      state.providers = newProviders;\n    } else {\n      state.providers = [];\n    }\n  },\n  setPurchaseCurrency(currency) {\n    state.purchaseCurrency = currency;\n  },\n  setPaymentCurrency(currency) {\n    state.paymentCurrency = currency;\n  },\n  setPurchaseAmount(amount) {\n    OnRampController.state.purchaseAmount = amount;\n  },\n  setPaymentAmount(amount) {\n    OnRampController.state.paymentAmount = amount;\n  },\n  async getAvailableCurrencies() {\n    const options = await BlockchainApiController.getOnrampOptions();\n    state.purchaseCurrencies = options.purchaseCurrencies;\n    state.paymentCurrencies = options.paymentCurrencies;\n    state.paymentCurrency = options.paymentCurrencies[0] || USD_CURRENCY_DEFAULT;\n    state.purchaseCurrency = options.purchaseCurrencies[0] || USDC_CURRENCY_DEFAULT;\n    await ApiController.fetchCurrencyImages(options.paymentCurrencies.map(currency => currency.id));\n    await ApiController.fetchTokenImages(options.purchaseCurrencies.map(currency => currency.symbol));\n  },\n  async getQuote() {\n    state.quotesLoading = true;\n    try {\n      const quote = await BlockchainApiController.getOnrampQuote({\n        purchaseCurrency: state.purchaseCurrency,\n        paymentCurrency: state.paymentCurrency,\n        amount: state.paymentAmount?.toString() || '0',\n        network: state.purchaseCurrency?.symbol\n      });\n      state.quotesLoading = false;\n      state.purchaseAmount = Number(quote?.purchaseAmount.amount);\n      return quote;\n    } catch (error) {\n      state.error = error.message;\n      state.quotesLoading = false;\n      return null;\n    } finally {\n      state.quotesLoading = false;\n    }\n  },\n  resetState() {\n    state.selectedProvider = null;\n    state.error = null;\n    state.purchaseCurrency = USDC_CURRENCY_DEFAULT;\n    state.paymentCurrency = USD_CURRENCY_DEFAULT;\n    state.purchaseCurrencies = [USDC_CURRENCY_DEFAULT];\n    state.paymentCurrencies = [];\n    state.paymentAmount = undefined;\n    state.purchaseAmount = undefined;\n    state.quotesLoading = false;\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const OnRampController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","ConstantsUtil","MELD_PUBLIC_KEY","ONRAMP_PROVIDERS","withErrorBoundary","ApiController","BlockchainApiController","ChainController","OptionsController","USDC_CURRENCY_DEFAULT","id","name","symbol","networks","display_name","chain_id","contract_address","USD_CURRENCY_DEFAULT","payment_method_limits","min","max","defaultState","providers","selectedProvider","error","purchaseCurrency","paymentCurrency","purchaseCurrencies","paymentCurrencies","quotesLoading","state","controller","callback","key","setSelectedProvider","provider","activeChain","currency","CHAIN","SOLANA","address","chains","get","accountState","url","URL","searchParams","append","projectId","toString","setOnrampProviders","Array","isArray","every","item","validOnramp","newProviders","filter","includes","setPurchaseCurrency","setPaymentCurrency","setPurchaseAmount","amount","OnRampController","purchaseAmount","setPaymentAmount","paymentAmount","getAvailableCurrencies","options","getOnrampOptions","fetchCurrencyImages","map","fetchTokenImages","getQuote","quote","getOnrampQuote","network","Number","message","resetState","undefined"],"sources":["../../../../src/controllers/OnRampController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}