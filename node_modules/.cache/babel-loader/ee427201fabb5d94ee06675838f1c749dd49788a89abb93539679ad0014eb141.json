{"ast":null,"code":"/* eslint-disable no-console */\nimport { proxy, ref, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { ConstantsUtil as CommonConstantsUtil, ParseUtil } from '@reown/appkit-common';\nimport { getPreferredAccountType } from '../utils/ChainControllerUtil.js';\nimport { ConnectionControllerUtil } from '../utils/ConnectionControllerUtil.js';\nimport { ConnectorControllerUtil } from '../utils/ConnectorControllerUtil.js';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { StorageUtil } from '../utils/StorageUtil.js';\nimport { AppKitError, withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { EventsController } from './EventsController.js';\nimport { ModalController } from './ModalController.js';\nimport { RouterController } from './RouterController.js';\nimport { TransactionsController } from './TransactionsController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  connections: new Map(),\n  recentConnections: new Map(),\n  isSwitchingConnection: false,\n  wcError: false,\n  buffering: false,\n  status: 'disconnected'\n});\n// eslint-disable-next-line init-declarations\nlet wcConnectionPromise;\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  _getClient() {\n    return state._client;\n  },\n  setClient(client) {\n    state._client = ref(client);\n  },\n  initialize(adapters) {\n    const namespaces = adapters.filter(a => Boolean(a.namespace)).map(a => a.namespace);\n    ConnectionController.syncStorageConnections(namespaces);\n  },\n  syncStorageConnections(namespaces) {\n    const storageConnections = StorageUtil.getConnections();\n    const namespacesToSync = namespaces ?? Array.from(ChainController.state.chains.keys());\n    for (const namespace of namespacesToSync) {\n      const storageConnectionsByNamespace = storageConnections[namespace] ?? [];\n      const recentConnectionsMap = new Map(state.recentConnections);\n      recentConnectionsMap.set(namespace, storageConnectionsByNamespace);\n      state.recentConnections = recentConnectionsMap;\n    }\n  },\n  getConnections(namespace) {\n    return namespace ? state.connections.get(namespace) ?? [] : [];\n  },\n  hasAnyConnection(connectorId) {\n    const connections = ConnectionController.state.connections;\n    return Array.from(connections.values()).flatMap(_connections => _connections).some(({\n      connectorId: _connectorId\n    }) => _connectorId === connectorId);\n  },\n  async connectWalletConnect({\n    cache = 'auto'\n  } = {}) {\n    const isInTelegramOrSafariIos = CoreHelperUtil.isTelegram() || CoreHelperUtil.isSafari() && CoreHelperUtil.isIos();\n    if (cache === 'always' || cache === 'auto' && isInTelegramOrSafariIos) {\n      if (wcConnectionPromise) {\n        await wcConnectionPromise;\n        wcConnectionPromise = undefined;\n        return;\n      }\n      if (!CoreHelperUtil.isPairingExpired(state?.wcPairingExpiry)) {\n        const link = state.wcUri;\n        state.wcUri = link;\n        return;\n      }\n      wcConnectionPromise = ConnectionController._getClient()?.connectWalletConnect?.().catch(() => undefined);\n      ConnectionController.state.status = 'connecting';\n      await wcConnectionPromise;\n      wcConnectionPromise = undefined;\n      state.wcPairingExpiry = undefined;\n      ConnectionController.state.status = 'connected';\n    } else {\n      await ConnectionController._getClient()?.connectWalletConnect?.();\n    }\n  },\n  async connectExternal(options, chain, setChain = true) {\n    const connectData = await ConnectionController._getClient()?.connectExternal?.(options);\n    if (setChain) {\n      ChainController.setActiveNamespace(chain);\n    }\n    return connectData;\n  },\n  async reconnectExternal(options) {\n    await ConnectionController._getClient()?.reconnectExternal?.(options);\n    const namespace = options.chain || ChainController.state.activeChain;\n    if (namespace) {\n      ConnectorController.setConnectorId(options.id, namespace);\n    }\n  },\n  async setPreferredAccountType(accountType, namespace) {\n    if (!namespace) {\n      return;\n    }\n    ModalController.setLoading(true, ChainController.state.activeChain);\n    const authConnector = ConnectorController.getAuthConnector();\n    if (!authConnector) {\n      return;\n    }\n    ChainController.setAccountProp('preferredAccountType', accountType, namespace);\n    await authConnector.provider.setPreferredAccount(accountType);\n    StorageUtil.setPreferredAccountTypes(Object.entries(ChainController.state.chains).reduce((acc, [key, _]) => {\n      const namespace = key;\n      const accountType = getPreferredAccountType(namespace);\n      if (accountType !== undefined) {\n        ;\n        acc[namespace] = accountType;\n      }\n      return acc;\n    }, {}));\n    await ConnectionController.reconnectExternal(authConnector);\n    ModalController.setLoading(false, ChainController.state.activeChain);\n    EventsController.sendEvent({\n      type: 'track',\n      event: 'SET_PREFERRED_ACCOUNT_TYPE',\n      properties: {\n        accountType,\n        network: ChainController.state.activeCaipNetwork?.caipNetworkId || ''\n      }\n    });\n  },\n  async signMessage(message) {\n    return ConnectionController._getClient()?.signMessage(message);\n  },\n  parseUnits(value, decimals) {\n    return ConnectionController._getClient()?.parseUnits(value, decimals);\n  },\n  formatUnits(value, decimals) {\n    return ConnectionController._getClient()?.formatUnits(value, decimals);\n  },\n  updateBalance(namespace) {\n    return ConnectionController._getClient()?.updateBalance(namespace);\n  },\n  async sendTransaction(args) {\n    return ConnectionController._getClient()?.sendTransaction(args);\n  },\n  async getCapabilities(params) {\n    return ConnectionController._getClient()?.getCapabilities(params);\n  },\n  async grantPermissions(params) {\n    return ConnectionController._getClient()?.grantPermissions(params);\n  },\n  async walletGetAssets(params) {\n    return ConnectionController._getClient()?.walletGetAssets(params) ?? {};\n  },\n  async estimateGas(args) {\n    return ConnectionController._getClient()?.estimateGas(args);\n  },\n  async writeContract(args) {\n    return ConnectionController._getClient()?.writeContract(args);\n  },\n  async getEnsAddress(value) {\n    return ConnectionController._getClient()?.getEnsAddress(value);\n  },\n  async getEnsAvatar(value) {\n    return ConnectionController._getClient()?.getEnsAvatar(value);\n  },\n  checkInstalled(ids) {\n    return ConnectionController._getClient()?.checkInstalled?.(ids) || false;\n  },\n  resetWcConnection() {\n    state.wcUri = undefined;\n    state.wcPairingExpiry = undefined;\n    state.wcLinking = undefined;\n    state.recentWallet = undefined;\n    state.status = 'disconnected';\n    TransactionsController.resetTransactions();\n    StorageUtil.deleteWalletConnectDeepLink();\n    StorageUtil.deleteRecentWallet();\n  },\n  resetUri() {\n    state.wcUri = undefined;\n    state.wcPairingExpiry = undefined;\n    wcConnectionPromise = undefined;\n  },\n  finalizeWcConnection(address) {\n    const {\n      wcLinking,\n      recentWallet\n    } = ConnectionController.state;\n    if (wcLinking) {\n      StorageUtil.setWalletConnectDeepLink(wcLinking);\n    }\n    if (recentWallet) {\n      StorageUtil.setAppKitRecent(recentWallet);\n    }\n    if (address) {\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'CONNECT_SUCCESS',\n        address,\n        properties: {\n          method: wcLinking ? 'mobile' : 'qrcode',\n          name: RouterController.state.data?.wallet?.name || 'Unknown',\n          view: RouterController.state.view,\n          walletRank: recentWallet?.order\n        }\n      });\n    }\n  },\n  setWcBasic(wcBasic) {\n    state.wcBasic = wcBasic;\n  },\n  setUri(uri) {\n    state.wcUri = uri;\n    state.wcPairingExpiry = CoreHelperUtil.getPairingExpiry();\n  },\n  setWcLinking(wcLinking) {\n    state.wcLinking = wcLinking;\n  },\n  setWcError(wcError) {\n    state.wcError = wcError;\n    state.buffering = false;\n  },\n  setRecentWallet(wallet) {\n    state.recentWallet = wallet;\n  },\n  setBuffering(buffering) {\n    state.buffering = buffering;\n  },\n  setStatus(status) {\n    state.status = status;\n  },\n  setIsSwitchingConnection(isSwitchingConnection) {\n    state.isSwitchingConnection = isSwitchingConnection;\n  },\n  async disconnect({\n    id,\n    namespace,\n    initialDisconnect\n  } = {}) {\n    try {\n      await ConnectionController._getClient()?.disconnect({\n        id,\n        chainNamespace: namespace,\n        initialDisconnect\n      });\n    } catch (error) {\n      throw new AppKitError('Failed to disconnect', 'INTERNAL_SDK_ERROR', error);\n    }\n  },\n  async disconnectConnector({\n    id,\n    namespace\n  }) {\n    try {\n      await ConnectionController._getClient()?.disconnectConnector({\n        id,\n        namespace\n      });\n    } catch (error) {\n      throw new AppKitError('Failed to disconnect connector', 'INTERNAL_SDK_ERROR', error);\n    }\n  },\n  setConnections(connections, chainNamespace) {\n    const connectionsMap = new Map(state.connections);\n    connectionsMap.set(chainNamespace, connections);\n    state.connections = connectionsMap;\n  },\n  async handleAuthAccountSwitch({\n    address,\n    namespace\n  }) {\n    const accountData = ChainController.getAccountData(namespace);\n    const smartAccount = accountData?.user?.accounts?.find(c => c.type === 'smartAccount');\n    const accountType = smartAccount && smartAccount.address.toLowerCase() === address.toLowerCase() && ConnectorControllerUtil.canSwitchToSmartAccount(namespace) ? 'smartAccount' : 'eoa';\n    await ConnectionController.setPreferredAccountType(accountType, namespace);\n  },\n  async handleActiveConnection({\n    connection,\n    namespace,\n    address\n  }) {\n    const connector = ConnectorController.getConnectorById(connection.connectorId);\n    const isAuthConnector = connection.connectorId === CommonConstantsUtil.CONNECTOR_ID.AUTH;\n    if (!connector) {\n      throw new Error(`No connector found for connection: ${connection.connectorId}`);\n    }\n    if (!isAuthConnector) {\n      const connectData = await ConnectionController.connectExternal({\n        id: connector.id,\n        type: connector.type,\n        provider: connector.provider,\n        address,\n        chain: namespace\n      }, namespace);\n      return connectData?.address;\n    } else if (isAuthConnector && address) {\n      await ConnectionController.handleAuthAccountSwitch({\n        address,\n        namespace\n      });\n    }\n    return address;\n  },\n  async handleDisconnectedConnection({\n    connection,\n    namespace,\n    address,\n    closeModalOnConnect\n  }) {\n    const connector = ConnectorController.getConnectorById(connection.connectorId);\n    const authName = connection.auth?.name?.toLowerCase();\n    const isAuthConnector = connection.connectorId === CommonConstantsUtil.CONNECTOR_ID.AUTH;\n    const isWCConnector = connection.connectorId === CommonConstantsUtil.CONNECTOR_ID.WALLET_CONNECT;\n    if (!connector) {\n      throw new Error(`No connector found for connection: ${connection.connectorId}`);\n    }\n    let newAddress = undefined;\n    if (isAuthConnector) {\n      if (authName && ConnectorControllerUtil.isSocialProvider(authName)) {\n        const {\n          address: socialAddress\n        } = await ConnectorControllerUtil.connectSocial({\n          social: authName,\n          closeModalOnConnect,\n          onOpenFarcaster() {\n            ModalController.open({\n              view: 'ConnectingFarcaster'\n            });\n          },\n          onConnect() {\n            RouterController.replace('ProfileWallets');\n          }\n        });\n        newAddress = socialAddress;\n      } else {\n        const {\n          address: emailAddress\n        } = await ConnectorControllerUtil.connectEmail({\n          closeModalOnConnect,\n          onOpen() {\n            ModalController.open({\n              view: 'EmailLogin'\n            });\n          },\n          onConnect() {\n            RouterController.replace('ProfileWallets');\n          }\n        });\n        newAddress = emailAddress;\n      }\n    } else if (isWCConnector) {\n      const {\n        address: wcAddress\n      } = await ConnectorControllerUtil.connectWalletConnect({\n        walletConnect: true,\n        connector,\n        closeModalOnConnect,\n        onOpen(isMobile) {\n          const view = isMobile ? 'AllWallets' : 'ConnectingWalletConnect';\n          if (ModalController.state.open) {\n            RouterController.push(view);\n          } else {\n            ModalController.open({\n              view\n            });\n          }\n        },\n        onConnect() {\n          RouterController.replace('ProfileWallets');\n        }\n      });\n      newAddress = wcAddress;\n    } else {\n      const connectData = await ConnectionController.connectExternal({\n        id: connector.id,\n        type: connector.type,\n        provider: connector.provider,\n        chain: namespace\n      }, namespace);\n      if (connectData) {\n        newAddress = connectData.address;\n      }\n    }\n    if (isAuthConnector && address) {\n      await ConnectionController.handleAuthAccountSwitch({\n        address,\n        namespace\n      });\n    }\n    return newAddress;\n  },\n  async switchConnection({\n    connection,\n    address,\n    namespace,\n    closeModalOnConnect,\n    onChange\n  }) {\n    let currentAddress = undefined;\n    const caipAddress = ChainController.getAccountData(namespace)?.caipAddress;\n    if (caipAddress) {\n      const {\n        address: currentAddressParsed\n      } = ParseUtil.parseCaipAddress(caipAddress);\n      currentAddress = currentAddressParsed;\n    }\n    const status = ConnectionControllerUtil.getConnectionStatus(connection, namespace);\n    switch (status) {\n      case 'connected':\n      case 'active':\n        {\n          const newAddress = await ConnectionController.handleActiveConnection({\n            connection,\n            namespace,\n            address\n          });\n          if (currentAddress && newAddress) {\n            const hasSwitchedAccount = newAddress.toLowerCase() !== currentAddress.toLowerCase();\n            onChange?.({\n              address: newAddress,\n              namespace,\n              hasSwitchedAccount,\n              hasSwitchedWallet: status === 'active'\n            });\n          }\n          break;\n        }\n      case 'disconnected':\n        {\n          const newAddress = await ConnectionController.handleDisconnectedConnection({\n            connection,\n            namespace,\n            address,\n            closeModalOnConnect\n          });\n          if (newAddress) {\n            onChange?.({\n              address: newAddress,\n              namespace,\n              hasSwitchedAccount: true,\n              hasSwitchedWallet: true\n            });\n          }\n          break;\n        }\n      default:\n        throw new Error(`Invalid connection status: ${status}`);\n    }\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const ConnectionController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","ref","subscribe","sub","subscribeKey","subKey","ConstantsUtil","CommonConstantsUtil","ParseUtil","getPreferredAccountType","ConnectionControllerUtil","ConnectorControllerUtil","CoreHelperUtil","StorageUtil","AppKitError","withErrorBoundary","ChainController","ConnectorController","EventsController","ModalController","RouterController","TransactionsController","state","connections","Map","recentConnections","isSwitchingConnection","wcError","buffering","status","wcConnectionPromise","controller","callback","key","_getClient","_client","setClient","client","initialize","adapters","namespaces","filter","a","Boolean","namespace","map","ConnectionController","syncStorageConnections","storageConnections","getConnections","namespacesToSync","Array","from","chains","keys","storageConnectionsByNamespace","recentConnectionsMap","set","get","hasAnyConnection","connectorId","values","flatMap","_connections","some","_connectorId","connectWalletConnect","cache","isInTelegramOrSafariIos","isTelegram","isSafari","isIos","undefined","isPairingExpired","wcPairingExpiry","link","wcUri","catch","connectExternal","options","chain","setChain","connectData","setActiveNamespace","reconnectExternal","activeChain","setConnectorId","id","setPreferredAccountType","accountType","setLoading","authConnector","getAuthConnector","setAccountProp","provider","setPreferredAccount","setPreferredAccountTypes","Object","entries","reduce","acc","_","sendEvent","type","event","properties","network","activeCaipNetwork","caipNetworkId","signMessage","message","parseUnits","value","decimals","formatUnits","updateBalance","sendTransaction","args","getCapabilities","params","grantPermissions","walletGetAssets","estimateGas","writeContract","getEnsAddress","getEnsAvatar","checkInstalled","ids","resetWcConnection","wcLinking","recentWallet","resetTransactions","deleteWalletConnectDeepLink","deleteRecentWallet","resetUri","finalizeWcConnection","address","setWalletConnectDeepLink","setAppKitRecent","method","name","data","wallet","view","walletRank","order","setWcBasic","wcBasic","setUri","uri","getPairingExpiry","setWcLinking","setWcError","setRecentWallet","setBuffering","setStatus","setIsSwitchingConnection","disconnect","initialDisconnect","chainNamespace","error","disconnectConnector","setConnections","connectionsMap","handleAuthAccountSwitch","accountData","getAccountData","smartAccount","user","accounts","find","c","toLowerCase","canSwitchToSmartAccount","handleActiveConnection","connection","connector","getConnectorById","isAuthConnector","CONNECTOR_ID","AUTH","Error","handleDisconnectedConnection","closeModalOnConnect","authName","auth","isWCConnector","WALLET_CONNECT","newAddress","isSocialProvider","socialAddress","connectSocial","social","onOpenFarcaster","open","onConnect","replace","emailAddress","connectEmail","onOpen","wcAddress","walletConnect","isMobile","push","switchConnection","onChange","currentAddress","caipAddress","currentAddressParsed","parseCaipAddress","getConnectionStatus","hasSwitchedAccount","hasSwitchedWallet"],"sources":["../../../../src/controllers/ConnectionController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}