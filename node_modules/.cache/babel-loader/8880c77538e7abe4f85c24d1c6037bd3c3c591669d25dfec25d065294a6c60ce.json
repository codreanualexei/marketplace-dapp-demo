{"ast":null,"code":"import bs58 from 'bs58';\nimport { toHex } from 'viem';\nimport { ConstantsUtil } from '@reown/appkit-common';\nimport { ChainController, ConstantsUtil as CoreConstantsUtil, CoreHelperUtil } from '@reown/appkit-controllers';\nimport { AdapterBlueprint } from '../adapters/ChainAdapterBlueprint.js';\nimport { WalletConnectConnector } from '../connectors/WalletConnectConnector.js';\nimport { WcConstantsUtil } from '../utils/ConstantsUtil.js';\nexport class UniversalAdapter extends AdapterBlueprint {\n  async setUniversalProvider(universalProvider) {\n    if (!this.namespace) {\n      throw new Error('UniversalAdapter:setUniversalProvider - namespace is required');\n    }\n    this.addConnector(new WalletConnectConnector({\n      provider: universalProvider,\n      caipNetworks: this.getCaipNetworks(),\n      namespace: this.namespace\n    }));\n    return Promise.resolve();\n  }\n  async connect(params) {\n    return Promise.resolve({\n      id: 'WALLET_CONNECT',\n      type: 'WALLET_CONNECT',\n      chainId: Number(params.chainId),\n      provider: this.provider,\n      address: ''\n    });\n  }\n  async disconnect() {\n    try {\n      const connector = this.getWalletConnectConnector();\n      await connector.disconnect();\n      this.emit('disconnect');\n    } catch (error) {\n      console.warn('UniversalAdapter:disconnect - error', error);\n    }\n    return {\n      connections: []\n    };\n  }\n  syncConnections() {\n    return Promise.resolve();\n  }\n  async getAccounts({\n    namespace\n  }) {\n    const provider = this.provider;\n    const addresses = provider?.session?.namespaces?.[namespace]?.accounts?.map(account => {\n      const [,, address] = account.split(':');\n      return address;\n    }).filter((address, index, self) => self.indexOf(address) === index) || [];\n    return Promise.resolve({\n      accounts: addresses.map(address => CoreHelperUtil.createAccount(namespace, address, namespace === 'bip122' ? 'payment' : 'eoa'))\n    });\n  }\n  async syncConnectors() {\n    return Promise.resolve();\n  }\n  async getBalance(params) {\n    const isBalanceSupported = params.caipNetwork && CoreConstantsUtil.BALANCE_SUPPORTED_CHAINS.includes(params.caipNetwork?.chainNamespace);\n    if (!isBalanceSupported || params.caipNetwork?.testnet) {\n      return {\n        balance: '0.00',\n        symbol: params.caipNetwork?.nativeCurrency.symbol || ''\n      };\n    }\n    const accountData = ChainController.getAccountData();\n    if (accountData?.balanceLoading && params.chainId === ChainController.state.activeCaipNetwork?.id) {\n      return {\n        balance: accountData?.balance || '0.00',\n        symbol: accountData?.balanceSymbol || ''\n      };\n    }\n    const balances = await ChainController.fetchTokenBalance();\n    const balance = balances.find(b => b.chainId === `${params.caipNetwork?.chainNamespace}:${params.chainId}` && b.symbol === params.caipNetwork?.nativeCurrency.symbol);\n    return {\n      balance: balance?.quantity.numeric || '0.00',\n      symbol: balance?.symbol || params.caipNetwork?.nativeCurrency.symbol || ''\n    };\n  }\n  async signMessage(params) {\n    const {\n      provider,\n      message,\n      address\n    } = params;\n    if (!provider) {\n      throw new Error('UniversalAdapter:signMessage - provider is undefined');\n    }\n    let signature = '';\n    if (ChainController.state.activeCaipNetwork?.chainNamespace === ConstantsUtil.CHAIN.SOLANA) {\n      const response = await provider.request({\n        method: 'solana_signMessage',\n        params: {\n          message: bs58.encode(new TextEncoder().encode(message)),\n          pubkey: address\n        }\n      }, ChainController.state.activeCaipNetwork?.caipNetworkId);\n      signature = response.signature;\n    } else {\n      signature = await provider.request({\n        method: 'personal_sign',\n        params: [message, address]\n      }, ChainController.state.activeCaipNetwork?.caipNetworkId);\n    }\n    return {\n      signature\n    };\n  }\n  // -- Transaction methods ---------------------------------------------------\n  /**\n   *\n   * These methods are supported only on `wagmi` and `ethers` since the Solana SDK does not support them in the same way.\n   * These function definition is to have a type parity between the clients. Currently not in use.\n   */\n  async estimateGas() {\n    return Promise.resolve({\n      gas: BigInt(0)\n    });\n  }\n  async sendTransaction() {\n    return Promise.resolve({\n      hash: ''\n    });\n  }\n  walletGetAssets(_params) {\n    return Promise.resolve({});\n  }\n  async writeContract() {\n    return Promise.resolve({\n      hash: ''\n    });\n  }\n  emitFirstAvailableConnection() {\n    return undefined;\n  }\n  parseUnits() {\n    return 0n;\n  }\n  formatUnits() {\n    return '0';\n  }\n  async getCapabilities() {\n    return Promise.resolve({});\n  }\n  async grantPermissions() {\n    return Promise.resolve({});\n  }\n  async revokePermissions() {\n    return Promise.resolve('0x');\n  }\n  async syncConnection() {\n    return Promise.resolve({\n      id: 'WALLET_CONNECT',\n      type: 'WALLET_CONNECT',\n      chainId: 1,\n      provider: this.provider,\n      address: ''\n    });\n  }\n  // eslint-disable-next-line @typescript-eslint/require-await\n  async switchNetwork(params) {\n    const {\n      caipNetwork\n    } = params;\n    const connector = this.getWalletConnectConnector();\n    if (caipNetwork.chainNamespace === ConstantsUtil.CHAIN.EVM) {\n      try {\n        await connector.provider?.request({\n          method: 'wallet_switchEthereumChain',\n          params: [{\n            chainId: toHex(caipNetwork.id)\n          }]\n        });\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      } catch (switchError) {\n        if (switchError.code === WcConstantsUtil.ERROR_CODE_UNRECOGNIZED_CHAIN_ID || switchError.code === WcConstantsUtil.ERROR_INVALID_CHAIN_ID || switchError.code === WcConstantsUtil.ERROR_CODE_DEFAULT || switchError?.data?.originalError?.code === WcConstantsUtil.ERROR_CODE_UNRECOGNIZED_CHAIN_ID) {\n          try {\n            await connector.provider?.request({\n              method: 'wallet_addEthereumChain',\n              params: [{\n                chainId: toHex(caipNetwork.id),\n                rpcUrls: [caipNetwork?.rpcUrls['chainDefault']?.http],\n                chainName: caipNetwork.name,\n                nativeCurrency: caipNetwork.nativeCurrency,\n                blockExplorerUrls: [caipNetwork.blockExplorers?.default.url]\n              }]\n            });\n          } catch (error) {\n            throw new Error('Chain is not supported');\n          }\n        }\n      }\n    }\n    connector.provider.setDefaultChain(caipNetwork.caipNetworkId);\n  }\n  getWalletConnectProvider() {\n    const connector = this.connectors.find(c => c.type === 'WALLET_CONNECT');\n    const provider = connector?.provider;\n    return provider;\n  }\n}","map":{"version":3,"names":["bs58","toHex","ConstantsUtil","ChainController","CoreConstantsUtil","CoreHelperUtil","AdapterBlueprint","WalletConnectConnector","WcConstantsUtil","UniversalAdapter","setUniversalProvider","universalProvider","namespace","Error","addConnector","provider","caipNetworks","getCaipNetworks","Promise","resolve","connect","params","id","type","chainId","Number","address","disconnect","connector","getWalletConnectConnector","emit","error","console","warn","connections","syncConnections","getAccounts","addresses","session","namespaces","accounts","map","account","split","filter","index","self","indexOf","createAccount","syncConnectors","getBalance","isBalanceSupported","caipNetwork","BALANCE_SUPPORTED_CHAINS","includes","chainNamespace","testnet","balance","symbol","nativeCurrency","accountData","getAccountData","balanceLoading","state","activeCaipNetwork","balanceSymbol","balances","fetchTokenBalance","find","b","quantity","numeric","signMessage","message","signature","CHAIN","SOLANA","response","request","method","encode","TextEncoder","pubkey","caipNetworkId","estimateGas","gas","BigInt","sendTransaction","hash","walletGetAssets","_params","writeContract","emitFirstAvailableConnection","undefined","parseUnits","formatUnits","getCapabilities","grantPermissions","revokePermissions","syncConnection","switchNetwork","EVM","switchError","code","ERROR_CODE_UNRECOGNIZED_CHAIN_ID","ERROR_INVALID_CHAIN_ID","ERROR_CODE_DEFAULT","data","originalError","rpcUrls","http","chainName","name","blockExplorerUrls","blockExplorers","default","url","setDefaultChain","getWalletConnectProvider","connectors","c"],"sources":["../../../../src/universal-adapter/client.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}