{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport '@reown/appkit-common';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { NetworkUtil } from '../utils/NetworkUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { ApiController } from './ApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectionController } from './ConnectionController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { EventsController } from './EventsController.js';\nimport { OptionsController } from './OptionsController.js';\nimport { PublicStateController } from './PublicStateController.js';\nimport { RouterController } from './RouterController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  loading: false,\n  loadingNamespaceMap: new Map(),\n  open: false,\n  shake: false,\n  namespace: undefined\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  async open(options) {\n    const namespace = options?.namespace;\n    const currentNamespace = ChainController.state.activeChain;\n    const isSwitchingNamespace = namespace && namespace !== currentNamespace;\n    const caipAddress = ChainController.getAccountData(options?.namespace)?.caipAddress;\n    const hasNoAdapters = ChainController.state.noAdapters;\n    if (ConnectionController.state.wcBasic) {\n      // No need to add an await here if we are use basic\n      ApiController.prefetch({\n        fetchNetworkImages: false,\n        fetchConnectorImages: false,\n        fetchWalletRanks: false\n      });\n    } else {\n      await ApiController.prefetch();\n    }\n    ConnectorController.setFilterByNamespace(options?.namespace);\n    ModalController.setLoading(true, namespace);\n    if (namespace && isSwitchingNamespace) {\n      const namespaceNetwork = ChainController.getNetworkData(namespace)?.caipNetwork || ChainController.getRequestedCaipNetworks(namespace)[0];\n      if (namespaceNetwork) {\n        if (hasNoAdapters) {\n          await ChainController.switchActiveNetwork(namespaceNetwork);\n          RouterController.push('ConnectingWalletConnectBasic');\n        } else {\n          NetworkUtil.onSwitchNetwork({\n            network: namespaceNetwork,\n            ignoreSwitchConfirmation: true\n          });\n        }\n      }\n    } else if (OptionsController.state.manualWCControl || hasNoAdapters && !caipAddress) {\n      if (CoreHelperUtil.isMobile()) {\n        RouterController.reset('AllWallets');\n      } else {\n        RouterController.reset('ConnectingWalletConnectBasic');\n      }\n    } else if (options?.view) {\n      RouterController.reset(options.view, options.data);\n    } else if (caipAddress) {\n      RouterController.reset('Account');\n    } else {\n      RouterController.reset('Connect');\n    }\n    state.open = true;\n    PublicStateController.set({\n      open: true\n    });\n    EventsController.sendEvent({\n      type: 'track',\n      event: 'MODAL_OPEN',\n      properties: {\n        connected: Boolean(caipAddress)\n      }\n    });\n  },\n  close() {\n    const isEmbeddedEnabled = OptionsController.state.enableEmbedded;\n    const isConnected = Boolean(ChainController.state.activeCaipAddress);\n    // Only send the event if the modal is open and is about to be closed\n    if (state.open) {\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'MODAL_CLOSE',\n        properties: {\n          connected: isConnected\n        }\n      });\n    }\n    state.open = false;\n    RouterController.reset('Connect');\n    ModalController.clearLoading();\n    if (isEmbeddedEnabled) {\n      if (isConnected) {\n        RouterController.replace('Account');\n      } else {\n        RouterController.push('Connect');\n      }\n    } else {\n      PublicStateController.set({\n        open: false\n      });\n    }\n    ConnectionController.resetUri();\n  },\n  setLoading(loading, namespace) {\n    if (namespace) {\n      state.loadingNamespaceMap.set(namespace, loading);\n    }\n    state.loading = loading;\n    PublicStateController.set({\n      loading\n    });\n  },\n  clearLoading() {\n    state.loadingNamespaceMap.clear();\n    state.loading = false;\n    PublicStateController.set({\n      loading: false\n    });\n  },\n  shake() {\n    if (state.shake) {\n      return;\n    }\n    state.shake = true;\n    setTimeout(() => {\n      state.shake = false;\n    }, 500);\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const ModalController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","CoreHelperUtil","NetworkUtil","withErrorBoundary","ApiController","ChainController","ConnectionController","ConnectorController","EventsController","OptionsController","PublicStateController","RouterController","state","loading","loadingNamespaceMap","Map","open","shake","namespace","undefined","controller","callback","key","options","currentNamespace","activeChain","isSwitchingNamespace","caipAddress","getAccountData","hasNoAdapters","noAdapters","wcBasic","prefetch","fetchNetworkImages","fetchConnectorImages","fetchWalletRanks","setFilterByNamespace","ModalController","setLoading","namespaceNetwork","getNetworkData","caipNetwork","getRequestedCaipNetworks","switchActiveNetwork","push","onSwitchNetwork","network","ignoreSwitchConfirmation","manualWCControl","isMobile","reset","view","data","set","sendEvent","type","event","properties","connected","Boolean","close","isEmbeddedEnabled","enableEmbedded","isConnected","activeCaipAddress","clearLoading","replace","resetUri","clear","setTimeout"],"sources":["../../../../src/controllers/ModalController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}