{"ast":null,"code":"import _objectSpread from \"/Users/alex.codreanu/Desktop/marketplace-dapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { ConstantsUtil } from '@reown/appkit-common';\nimport { MELD_PUBLIC_KEY, ONRAMP_PROVIDERS } from '../utils/ConstantsUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { ApiController } from './ApiController.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { OptionsController } from './OptionsController.js';\nexport const USDC_CURRENCY_DEFAULT = {\n  id: '2b92315d-eab7-5bef-84fa-089a131333f5',\n  name: 'USD Coin',\n  symbol: 'USDC',\n  networks: [{\n    name: 'ethereum-mainnet',\n    display_name: 'Ethereum',\n    chain_id: '1',\n    contract_address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48'\n  }, {\n    name: 'polygon-mainnet',\n    display_name: 'Polygon',\n    chain_id: '137',\n    contract_address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174'\n  }]\n};\nexport const USD_CURRENCY_DEFAULT = {\n  id: 'USD',\n  payment_method_limits: [{\n    id: 'card',\n    min: '10.00',\n    max: '7500.00'\n  }, {\n    id: 'ach_bank_account',\n    min: '10.00',\n    max: '25000.00'\n  }]\n};\nconst defaultState = {\n  providers: ONRAMP_PROVIDERS,\n  selectedProvider: null,\n  error: null,\n  purchaseCurrency: USDC_CURRENCY_DEFAULT,\n  paymentCurrency: USD_CURRENCY_DEFAULT,\n  purchaseCurrencies: [USDC_CURRENCY_DEFAULT],\n  paymentCurrencies: [],\n  quotesLoading: false\n};\n// -- State --------------------------------------------- //\nconst state = proxy(defaultState);\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  setSelectedProvider(provider) {\n    if (provider && provider.name === 'meld') {\n      var _ChainController$stat, _ChainController$stat2;\n      const activeChain = ChainController.state.activeChain;\n      const currency = activeChain === ConstantsUtil.CHAIN.SOLANA ? 'SOL' : 'USDC';\n      const address = activeChain ? (_ChainController$stat = (_ChainController$stat2 = ChainController.state.chains.get(activeChain)) === null || _ChainController$stat2 === void 0 || (_ChainController$stat2 = _ChainController$stat2.accountState) === null || _ChainController$stat2 === void 0 ? void 0 : _ChainController$stat2.address) !== null && _ChainController$stat !== void 0 ? _ChainController$stat : '' : '';\n      const url = new URL(provider.url);\n      url.searchParams.append('publicKey', MELD_PUBLIC_KEY);\n      url.searchParams.append('destinationCurrencyCode', currency);\n      url.searchParams.append('walletAddress', address);\n      url.searchParams.append('externalCustomerId', OptionsController.state.projectId);\n      state.selectedProvider = _objectSpread(_objectSpread({}, provider), {}, {\n        url: url.toString()\n      });\n    } else {\n      state.selectedProvider = provider;\n    }\n  },\n  setOnrampProviders(providers) {\n    if (Array.isArray(providers) && providers.every(item => typeof item === 'string')) {\n      const validOnramp = providers;\n      const newProviders = ONRAMP_PROVIDERS.filter(provider => validOnramp.includes(provider.name));\n      state.providers = newProviders;\n    } else {\n      state.providers = [];\n    }\n  },\n  setPurchaseCurrency(currency) {\n    state.purchaseCurrency = currency;\n  },\n  setPaymentCurrency(currency) {\n    state.paymentCurrency = currency;\n  },\n  setPurchaseAmount(amount) {\n    OnRampController.state.purchaseAmount = amount;\n  },\n  setPaymentAmount(amount) {\n    OnRampController.state.paymentAmount = amount;\n  },\n  async getAvailableCurrencies() {\n    const options = await BlockchainApiController.getOnrampOptions();\n    state.purchaseCurrencies = options.purchaseCurrencies;\n    state.paymentCurrencies = options.paymentCurrencies;\n    state.paymentCurrency = options.paymentCurrencies[0] || USD_CURRENCY_DEFAULT;\n    state.purchaseCurrency = options.purchaseCurrencies[0] || USDC_CURRENCY_DEFAULT;\n    await ApiController.fetchCurrencyImages(options.paymentCurrencies.map(currency => currency.id));\n    await ApiController.fetchTokenImages(options.purchaseCurrencies.map(currency => currency.symbol));\n  },\n  async getQuote() {\n    state.quotesLoading = true;\n    try {\n      var _state$paymentAmount, _state$purchaseCurren;\n      const quote = await BlockchainApiController.getOnrampQuote({\n        purchaseCurrency: state.purchaseCurrency,\n        paymentCurrency: state.paymentCurrency,\n        amount: ((_state$paymentAmount = state.paymentAmount) === null || _state$paymentAmount === void 0 ? void 0 : _state$paymentAmount.toString()) || '0',\n        network: (_state$purchaseCurren = state.purchaseCurrency) === null || _state$purchaseCurren === void 0 ? void 0 : _state$purchaseCurren.symbol\n      });\n      state.quotesLoading = false;\n      state.purchaseAmount = Number(quote === null || quote === void 0 ? void 0 : quote.purchaseAmount.amount);\n      return quote;\n    } catch (error) {\n      state.error = error.message;\n      state.quotesLoading = false;\n      return null;\n    } finally {\n      state.quotesLoading = false;\n    }\n  },\n  resetState() {\n    state.selectedProvider = null;\n    state.error = null;\n    state.purchaseCurrency = USDC_CURRENCY_DEFAULT;\n    state.paymentCurrency = USD_CURRENCY_DEFAULT;\n    state.purchaseCurrencies = [USDC_CURRENCY_DEFAULT];\n    state.paymentCurrencies = [];\n    state.paymentAmount = undefined;\n    state.purchaseAmount = undefined;\n    state.quotesLoading = false;\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const OnRampController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","ConstantsUtil","MELD_PUBLIC_KEY","ONRAMP_PROVIDERS","withErrorBoundary","ApiController","BlockchainApiController","ChainController","OptionsController","USDC_CURRENCY_DEFAULT","id","name","symbol","networks","display_name","chain_id","contract_address","USD_CURRENCY_DEFAULT","payment_method_limits","min","max","defaultState","providers","selectedProvider","error","purchaseCurrency","paymentCurrency","purchaseCurrencies","paymentCurrencies","quotesLoading","state","controller","callback","key","setSelectedProvider","provider","_ChainController$stat","_ChainController$stat2","activeChain","currency","CHAIN","SOLANA","address","chains","get","accountState","url","URL","searchParams","append","projectId","_objectSpread","toString","setOnrampProviders","Array","isArray","every","item","validOnramp","newProviders","filter","includes","setPurchaseCurrency","setPaymentCurrency","setPurchaseAmount","amount","OnRampController","purchaseAmount","setPaymentAmount","paymentAmount","getAvailableCurrencies","options","getOnrampOptions","fetchCurrencyImages","map","fetchTokenImages","getQuote","_state$paymentAmount","_state$purchaseCurren","quote","getOnrampQuote","network","Number","message","resetState","undefined"],"sources":["../../../../src/controllers/OnRampController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}