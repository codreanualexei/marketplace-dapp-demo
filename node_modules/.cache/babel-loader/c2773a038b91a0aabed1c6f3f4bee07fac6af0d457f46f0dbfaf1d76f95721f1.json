{"ast":null,"code":"import { proxy, snapshot } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { ModalController } from './ModalController.js';\nimport { OptionsController } from './OptionsController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  view: 'Connect',\n  history: ['Connect'],\n  transactionStack: []\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  pushTransactionStack(action) {\n    state.transactionStack.push(action);\n  },\n  popTransactionStack(status) {\n    const action = state.transactionStack.pop();\n    if (!action) {\n      return;\n    }\n    const {\n      onSuccess,\n      onError,\n      onCancel\n    } = action;\n    switch (status) {\n      case 'success':\n        onSuccess === null || onSuccess === void 0 || onSuccess();\n        break;\n      case 'error':\n        onError === null || onError === void 0 || onError();\n        RouterController.goBack();\n        break;\n      case 'cancel':\n        onCancel === null || onCancel === void 0 || onCancel();\n        RouterController.goBack();\n        break;\n      default:\n    }\n  },\n  push(view, data) {\n    if (view !== state.view) {\n      state.view = view;\n      state.history.push(view);\n      state.data = data;\n    }\n  },\n  reset(view, data) {\n    state.view = view;\n    state.history = [view];\n    state.data = data;\n  },\n  replace(view, data) {\n    const lastView = state.history.at(-1);\n    const isSameView = lastView === view;\n    if (!isSameView) {\n      state.view = view;\n      state.history[state.history.length - 1] = view;\n      state.data = data;\n    }\n  },\n  goBack() {\n    var _state$data, _state$data2;\n    const isConnected = ChainController.state.activeCaipAddress;\n    const isFarcasterView = RouterController.state.view === 'ConnectingFarcaster';\n    const shouldReload = !isConnected && isFarcasterView;\n    if (state.history.length > 1) {\n      state.history.pop();\n      const [last] = state.history.slice(-1);\n      if (last) {\n        const isConnectView = last === 'Connect';\n        if (isConnected && isConnectView) {\n          state.view = 'Account';\n        } else {\n          state.view = last;\n        }\n      }\n    } else {\n      ModalController.close();\n    }\n    if ((_state$data = state.data) !== null && _state$data !== void 0 && _state$data.wallet) {\n      state.data.wallet = undefined;\n    }\n    if ((_state$data2 = state.data) !== null && _state$data2 !== void 0 && _state$data2.redirectView) {\n      state.data.redirectView = undefined;\n    }\n    // Reloading the iframe contentwindow and doing the view animation in the modal causes a small freeze in the transition. Doing these separately fixes that.\n    setTimeout(() => {\n      if (shouldReload) {\n        var _authConnector$provid, _authConnector$provid2, _authConnector$provid3;\n        ChainController.setAccountProp('farcasterUrl', undefined, ChainController.state.activeChain);\n        const authConnector = ConnectorController.getAuthConnector();\n        authConnector === null || authConnector === void 0 || (_authConnector$provid = authConnector.provider) === null || _authConnector$provid === void 0 || _authConnector$provid.reload();\n        const optionsState = snapshot(OptionsController.state);\n        authConnector === null || authConnector === void 0 || (_authConnector$provid2 = authConnector.provider) === null || _authConnector$provid2 === void 0 || (_authConnector$provid3 = _authConnector$provid2.syncDappData) === null || _authConnector$provid3 === void 0 || _authConnector$provid3.call(_authConnector$provid2, {\n          metadata: optionsState.metadata,\n          sdkVersion: optionsState.sdkVersion,\n          projectId: optionsState.projectId,\n          sdkType: optionsState.sdkType\n        });\n      }\n    }, 100);\n  },\n  goBackToIndex(historyIndex) {\n    if (state.history.length > 1) {\n      state.history = state.history.slice(0, historyIndex + 1);\n      const [last] = state.history.slice(-1);\n      if (last) {\n        state.view = last;\n      }\n    }\n  },\n  goBackOrCloseModal() {\n    if (RouterController.state.history.length > 1) {\n      RouterController.goBack();\n    } else {\n      ModalController.close();\n    }\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const RouterController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","snapshot","subscribeKey","subKey","withErrorBoundary","ChainController","ConnectorController","ModalController","OptionsController","state","view","history","transactionStack","controller","key","callback","pushTransactionStack","action","push","popTransactionStack","status","pop","onSuccess","onError","onCancel","RouterController","goBack","data","reset","replace","lastView","at","isSameView","length","_state$data","_state$data2","isConnected","activeCaipAddress","isFarcasterView","shouldReload","last","slice","isConnectView","close","wallet","undefined","redirectView","setTimeout","_authConnector$provid","_authConnector$provid2","_authConnector$provid3","setAccountProp","activeChain","authConnector","getAuthConnector","provider","reload","optionsState","syncDappData","call","metadata","sdkVersion","projectId","sdkType","goBackToIndex","historyIndex","goBackOrCloseModal"],"sources":["../../../../src/controllers/RouterController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}