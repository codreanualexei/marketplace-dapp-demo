{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { NumberUtil } from '@reown/appkit-common';\nimport { getActiveNetworkTokenAddress } from '../utils/ChainControllerUtil.js';\nimport { ConstantsUtil } from '../utils/ConstantsUtil.js';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { formatCaip19Asset, getBuyStatus, getExchanges, getPayUrl, getPaymentAssetsForNetwork } from '../utils/ExchangeUtil.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { EventsController } from './EventsController.js';\nimport { OptionsController } from './OptionsController.js';\nimport { SnackController } from './SnackController.js';\n// -- Constants ----------------------------------------- //\nconst DEFAULT_PAGE = 0;\nexport const DEFAULT_STATE = {\n  paymentAsset: null,\n  amount: null,\n  tokenAmount: 0,\n  priceLoading: false,\n  error: null,\n  exchanges: [],\n  isLoading: false,\n  currentPayment: undefined,\n  isPaymentInProgress: false,\n  paymentId: '',\n  assets: []\n};\n// -- State --------------------------------------------- //\nconst state = proxy(DEFAULT_STATE);\n// -- Controller ---------------------------------------- //\nexport const ExchangeController = {\n  state,\n  // -- Subscriptions ----------------------------------- //\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  resetState() {\n    Object.assign(state, {\n      ...DEFAULT_STATE\n    });\n  },\n  async getAssetsForNetwork(network) {\n    const assets = getPaymentAssetsForNetwork(network);\n    const metadata = await ExchangeController.getAssetsImageAndPrice(assets);\n    const assetsWithPrice = assets.map(asset => {\n      const assetAddress = asset.asset === 'native' ? getActiveNetworkTokenAddress() : `${asset.network}:${asset.asset}`;\n      const assetMetadata = metadata.find(m => m.fungibles?.[0]?.address?.toLowerCase() === assetAddress.toLowerCase());\n      return {\n        ...asset,\n        price: assetMetadata?.fungibles?.[0]?.price || 1,\n        metadata: {\n          ...asset.metadata,\n          iconUrl: assetMetadata?.fungibles?.[0]?.iconUrl\n        }\n      };\n    });\n    state.assets = assetsWithPrice;\n    return assetsWithPrice;\n  },\n  async getAssetsImageAndPrice(assets) {\n    const addresses = assets.map(asset => asset.asset === 'native' ? getActiveNetworkTokenAddress() : `${asset.network}:${asset.asset}`);\n    const metadata = await Promise.all(addresses.map(address => BlockchainApiController.fetchTokenPrice({\n      addresses: [address]\n    })));\n    return metadata;\n  },\n  getTokenAmount() {\n    if (!state?.paymentAsset?.price) {\n      throw new Error('Cannot get token price');\n    }\n    const bigAmount = NumberUtil.bigNumber(state.amount ?? 0).round(8);\n    const bigPrice = NumberUtil.bigNumber(state.paymentAsset.price).round(8);\n    return bigAmount.div(bigPrice).round(8).toNumber();\n  },\n  setAmount(amount) {\n    state.amount = amount;\n    if (state.paymentAsset?.price) {\n      state.tokenAmount = ExchangeController.getTokenAmount();\n    }\n  },\n  setPaymentAsset(asset) {\n    state.paymentAsset = asset;\n  },\n  isPayWithExchangeEnabled() {\n    return OptionsController.state.remoteFeatures?.payWithExchange || OptionsController.state.remoteFeatures?.payments || OptionsController.state.features?.pay;\n  },\n  isPayWithExchangeSupported() {\n    return ExchangeController.isPayWithExchangeEnabled() && ChainController.state.activeCaipNetwork && ConstantsUtil.PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES.includes(ChainController.state.activeCaipNetwork.chainNamespace);\n  },\n  // -- Getters ----------------------------------------- //\n  async fetchExchanges() {\n    try {\n      const isPayWithExchangeSupported = ExchangeController.isPayWithExchangeSupported();\n      if (!state.paymentAsset || !isPayWithExchangeSupported) {\n        state.exchanges = [];\n        state.isLoading = false;\n        return;\n      }\n      state.isLoading = true;\n      const response = await getExchanges({\n        page: DEFAULT_PAGE,\n        asset: formatCaip19Asset(state.paymentAsset.network, state.paymentAsset.asset),\n        amount: state.amount?.toString() ?? '0'\n      });\n      // Putting this here in order to maintain backawrds compatibility with the UI when we introduce more exchanges\n      state.exchanges = response.exchanges.slice(0, 2);\n    } catch (error) {\n      SnackController.showError('Unable to get exchanges');\n      throw new Error('Unable to get exchanges');\n    } finally {\n      state.isLoading = false;\n    }\n  },\n  async getPayUrl(exchangeId, params) {\n    try {\n      const numericAmount = Number(params.amount);\n      const response = await getPayUrl({\n        exchangeId,\n        asset: formatCaip19Asset(params.network, params.asset),\n        amount: numericAmount.toString(),\n        recipient: `${params.network}:${params.recipient}`\n      });\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'PAY_EXCHANGE_SELECTED',\n        properties: {\n          exchange: {\n            id: exchangeId\n          },\n          configuration: {\n            network: params.network,\n            asset: params.asset,\n            recipient: params.recipient,\n            amount: numericAmount\n          },\n          currentPayment: {\n            type: 'exchange',\n            exchangeId\n          },\n          source: 'fund-from-exchange',\n          headless: false\n        }\n      });\n      return response;\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('is not supported')) {\n        throw new Error('Asset not supported');\n      }\n      throw new Error(error.message);\n    }\n  },\n  async handlePayWithExchange(exchangeId) {\n    try {\n      const address = ChainController.getAccountData()?.address;\n      if (!address) {\n        throw new Error('No account connected');\n      }\n      if (!state.paymentAsset) {\n        throw new Error('No payment asset selected');\n      }\n      const popupWindow = CoreHelperUtil.returnOpenHref('', 'popupWindow', 'scrollbar=yes,width=480,height=720');\n      if (!popupWindow) {\n        throw new Error('Could not create popup window');\n      }\n      state.isPaymentInProgress = true;\n      state.paymentId = crypto.randomUUID();\n      state.currentPayment = {\n        type: 'exchange',\n        exchangeId\n      };\n      const {\n        network,\n        asset\n      } = state.paymentAsset;\n      const payUrlParams = {\n        network,\n        asset,\n        amount: state.tokenAmount,\n        recipient: address\n      };\n      const payUrl = await ExchangeController.getPayUrl(exchangeId, payUrlParams);\n      if (!payUrl) {\n        try {\n          popupWindow.close();\n        } catch (err) {\n          // eslint-disable-next-line no-console\n          console.error('Unable to close popup window', err);\n        }\n        throw new Error('Unable to initiate payment');\n      }\n      state.currentPayment.sessionId = payUrl.sessionId;\n      state.currentPayment.status = 'IN_PROGRESS';\n      state.currentPayment.exchangeId = exchangeId;\n      popupWindow.location.href = payUrl.url;\n    } catch (error) {\n      state.error = 'Unable to initiate payment';\n      SnackController.showError(state.error);\n    }\n  },\n  async waitUntilComplete({\n    exchangeId,\n    sessionId,\n    paymentId,\n    retries = 20\n  }) {\n    const status = await ExchangeController.getBuyStatus(exchangeId, sessionId, paymentId);\n    if (status.status === 'SUCCESS' || status.status === 'FAILED') {\n      return status;\n    }\n    if (retries === 0) {\n      throw new Error('Unable to get deposit status');\n    }\n    // Wait 5 seconds before checking again\n    await new Promise(resolve => {\n      setTimeout(resolve, 5000);\n    });\n    return ExchangeController.waitUntilComplete({\n      exchangeId,\n      sessionId,\n      paymentId,\n      retries: retries - 1\n    });\n  },\n  async getBuyStatus(exchangeId, sessionId, paymentId) {\n    try {\n      if (!state.currentPayment) {\n        throw new Error('No current payment');\n      }\n      const status = await getBuyStatus({\n        sessionId,\n        exchangeId\n      });\n      state.currentPayment.status = status.status;\n      if (status.status === 'SUCCESS' || status.status === 'FAILED') {\n        const address = ChainController.getAccountData()?.address;\n        state.currentPayment.result = status.txHash;\n        state.isPaymentInProgress = false;\n        EventsController.sendEvent({\n          type: 'track',\n          event: status.status === 'SUCCESS' ? 'PAY_SUCCESS' : 'PAY_ERROR',\n          properties: {\n            message: status.status === 'FAILED' ? CoreHelperUtil.parseError(state.error) : undefined,\n            source: 'fund-from-exchange',\n            paymentId,\n            configuration: {\n              network: state.paymentAsset?.network || '',\n              asset: state.paymentAsset?.asset || '',\n              recipient: address || '',\n              amount: state.amount ?? 0\n            },\n            currentPayment: {\n              type: 'exchange',\n              exchangeId: state.currentPayment?.exchangeId,\n              sessionId: state.currentPayment?.sessionId,\n              result: status.txHash\n            }\n          }\n        });\n      }\n      return status;\n    } catch (error) {\n      return {\n        status: 'UNKNOWN',\n        txHash: ''\n      };\n    }\n  },\n  reset() {\n    state.currentPayment = undefined;\n    state.isPaymentInProgress = false;\n    state.paymentId = '';\n    state.paymentAsset = null;\n    state.amount = 0;\n    state.tokenAmount = 0;\n    state.priceLoading = false;\n    state.error = null;\n    state.exchanges = [];\n    state.isLoading = false;\n  }\n};","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","NumberUtil","getActiveNetworkTokenAddress","ConstantsUtil","CoreHelperUtil","formatCaip19Asset","getBuyStatus","getExchanges","getPayUrl","getPaymentAssetsForNetwork","BlockchainApiController","ChainController","EventsController","OptionsController","SnackController","DEFAULT_PAGE","DEFAULT_STATE","paymentAsset","amount","tokenAmount","priceLoading","error","exchanges","isLoading","currentPayment","undefined","isPaymentInProgress","paymentId","assets","state","ExchangeController","callback","key","resetState","Object","assign","getAssetsForNetwork","network","metadata","getAssetsImageAndPrice","assetsWithPrice","map","asset","assetAddress","assetMetadata","find","m","fungibles","address","toLowerCase","price","iconUrl","addresses","Promise","all","fetchTokenPrice","getTokenAmount","Error","bigAmount","bigNumber","round","bigPrice","div","toNumber","setAmount","setPaymentAsset","isPayWithExchangeEnabled","remoteFeatures","payWithExchange","payments","features","pay","isPayWithExchangeSupported","activeCaipNetwork","PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES","includes","chainNamespace","fetchExchanges","response","page","toString","slice","showError","exchangeId","params","numericAmount","Number","recipient","sendEvent","type","event","properties","exchange","id","configuration","source","headless","message","handlePayWithExchange","getAccountData","popupWindow","returnOpenHref","crypto","randomUUID","payUrlParams","payUrl","close","err","console","sessionId","status","location","href","url","waitUntilComplete","retries","resolve","setTimeout","result","txHash","parseError","reset"],"sources":["../../../../src/controllers/ExchangeController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}