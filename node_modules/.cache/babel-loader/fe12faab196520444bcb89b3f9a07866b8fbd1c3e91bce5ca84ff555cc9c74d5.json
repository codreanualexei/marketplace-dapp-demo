{"ast":null,"code":"import _objectSpread from \"/Users/alex.codreanu/Desktop/marketplace-dapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { ApiController, ConnectorController, CoreHelperUtil, OptionsController, StorageUtil } from '@reown/appkit-controllers';\nimport { HelpersUtil } from '@reown/appkit-utils';\nimport { ConnectorUtil } from './ConnectorUtil.js';\nimport { ConstantsUtil } from './ConstantsUtil.js';\nexport const WalletUtil = {\n  filterOutDuplicatesByRDNS(wallets) {\n    const connectors = OptionsController.state.enableEIP6963 ? ConnectorController.state.connectors : [];\n    const recent = StorageUtil.getRecentWallets();\n    const connectorRDNSs = connectors.map(connector => {\n      var _connector$info;\n      return (_connector$info = connector.info) === null || _connector$info === void 0 ? void 0 : _connector$info.rdns;\n    }).filter(Boolean);\n    const recentRDNSs = recent.map(wallet => wallet.rdns).filter(Boolean);\n    const allRDNSs = connectorRDNSs.concat(recentRDNSs);\n    if (allRDNSs.includes('io.metamask.mobile') && CoreHelperUtil.isMobile()) {\n      const index = allRDNSs.indexOf('io.metamask.mobile');\n      allRDNSs[index] = 'io.metamask';\n    }\n    const filtered = wallets.filter(wallet => {\n      if (wallet !== null && wallet !== void 0 && wallet.rdns && allRDNSs.includes(String(wallet.rdns))) {\n        return false;\n      }\n      if (!(wallet !== null && wallet !== void 0 && wallet.rdns)) {\n        const hasMatchingConnectorName = connectors.some(connector => connector.name === wallet.name);\n        if (hasMatchingConnectorName) {\n          return false;\n        }\n      }\n      return true;\n    });\n    return filtered;\n  },\n  filterOutDuplicatesByIds(wallets) {\n    const connectors = ConnectorController.state.connectors.filter(connector => connector.type === 'ANNOUNCED' || connector.type === 'INJECTED');\n    const recent = StorageUtil.getRecentWallets();\n    const connectorIds = connectors.map(connector => connector.explorerId);\n    const recentIds = recent.map(wallet => wallet.id);\n    const allIds = connectorIds.concat(recentIds);\n    const filtered = wallets.filter(wallet => !allIds.includes(wallet === null || wallet === void 0 ? void 0 : wallet.id));\n    return filtered;\n  },\n  filterOutDuplicateWallets(wallets) {\n    const uniqueByRDNS = this.filterOutDuplicatesByRDNS(wallets);\n    const uniqueWallets = this.filterOutDuplicatesByIds(uniqueByRDNS);\n    return uniqueWallets;\n  },\n  markWalletsAsInstalled(wallets) {\n    const {\n      connectors\n    } = ConnectorController.state;\n    const {\n      featuredWalletIds\n    } = OptionsController.state;\n    const installedWalletRdnsMap = connectors.filter(connector => connector.type === 'ANNOUNCED').reduce((rdnsMap, connector) => {\n      var _connector$info2;\n      if (!((_connector$info2 = connector.info) !== null && _connector$info2 !== void 0 && _connector$info2.rdns)) {\n        return rdnsMap;\n      }\n      rdnsMap[connector.info.rdns] = true;\n      return rdnsMap;\n    }, {});\n    const walletsWithInstallationStatus = wallets.map(wallet => {\n      var _wallet$rdns;\n      return _objectSpread(_objectSpread({}, wallet), {}, {\n        installed: Boolean(wallet.rdns) && Boolean(installedWalletRdnsMap[(_wallet$rdns = wallet.rdns) !== null && _wallet$rdns !== void 0 ? _wallet$rdns : ''])\n      });\n    });\n    const sortedWallets = walletsWithInstallationStatus.sort((walletA, walletB) => {\n      const installationComparison = Number(walletB.installed) - Number(walletA.installed);\n      if (installationComparison !== 0) {\n        return installationComparison;\n      }\n      if (featuredWalletIds !== null && featuredWalletIds !== void 0 && featuredWalletIds.length) {\n        const walletAFeaturedIndex = featuredWalletIds.indexOf(walletA.id);\n        const walletBFeaturedIndex = featuredWalletIds.indexOf(walletB.id);\n        if (walletAFeaturedIndex !== -1 && walletBFeaturedIndex !== -1) {\n          return walletAFeaturedIndex - walletBFeaturedIndex;\n        }\n        if (walletAFeaturedIndex !== -1) {\n          return -1;\n        }\n        if (walletBFeaturedIndex !== -1) {\n          return 1;\n        }\n      }\n      return 0;\n    });\n    return sortedWallets;\n  },\n  getConnectOrderMethod(_features, _connectors) {\n    var _OptionsController$st;\n    const connectMethodOrder = (_features === null || _features === void 0 ? void 0 : _features.connectMethodsOrder) || ((_OptionsController$st = OptionsController.state.features) === null || _OptionsController$st === void 0 ? void 0 : _OptionsController$st.connectMethodsOrder);\n    const connectors = _connectors || ConnectorController.state.connectors;\n    if (connectMethodOrder) {\n      return connectMethodOrder;\n    }\n    const {\n      injected,\n      announced\n    } = ConnectorUtil.getConnectorsByType(connectors, ApiController.state.recommended, ApiController.state.featured);\n    const shownInjected = injected.filter(ConnectorUtil.showConnector);\n    const shownAnnounced = announced.filter(ConnectorUtil.showConnector);\n    if (shownInjected.length || shownAnnounced.length) {\n      return ['wallet', 'email', 'social'];\n    }\n    return ConstantsUtil.DEFAULT_CONNECT_METHOD_ORDER;\n  },\n  isExcluded(wallet) {\n    const isRDNSExcluded = Boolean(wallet.rdns) && ApiController.state.excludedWallets.some(w => w.rdns === wallet.rdns);\n    const isNameExcluded = Boolean(wallet.name) && ApiController.state.excludedWallets.some(w => HelpersUtil.isLowerCaseMatch(w.name, wallet.name));\n    return isRDNSExcluded || isNameExcluded;\n  },\n  markWalletsWithDisplayIndex(wallets) {\n    return wallets.map((w, index) => _objectSpread(_objectSpread({}, w), {}, {\n      display_index: index\n    }));\n  }\n};","map":{"version":3,"names":["ApiController","ConnectorController","CoreHelperUtil","OptionsController","StorageUtil","HelpersUtil","ConnectorUtil","ConstantsUtil","WalletUtil","filterOutDuplicatesByRDNS","wallets","connectors","state","enableEIP6963","recent","getRecentWallets","connectorRDNSs","map","connector","_connector$info","info","rdns","filter","Boolean","recentRDNSs","wallet","allRDNSs","concat","includes","isMobile","index","indexOf","filtered","String","hasMatchingConnectorName","some","name","filterOutDuplicatesByIds","type","connectorIds","explorerId","recentIds","id","allIds","filterOutDuplicateWallets","uniqueByRDNS","uniqueWallets","markWalletsAsInstalled","featuredWalletIds","installedWalletRdnsMap","reduce","rdnsMap","_connector$info2","walletsWithInstallationStatus","_wallet$rdns","_objectSpread","installed","sortedWallets","sort","walletA","walletB","installationComparison","Number","length","walletAFeaturedIndex","walletBFeaturedIndex","getConnectOrderMethod","_features","_connectors","_OptionsController$st","connectMethodOrder","connectMethodsOrder","features","injected","announced","getConnectorsByType","recommended","featured","shownInjected","showConnector","shownAnnounced","DEFAULT_CONNECT_METHOD_ORDER","isExcluded","isRDNSExcluded","excludedWallets","w","isNameExcluded","isLowerCaseMatch","markWalletsWithDisplayIndex","display_index"],"sources":["../../../../src/utils/WalletUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}