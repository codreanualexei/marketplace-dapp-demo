{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect,useCallback}from'react';import{ethers}from'ethers';import{EthereumProvider}from'@walletconnect/ethereum-provider';import{jsx as _jsx}from\"react/jsx-runtime\";const WalletContext=/*#__PURE__*/createContext(undefined);export const useWallet=()=>{const context=useContext(WalletContext);if(!context){throw new Error('useWallet must be used within a WalletProvider');}return context;};export const WalletProvider=_ref=>{let{children}=_ref;const[account,setAccount]=useState(null);const[balance,setBalance]=useState(null);const[chainId,setChainId]=useState(null);const[provider,setProvider]=useState(null);const[signer,setSigner]=useState(null);const[isConnecting,setIsConnecting]=useState(false);const[error,setError]=useState(null);const[walletType,setWalletType]=useState(null);const[walletConnectProvider,setWalletConnectProvider]=useState(null);const updateBalance=async(address,provider)=>{try{const balanceWei=await provider.getBalance(address);const balanceEth=ethers.formatEther(balanceWei);setBalance(parseFloat(balanceEth).toFixed(4));}catch(err){console.error('Error fetching balance:',err);}};const connectWallet=async function(){let walletType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'metamask';setIsConnecting(true);setError(null);try{if(walletType==='metamask'){await connectMetaMask();}else if(walletType==='walletconnect'){await connectWalletConnect();}}catch(err){console.error('Error connecting wallet:',err);setError(err.message||'Failed to connect wallet');}finally{setIsConnecting(false);}};const connectMetaMask=async()=>{if(typeof window.ethereum==='undefined'){throw new Error('Please install MetaMask to use this dApp');}const browserProvider=new ethers.BrowserProvider(window.ethereum);const accounts=await browserProvider.send('eth_requestAccounts',[]);if(accounts.length===0){throw new Error('No accounts found');}const userSigner=await browserProvider.getSigner();const network=await browserProvider.getNetwork();setProvider(browserProvider);setSigner(userSigner);setAccount(accounts[0]);setChainId(Number(network.chainId));setWalletType('metamask');await updateBalance(accounts[0],browserProvider);// Store preferred wallet type\nlocalStorage.setItem('preferredWallet','metamask');localStorage.removeItem('walletDisconnected');};const connectWalletConnect=async()=>{try{console.log('Starting WalletConnect connection...');// Create WalletConnect provider\nconst projectId=process.env.REACT_APP_WALLETCONNECT_PROJECT_ID;if(!projectId){throw new Error('WalletConnect Project ID not configured. Please set REACT_APP_WALLETCONNECT_PROJECT_ID in your environment variables.');}console.log('Initializing WalletConnect provider...');const wcProvider=await EthereumProvider.init({projectId:projectId,chains:[1,137,56,43114,80002],// Ethereum, Polygon, BSC, Avalanche, Polygon Amoy\nshowQrModal:true,metadata:{name:'STR Domains Marketplace',description:'Decentralized marketplace for STR domains',url:window.location.origin,icons:[\"\".concat(window.location.origin,\"/logo192.png\")]},// Add better session management\nrelayUrl:'wss://relay.walletconnect.com',qrModalOptions:{themeMode:'light',themeVariables:{'--wcm-z-index':'1000'}}});console.log('WalletConnect provider initialized, enabling session...');// Enable session (triggers QR Code modal)\nawait wcProvider.enable();console.log('WalletConnect session enabled, setting up ethers provider...');// Create ethers provider from WalletConnect provider\nconst browserProvider=new ethers.BrowserProvider(wcProvider);const accounts=await browserProvider.listAccounts();if(accounts.length===0){throw new Error('No accounts found');}const userSigner=await browserProvider.getSigner();const network=await browserProvider.getNetwork();console.log('WalletConnect connected:',{account:accounts[0].address,chainId:Number(network.chainId)});setProvider(browserProvider);setSigner(userSigner);setAccount(accounts[0].address);setChainId(Number(network.chainId));setWalletType('walletconnect');setWalletConnectProvider(wcProvider);await updateBalance(accounts[0].address,browserProvider);// Store preferred wallet type\nlocalStorage.setItem('preferredWallet','walletconnect');localStorage.removeItem('walletDisconnected');console.log('WalletConnect connection completed successfully');}catch(error){var _error$message;console.error('WalletConnect connection error:',error);if((_error$message=error.message)!==null&&_error$message!==void 0&&_error$message.includes('User rejected')){throw new Error('Connection cancelled by user');}throw error;}};const switchNetwork=async targetChainId=>{if(walletType==='metamask'){await switchMetaMaskNetwork(targetChainId);}else if(walletType==='walletconnect'){await switchWalletConnectNetwork(targetChainId);}else{throw new Error('No wallet connected');}};const switchMetaMaskNetwork=async targetChainId=>{if(typeof window.ethereum==='undefined'){throw new Error('MetaMask not detected');}const chainIdHex=\"0x\".concat(targetChainId.toString(16));try{await window.ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:chainIdHex}]});}catch(switchError){// Chain not added to MetaMask, try to add it\nif(switchError.code===4902){await addMetaMaskNetwork(targetChainId);}else{throw switchError;}}};const addMetaMaskNetwork=async chainId=>{if(typeof window.ethereum==='undefined'){throw new Error('MetaMask not detected');}const chainIdHex=\"0x\".concat(chainId.toString(16));const networkConfig=getNetworkConfig(chainId);await window.ethereum.request({method:'wallet_addEthereumChain',params:[networkConfig]});};const switchWalletConnectNetwork=async targetChainId=>{if(!walletConnectProvider){throw new Error('WalletConnect not connected');}const chainIdHex=\"0x\".concat(targetChainId.toString(16));try{// Try wallet_switchEthereumChain first\nawait walletConnectProvider.request({method:'wallet_switchEthereumChain',params:[{chainId:chainIdHex}]});}catch(switchError){console.log('wallet_switchEthereumChain failed:',switchError);// If chain doesn't exist, try to add it\nif(switchError.code===4902){try{const networkConfig=getNetworkConfig(targetChainId);await walletConnectProvider.request({method:'wallet_addEthereumChain',params:[networkConfig]});}catch(addError){console.log('wallet_addEthereumChain failed:',addError);throw new Error(\"Network switching not supported by your wallet. Please manually switch to Polygon Amoy (Chain ID: \".concat(targetChainId,\") in your wallet app.\"));}}else{var _switchError$message,_switchError$message2,_switchError$message3;// Other errors - provide helpful message\nconsole.log('Network switch error:',switchError);if((_switchError$message=switchError.message)!==null&&_switchError$message!==void 0&&_switchError$message.includes('User rejected')||switchError.code===4001){throw new Error('Network switch was cancelled by user.');}else if((_switchError$message2=switchError.message)!==null&&_switchError$message2!==void 0&&_switchError$message2.includes('not supported')||(_switchError$message3=switchError.message)!==null&&_switchError$message3!==void 0&&_switchError$message3.includes('unsupported')){throw new Error(\"Your wallet doesn't support automatic network switching. Please manually switch to Polygon Amoy (Chain ID: \".concat(targetChainId,\") in your wallet app.\"));}else{throw new Error(\"Failed to switch network: \".concat(switchError.message||'Unknown error',\". Please manually switch to Polygon Amoy (Chain ID: \").concat(targetChainId,\") in your wallet app.\"));}}}};const getNetworkConfig=chainId=>{const chainIdHex=\"0x\".concat(chainId.toString(16));switch(chainId){case 80002:// Polygon Amoy\nreturn{chainId:chainIdHex,chainName:'Polygon Amoy Testnet',nativeCurrency:{name:'MATIC',symbol:'MATIC',decimals:18},rpcUrls:['https://rpc-amoy.polygon.technology'],blockExplorerUrls:['https://amoy.polygonscan.com/']};case 137:// Polygon Mainnet\nreturn{chainId:chainIdHex,chainName:'Polygon Mainnet',nativeCurrency:{name:'MATIC',symbol:'MATIC',decimals:18},rpcUrls:['https://polygon-rpc.com'],blockExplorerUrls:['https://polygonscan.com/']};case 1:// Ethereum Mainnet\nreturn{chainId:chainIdHex,chainName:'Ethereum Mainnet',nativeCurrency:{name:'Ethereum',symbol:'ETH',decimals:18},rpcUrls:['https://mainnet.infura.io/v3/'],blockExplorerUrls:['https://etherscan.io/']};default:throw new Error(\"Unsupported network: \".concat(chainId));}};const disconnectWallet=useCallback(async()=>{console.log('Disconnecting wallet:',walletType);// Disconnect WalletConnect if it's connected\nif(walletConnectProvider&&walletType==='walletconnect'){try{await walletConnectProvider.disconnect();}catch(error){console.error('Error disconnecting WalletConnect:',error);}}setAccount(null);setBalance(null);setChainId(null);setProvider(null);setSigner(null);setError(null);setWalletType(null);setWalletConnectProvider(null);// Store disconnect state with wallet type to prevent auto-connect\nlocalStorage.setItem('walletDisconnected','true');localStorage.removeItem('preferredWallet');},[walletConnectProvider,walletType]);// Listen for account changes\nuseEffect(()=>{const cleanupFunctions=[];// MetaMask event listeners\nif(typeof window.ethereum!=='undefined'&&walletType==='metamask'){var _window$ethereum$on,_window$ethereum,_window$ethereum$on2,_window$ethereum2;const handleAccountsChanged=accounts=>{console.log('MetaMask accounts changed:',accounts);if(accounts.length===0){disconnectWallet();}else if(accounts[0]!==account){setAccount(accounts[0]);if(provider){updateBalance(accounts[0],provider);}}};const handleChainChanged=chainIdHex=>{console.log('MetaMask chain changed:',chainIdHex);setChainId(parseInt(chainIdHex,16));window.location.reload();};(_window$ethereum$on=(_window$ethereum=window.ethereum).on)===null||_window$ethereum$on===void 0?void 0:_window$ethereum$on.call(_window$ethereum,'accountsChanged',handleAccountsChanged);(_window$ethereum$on2=(_window$ethereum2=window.ethereum).on)===null||_window$ethereum$on2===void 0?void 0:_window$ethereum$on2.call(_window$ethereum2,'chainChanged',handleChainChanged);cleanupFunctions.push(()=>{if(typeof window.ethereum!=='undefined'){var _removeListener,_ref2,_removeListener2,_ref3;(_removeListener=(_ref2=window.ethereum).removeListener)===null||_removeListener===void 0?void 0:_removeListener.call(_ref2,'accountsChanged',handleAccountsChanged);(_removeListener2=(_ref3=window.ethereum).removeListener)===null||_removeListener2===void 0?void 0:_removeListener2.call(_ref3,'chainChanged',handleChainChanged);}});}// WalletConnect event listeners\nif(walletConnectProvider&&walletType==='walletconnect'){const handleAccountsChanged=accounts=>{console.log('WalletConnect accounts changed:',accounts);if(accounts.length===0){disconnectWallet();}else if(accounts[0]!==account){setAccount(accounts[0]);if(provider){updateBalance(accounts[0],provider);}}};const handleChainChanged=chainId=>{console.log('WalletConnect chain changed:',chainId);setChainId(chainId);window.location.reload();};const handleDisconnect=()=>{console.log('WalletConnect disconnected');disconnectWallet();};const handleSessionUpdate=session=>{console.log('WalletConnect session updated:',session);// Don't disconnect on session updates, just log them\n};walletConnectProvider.on('accountsChanged',handleAccountsChanged);walletConnectProvider.on('chainChanged',handleChainChanged);walletConnectProvider.on('disconnect',handleDisconnect);walletConnectProvider.on('session_update',handleSessionUpdate);cleanupFunctions.push(()=>{walletConnectProvider.off('accountsChanged',handleAccountsChanged);walletConnectProvider.off('chainChanged',handleChainChanged);walletConnectProvider.off('disconnect',handleDisconnect);walletConnectProvider.off('session_update',handleSessionUpdate);});}return()=>{cleanupFunctions.forEach(cleanup=>cleanup());};},[account,provider,walletType,walletConnectProvider,disconnectWallet]);// Auto-connect if previously connected\nuseEffect(()=>{const checkConnection=async()=>{// Only auto-connect if not explicitly disconnected and no account is connected\nif(localStorage.getItem('walletDisconnected')==='true'||account){return;}console.log('Attempting auto-connect...');const preferredWallet=localStorage.getItem('preferredWallet');// Try preferred wallet first, then fallback to both\nconst walletsToTry=preferredWallet?[preferredWallet,'metamask','walletconnect']:['metamask','walletconnect'];for(const walletType of walletsToTry){if(walletType==='metamask'&&typeof window.ethereum!=='undefined'){try{console.log('Checking MetaMask connection...');const browserProvider=new ethers.BrowserProvider(window.ethereum);const accounts=await browserProvider.send('eth_accounts',[]);if(accounts.length>0){console.log('Auto-connecting MetaMask...');const userSigner=await browserProvider.getSigner();const network=await browserProvider.getNetwork();setProvider(browserProvider);setSigner(userSigner);setAccount(accounts[0]);setChainId(Number(network.chainId));setWalletType('metamask');await updateBalance(accounts[0],browserProvider);return;// Exit early if MetaMask connected\n}}catch(err){console.error('Error checking MetaMask connection:',err);}}if(walletType==='walletconnect'){try{console.log('Checking WalletConnect session...');const projectId=process.env.REACT_APP_WALLETCONNECT_PROJECT_ID;if(projectId){const wcProvider=await EthereumProvider.init({projectId:projectId,chains:[1,137,56,43114,80002],showQrModal:false,metadata:{name:'STR Domains Marketplace',description:'Decentralized marketplace for STR domains',url:window.location.origin,icons:[\"\".concat(window.location.origin,\"/logo192.png\")]}});if(wcProvider.session){console.log('Auto-connecting WalletConnect...');const browserProvider=new ethers.BrowserProvider(wcProvider);const accounts=await browserProvider.listAccounts();if(accounts.length>0){const userSigner=await browserProvider.getSigner();const network=await browserProvider.getNetwork();setProvider(browserProvider);setSigner(userSigner);setAccount(accounts[0].address);setChainId(Number(network.chainId));setWalletType('walletconnect');setWalletConnectProvider(wcProvider);await updateBalance(accounts[0].address,browserProvider);return;// Exit early if WalletConnect connected\n}}}}catch(err){console.error('Error checking WalletConnect connection:',err);}}}console.log('No previous wallet connections found');};// Add a small delay to prevent race conditions\nconst timeoutId=setTimeout(checkConnection,100);return()=>clearTimeout(timeoutId);},[]);// No dependencies to prevent re-runs\nconst value={account,balance,chainId,provider,signer,connectWallet,disconnectWallet,switchNetwork,isConnecting,error,walletType};return/*#__PURE__*/_jsx(WalletContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","ethers","EthereumProvider","jsx","_jsx","WalletContext","undefined","useWallet","context","Error","WalletProvider","_ref","children","account","setAccount","balance","setBalance","chainId","setChainId","provider","setProvider","signer","setSigner","isConnecting","setIsConnecting","error","setError","walletType","setWalletType","walletConnectProvider","setWalletConnectProvider","updateBalance","address","balanceWei","getBalance","balanceEth","formatEther","parseFloat","toFixed","err","console","connectWallet","arguments","length","connectMetaMask","connectWalletConnect","message","window","ethereum","browserProvider","BrowserProvider","accounts","send","userSigner","getSigner","network","getNetwork","Number","localStorage","setItem","removeItem","log","projectId","process","env","REACT_APP_WALLETCONNECT_PROJECT_ID","wcProvider","init","chains","showQrModal","metadata","name","description","url","location","origin","icons","concat","relayUrl","qrModalOptions","themeMode","themeVariables","enable","listAccounts","_error$message","includes","switchNetwork","targetChainId","switchMetaMaskNetwork","switchWalletConnectNetwork","chainIdHex","toString","request","method","params","switchError","code","addMetaMaskNetwork","networkConfig","getNetworkConfig","addError","_switchError$message","_switchError$message2","_switchError$message3","chainName","nativeCurrency","symbol","decimals","rpcUrls","blockExplorerUrls","disconnectWallet","disconnect","cleanupFunctions","_window$ethereum$on","_window$ethereum","_window$ethereum$on2","_window$ethereum2","handleAccountsChanged","handleChainChanged","parseInt","reload","on","call","push","_removeListener","_ref2","_removeListener2","_ref3","removeListener","handleDisconnect","handleSessionUpdate","session","off","forEach","cleanup","checkConnection","getItem","preferredWallet","walletsToTry","timeoutId","setTimeout","clearTimeout","value","Provider"],"sources":["/Users/alex.codreanu/Desktop/marketplace-dapp/src/contexts/WalletContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';\nimport { ethers } from 'ethers';\nimport { EthereumProvider } from '@walletconnect/ethereum-provider';\n\nexport type WalletType = 'metamask' | 'walletconnect';\n\ninterface WalletContextType {\n  account: string | null;\n  balance: string | null;\n  chainId: number | null;\n  provider: ethers.BrowserProvider | null;\n  signer: ethers.JsonRpcSigner | null;\n  connectWallet: (walletType?: WalletType) => Promise<void>;\n  disconnectWallet: () => void;\n  switchNetwork: (chainId: number) => Promise<void>;\n  isConnecting: boolean;\n  error: string | null;\n  walletType: WalletType | null;\n}\n\nconst WalletContext = createContext<WalletContextType | undefined>(undefined);\n\nexport const useWallet = () => {\n  const context = useContext(WalletContext);\n  if (!context) {\n    throw new Error('useWallet must be used within a WalletProvider');\n  }\n  return context;\n};\n\ninterface WalletProviderProps {\n  children: ReactNode;\n}\n\nexport const WalletProvider: React.FC<WalletProviderProps> = ({ children }) => {\n  const [account, setAccount] = useState<string | null>(null);\n  const [balance, setBalance] = useState<string | null>(null);\n  const [chainId, setChainId] = useState<number | null>(null);\n  const [provider, setProvider] = useState<ethers.BrowserProvider | null>(null);\n  const [signer, setSigner] = useState<ethers.JsonRpcSigner | null>(null);\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [walletType, setWalletType] = useState<WalletType | null>(null);\n  const [walletConnectProvider, setWalletConnectProvider] = useState<any>(null);\n\n  const updateBalance = async (address: string, provider: ethers.BrowserProvider) => {\n    try {\n      const balanceWei = await provider.getBalance(address);\n      const balanceEth = ethers.formatEther(balanceWei);\n      setBalance(parseFloat(balanceEth).toFixed(4));\n    } catch (err) {\n      console.error('Error fetching balance:', err);\n    }\n  };\n\n  const connectWallet = async (walletType: WalletType = 'metamask') => {\n    setIsConnecting(true);\n    setError(null);\n\n    try {\n      if (walletType === 'metamask') {\n        await connectMetaMask();\n      } else if (walletType === 'walletconnect') {\n        await connectWalletConnect();\n      }\n    } catch (err: any) {\n      console.error('Error connecting wallet:', err);\n      setError(err.message || 'Failed to connect wallet');\n    } finally {\n      setIsConnecting(false);\n    }\n  };\n\n  const connectMetaMask = async () => {\n    if (typeof window.ethereum === 'undefined') {\n      throw new Error('Please install MetaMask to use this dApp');\n    }\n\n    const browserProvider = new ethers.BrowserProvider(window.ethereum);\n    const accounts = await browserProvider.send('eth_requestAccounts', []);\n    \n    if (accounts.length === 0) {\n      throw new Error('No accounts found');\n    }\n\n    const userSigner = await browserProvider.getSigner();\n    const network = await browserProvider.getNetwork();\n    \n    setProvider(browserProvider);\n    setSigner(userSigner);\n    setAccount(accounts[0]);\n    setChainId(Number(network.chainId));\n    setWalletType('metamask');\n    \n    await updateBalance(accounts[0], browserProvider);\n    \n    // Store preferred wallet type\n    localStorage.setItem('preferredWallet', 'metamask');\n    localStorage.removeItem('walletDisconnected');\n  };\n\n  const connectWalletConnect = async () => {\n    try {\n      console.log('Starting WalletConnect connection...');\n      \n      // Create WalletConnect provider\n      const projectId = process.env.REACT_APP_WALLETCONNECT_PROJECT_ID;\n      if (!projectId) {\n        throw new Error('WalletConnect Project ID not configured. Please set REACT_APP_WALLETCONNECT_PROJECT_ID in your environment variables.');\n      }\n\n      console.log('Initializing WalletConnect provider...');\n      const wcProvider = await EthereumProvider.init({\n        projectId: projectId,\n        chains: [1, 137, 56, 43114, 80002], // Ethereum, Polygon, BSC, Avalanche, Polygon Amoy\n        showQrModal: true,\n        metadata: {\n          name: 'STR Domains Marketplace',\n          description: 'Decentralized marketplace for STR domains',\n          url: window.location.origin,\n          icons: [`${window.location.origin}/logo192.png`]\n        },\n        // Add better session management\n        relayUrl: 'wss://relay.walletconnect.com',\n        qrModalOptions: {\n          themeMode: 'light',\n          themeVariables: {\n            '--wcm-z-index': '1000'\n          }\n        }\n      });\n\n      console.log('WalletConnect provider initialized, enabling session...');\n      // Enable session (triggers QR Code modal)\n      await wcProvider.enable();\n\n      console.log('WalletConnect session enabled, setting up ethers provider...');\n      // Create ethers provider from WalletConnect provider\n      const browserProvider = new ethers.BrowserProvider(wcProvider);\n      const accounts = await browserProvider.listAccounts();\n      \n      if (accounts.length === 0) {\n        throw new Error('No accounts found');\n      }\n\n      const userSigner = await browserProvider.getSigner();\n      const network = await browserProvider.getNetwork();\n      \n      console.log('WalletConnect connected:', {\n        account: accounts[0].address,\n        chainId: Number(network.chainId)\n      });\n      \n      setProvider(browserProvider);\n      setSigner(userSigner);\n      setAccount(accounts[0].address);\n      setChainId(Number(network.chainId));\n      setWalletType('walletconnect');\n      setWalletConnectProvider(wcProvider);\n      \n      await updateBalance(accounts[0].address, browserProvider);\n      \n      // Store preferred wallet type\n      localStorage.setItem('preferredWallet', 'walletconnect');\n      localStorage.removeItem('walletDisconnected');\n      \n      console.log('WalletConnect connection completed successfully');\n    } catch (error: any) {\n      console.error('WalletConnect connection error:', error);\n      if (error.message?.includes('User rejected')) {\n        throw new Error('Connection cancelled by user');\n      }\n      throw error;\n    }\n  };\n\n  const switchNetwork = async (targetChainId: number) => {\n    if (walletType === 'metamask') {\n      await switchMetaMaskNetwork(targetChainId);\n    } else if (walletType === 'walletconnect') {\n      await switchWalletConnectNetwork(targetChainId);\n    } else {\n      throw new Error('No wallet connected');\n    }\n  };\n\n  const switchMetaMaskNetwork = async (targetChainId: number) => {\n    if (typeof window.ethereum === 'undefined') {\n      throw new Error('MetaMask not detected');\n    }\n\n    const chainIdHex = `0x${targetChainId.toString(16)}`;\n\n    try {\n      await window.ethereum.request({\n        method: 'wallet_switchEthereumChain',\n        params: [{ chainId: chainIdHex }],\n      });\n    } catch (switchError: any) {\n      // Chain not added to MetaMask, try to add it\n      if (switchError.code === 4902) {\n        await addMetaMaskNetwork(targetChainId);\n      } else {\n        throw switchError;\n      }\n    }\n  };\n\n  const addMetaMaskNetwork = async (chainId: number) => {\n    if (typeof window.ethereum === 'undefined') {\n      throw new Error('MetaMask not detected');\n    }\n\n    const chainIdHex = `0x${chainId.toString(16)}`;\n    const networkConfig = getNetworkConfig(chainId);\n\n    await window.ethereum.request({\n      method: 'wallet_addEthereumChain',\n      params: [networkConfig],\n    });\n  };\n\n  const switchWalletConnectNetwork = async (targetChainId: number) => {\n    if (!walletConnectProvider) {\n      throw new Error('WalletConnect not connected');\n    }\n\n    const chainIdHex = `0x${targetChainId.toString(16)}`;\n\n    try {\n      // Try wallet_switchEthereumChain first\n      await walletConnectProvider.request({\n        method: 'wallet_switchEthereumChain',\n        params: [{ chainId: chainIdHex }],\n      });\n    } catch (switchError: any) {\n      console.log('wallet_switchEthereumChain failed:', switchError);\n      \n      // If chain doesn't exist, try to add it\n      if (switchError.code === 4902) {\n        try {\n          const networkConfig = getNetworkConfig(targetChainId);\n          await walletConnectProvider.request({\n            method: 'wallet_addEthereumChain',\n            params: [networkConfig],\n          });\n        } catch (addError: any) {\n          console.log('wallet_addEthereumChain failed:', addError);\n          throw new Error(`Network switching not supported by your wallet. Please manually switch to Polygon Amoy (Chain ID: ${targetChainId}) in your wallet app.`);\n        }\n      } else {\n        // Other errors - provide helpful message\n        console.log('Network switch error:', switchError);\n        \n        if (switchError.message?.includes('User rejected') || switchError.code === 4001) {\n          throw new Error('Network switch was cancelled by user.');\n        } else if (switchError.message?.includes('not supported') || switchError.message?.includes('unsupported')) {\n          throw new Error(`Your wallet doesn't support automatic network switching. Please manually switch to Polygon Amoy (Chain ID: ${targetChainId}) in your wallet app.`);\n        } else {\n          throw new Error(`Failed to switch network: ${switchError.message || 'Unknown error'}. Please manually switch to Polygon Amoy (Chain ID: ${targetChainId}) in your wallet app.`);\n        }\n      }\n    }\n  };\n\n  const getNetworkConfig = (chainId: number) => {\n    const chainIdHex = `0x${chainId.toString(16)}`;\n\n    switch (chainId) {\n      case 80002: // Polygon Amoy\n        return {\n          chainId: chainIdHex,\n          chainName: 'Polygon Amoy Testnet',\n          nativeCurrency: {\n            name: 'MATIC',\n            symbol: 'MATIC',\n            decimals: 18,\n          },\n          rpcUrls: ['https://rpc-amoy.polygon.technology'],\n          blockExplorerUrls: ['https://amoy.polygonscan.com/'],\n        };\n      case 137: // Polygon Mainnet\n        return {\n          chainId: chainIdHex,\n          chainName: 'Polygon Mainnet',\n          nativeCurrency: {\n            name: 'MATIC',\n            symbol: 'MATIC',\n            decimals: 18,\n          },\n          rpcUrls: ['https://polygon-rpc.com'],\n          blockExplorerUrls: ['https://polygonscan.com/'],\n        };\n      case 1: // Ethereum Mainnet\n        return {\n          chainId: chainIdHex,\n          chainName: 'Ethereum Mainnet',\n          nativeCurrency: {\n            name: 'Ethereum',\n            symbol: 'ETH',\n            decimals: 18,\n          },\n          rpcUrls: ['https://mainnet.infura.io/v3/'],\n          blockExplorerUrls: ['https://etherscan.io/'],\n        };\n      default:\n        throw new Error(`Unsupported network: ${chainId}`);\n    }\n  };\n\n  const disconnectWallet = useCallback(async () => {\n    console.log('Disconnecting wallet:', walletType);\n    \n    // Disconnect WalletConnect if it's connected\n    if (walletConnectProvider && walletType === 'walletconnect') {\n      try {\n        await walletConnectProvider.disconnect();\n      } catch (error) {\n        console.error('Error disconnecting WalletConnect:', error);\n      }\n    }\n\n    setAccount(null);\n    setBalance(null);\n    setChainId(null);\n    setProvider(null);\n    setSigner(null);\n    setError(null);\n    setWalletType(null);\n    setWalletConnectProvider(null);\n    \n    // Store disconnect state with wallet type to prevent auto-connect\n    localStorage.setItem('walletDisconnected', 'true');\n    localStorage.removeItem('preferredWallet');\n  }, [walletConnectProvider, walletType]);\n\n  // Listen for account changes\n  useEffect(() => {\n    const cleanupFunctions: (() => void)[] = [];\n\n    // MetaMask event listeners\n    if (typeof window.ethereum !== 'undefined' && walletType === 'metamask') {\n      const handleAccountsChanged = (accounts: string[]) => {\n        console.log('MetaMask accounts changed:', accounts);\n        if (accounts.length === 0) {\n          disconnectWallet();\n        } else if (accounts[0] !== account) {\n          setAccount(accounts[0]);\n          if (provider) {\n            updateBalance(accounts[0], provider);\n          }\n        }\n      };\n\n      const handleChainChanged = (chainIdHex: string) => {\n        console.log('MetaMask chain changed:', chainIdHex);\n        setChainId(parseInt(chainIdHex, 16));\n        window.location.reload();\n      };\n\n      window.ethereum.on?.('accountsChanged', handleAccountsChanged);\n      window.ethereum.on?.('chainChanged', handleChainChanged);\n\n      cleanupFunctions.push(() => {\n        if (typeof window.ethereum !== 'undefined') {\n          (window.ethereum as any).removeListener?.('accountsChanged', handleAccountsChanged);\n          (window.ethereum as any).removeListener?.('chainChanged', handleChainChanged);\n        }\n      });\n    }\n\n    // WalletConnect event listeners\n    if (walletConnectProvider && walletType === 'walletconnect') {\n      const handleAccountsChanged = (accounts: string[]) => {\n        console.log('WalletConnect accounts changed:', accounts);\n        if (accounts.length === 0) {\n          disconnectWallet();\n        } else if (accounts[0] !== account) {\n          setAccount(accounts[0]);\n          if (provider) {\n            updateBalance(accounts[0], provider);\n          }\n        }\n      };\n\n      const handleChainChanged = (chainId: number) => {\n        console.log('WalletConnect chain changed:', chainId);\n        setChainId(chainId);\n        window.location.reload();\n      };\n\n      const handleDisconnect = () => {\n        console.log('WalletConnect disconnected');\n        disconnectWallet();\n      };\n\n      const handleSessionUpdate = (session: any) => {\n        console.log('WalletConnect session updated:', session);\n        // Don't disconnect on session updates, just log them\n      };\n\n      walletConnectProvider.on('accountsChanged', handleAccountsChanged);\n      walletConnectProvider.on('chainChanged', handleChainChanged);\n      walletConnectProvider.on('disconnect', handleDisconnect);\n      walletConnectProvider.on('session_update', handleSessionUpdate);\n\n      cleanupFunctions.push(() => {\n        walletConnectProvider.off('accountsChanged', handleAccountsChanged);\n        walletConnectProvider.off('chainChanged', handleChainChanged);\n        walletConnectProvider.off('disconnect', handleDisconnect);\n        walletConnectProvider.off('session_update', handleSessionUpdate);\n      });\n    }\n\n    return () => {\n      cleanupFunctions.forEach(cleanup => cleanup());\n    };\n  }, [account, provider, walletType, walletConnectProvider, disconnectWallet]);\n\n  // Auto-connect if previously connected\n  useEffect(() => {\n    const checkConnection = async () => {\n      // Only auto-connect if not explicitly disconnected and no account is connected\n      if (localStorage.getItem('walletDisconnected') === 'true' || account) {\n        return;\n      }\n\n      console.log('Attempting auto-connect...');\n      const preferredWallet = localStorage.getItem('preferredWallet');\n      \n      // Try preferred wallet first, then fallback to both\n      const walletsToTry = preferredWallet ? [preferredWallet, 'metamask', 'walletconnect'] : ['metamask', 'walletconnect'];\n      \n      for (const walletType of walletsToTry) {\n        if (walletType === 'metamask' && typeof window.ethereum !== 'undefined') {\n          try {\n            console.log('Checking MetaMask connection...');\n            const browserProvider = new ethers.BrowserProvider(window.ethereum);\n            const accounts = await browserProvider.send('eth_accounts', []);\n            \n            if (accounts.length > 0) {\n              console.log('Auto-connecting MetaMask...');\n              const userSigner = await browserProvider.getSigner();\n              const network = await browserProvider.getNetwork();\n              \n              setProvider(browserProvider);\n              setSigner(userSigner);\n              setAccount(accounts[0]);\n              setChainId(Number(network.chainId));\n              setWalletType('metamask');\n              \n              await updateBalance(accounts[0], browserProvider);\n              return; // Exit early if MetaMask connected\n            }\n          } catch (err) {\n            console.error('Error checking MetaMask connection:', err);\n          }\n        }\n        \n        if (walletType === 'walletconnect') {\n          try {\n            console.log('Checking WalletConnect session...');\n            const projectId = process.env.REACT_APP_WALLETCONNECT_PROJECT_ID;\n            if (projectId) {\n              const wcProvider = await EthereumProvider.init({\n                projectId: projectId,\n                chains: [1, 137, 56, 43114, 80002],\n                showQrModal: false,\n                metadata: {\n                  name: 'STR Domains Marketplace',\n                  description: 'Decentralized marketplace for STR domains',\n                  url: window.location.origin,\n                  icons: [`${window.location.origin}/logo192.png`]\n                }\n              });\n\n              if (wcProvider.session) {\n                console.log('Auto-connecting WalletConnect...');\n                const browserProvider = new ethers.BrowserProvider(wcProvider);\n                const accounts = await browserProvider.listAccounts();\n                \n                if (accounts.length > 0) {\n                  const userSigner = await browserProvider.getSigner();\n                  const network = await browserProvider.getNetwork();\n                  \n                  setProvider(browserProvider);\n                  setSigner(userSigner);\n                  setAccount(accounts[0].address);\n                  setChainId(Number(network.chainId));\n                  setWalletType('walletconnect');\n                  setWalletConnectProvider(wcProvider);\n                  \n                  await updateBalance(accounts[0].address, browserProvider);\n                  return; // Exit early if WalletConnect connected\n                }\n              }\n            }\n          } catch (err) {\n            console.error('Error checking WalletConnect connection:', err);\n          }\n        }\n      }\n      \n      console.log('No previous wallet connections found');\n    };\n\n    // Add a small delay to prevent race conditions\n    const timeoutId = setTimeout(checkConnection, 100);\n    \n    return () => clearTimeout(timeoutId);\n  }, []); // No dependencies to prevent re-runs\n\n  const value: WalletContextType = {\n    account,\n    balance,\n    chainId,\n    provider,\n    signer,\n    connectWallet,\n    disconnectWallet,\n    switchNetwork,\n    isConnecting,\n    error,\n    walletType,\n  };\n\n  return <WalletContext.Provider value={value}>{children}</WalletContext.Provider>;\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}