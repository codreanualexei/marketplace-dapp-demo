{"ast":null,"code":"import _objectSpread from \"/Users/alex.codreanu/Desktop/marketplace-dapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport UniversalProvider from '@walletconnect/universal-provider';\nimport { ConstantsUtil as CommonConstantsUtil } from '@reown/appkit-common';\nimport { W3mFrameRpcConstants } from '@reown/appkit-wallet/utils';\nimport { ChainController } from '../controllers/ChainController.js';\nimport { ConnectionController } from '../controllers/ConnectionController.js';\nimport { ConnectorController } from '../controllers/ConnectorController.js';\nimport { EventsController } from '../controllers/EventsController.js';\nimport { ModalController } from '../controllers/ModalController.js';\nimport { OptionsController } from '../controllers/OptionsController.js';\nimport { RouterController } from '../controllers/RouterController.js';\nimport { SnackController } from '../controllers/SnackController.js';\nimport { getActiveCaipNetwork, getPreferredAccountType } from './ChainControllerUtil.js';\nimport { CoreHelperUtil } from './CoreHelperUtil.js';\n/**\n * SIWXUtil holds the methods to interact with the SIWX plugin and must be called internally on AppKit.\n */\nlet addEmbeddedWalletSessionPromise = null;\nexport const SIWXUtil = {\n  getSIWX() {\n    return OptionsController.state.siwx;\n  },\n  async initializeIfEnabled() {\n    let caipAddress = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ChainController.getActiveCaipAddress();\n    const siwx = OptionsController.state.siwx;\n    if (!(siwx && caipAddress)) {\n      return;\n    }\n    const [namespace, chainId, address] = caipAddress.split(':');\n    if (!ChainController.checkIfSupportedNetwork(namespace, \"\".concat(namespace, \":\").concat(chainId))) {\n      return;\n    }\n    try {\n      var _OptionsController$st;\n      if ((_OptionsController$st = OptionsController.state.remoteFeatures) !== null && _OptionsController$st !== void 0 && _OptionsController$st.emailCapture) {\n        var _ChainController$getA, _user$email;\n        const user = (_ChainController$getA = ChainController.getAccountData(namespace)) === null || _ChainController$getA === void 0 ? void 0 : _ChainController$getA.user;\n        await ModalController.open({\n          view: 'DataCapture',\n          data: {\n            email: (_user$email = user === null || user === void 0 ? void 0 : user.email) !== null && _user$email !== void 0 ? _user$email : undefined\n          }\n        });\n        return;\n      }\n      if (addEmbeddedWalletSessionPromise) {\n        await addEmbeddedWalletSessionPromise;\n      }\n      const sessions = await siwx.getSessions(\"\".concat(namespace, \":\").concat(chainId), address);\n      if (sessions.length) {\n        return;\n      }\n      await ModalController.open({\n        view: 'SIWXSignMessage'\n      });\n    } catch (error) {\n      var _ConnectionController;\n      // eslint-disable-next-line no-console\n      console.error('SIWXUtil:initializeIfEnabled', error);\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SIWX_AUTH_ERROR',\n        properties: this.getSIWXEventProperties(error)\n      });\n      // eslint-disable-next-line no-console\n      await ((_ConnectionController = ConnectionController._getClient()) === null || _ConnectionController === void 0 ? void 0 : _ConnectionController.disconnect().catch(console.error));\n      RouterController.reset('Connect');\n      SnackController.showError('A problem occurred while trying initialize authentication');\n    }\n  },\n  async requestSignMessage() {\n    const siwx = OptionsController.state.siwx;\n    const address = CoreHelperUtil.getPlainAddress(ChainController.getActiveCaipAddress());\n    const network = getActiveCaipNetwork();\n    const client = ConnectionController._getClient();\n    if (!siwx) {\n      throw new Error('SIWX is not enabled');\n    }\n    if (!address) {\n      throw new Error('No ActiveCaipAddress found');\n    }\n    if (!network) {\n      throw new Error('No ActiveCaipNetwork or client found');\n    }\n    if (!client) {\n      throw new Error('No ConnectionController client found');\n    }\n    try {\n      const siwxMessage = await siwx.createMessage({\n        chainId: network.caipNetworkId,\n        accountAddress: address\n      });\n      const message = siwxMessage.toString();\n      const connectorId = ConnectorController.getConnectorId(network.chainNamespace);\n      if (connectorId === CommonConstantsUtil.CONNECTOR_ID.AUTH) {\n        RouterController.pushTransactionStack({});\n      }\n      const signature = await client.signMessage(message);\n      await siwx.addSession({\n        data: siwxMessage,\n        message,\n        signature\n      });\n      ChainController.setLastConnectedSIWECaipNetwork(network);\n      ModalController.close();\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SIWX_AUTH_SUCCESS',\n        properties: this.getSIWXEventProperties()\n      });\n    } catch (error) {\n      if (!ModalController.state.open || RouterController.state.view === 'ApproveTransaction') {\n        await ModalController.open({\n          view: 'SIWXSignMessage'\n        });\n      }\n      SnackController.showError('Error signing message');\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'SIWX_AUTH_ERROR',\n        properties: this.getSIWXEventProperties(error)\n      });\n      // eslint-disable-next-line no-console\n      console.error('SWIXUtil:requestSignMessage', error);\n    }\n  },\n  async cancelSignMessage() {\n    try {\n      var _siwx$getRequired;\n      const siwx = this.getSIWX();\n      const isRequired = siwx === null || siwx === void 0 || (_siwx$getRequired = siwx.getRequired) === null || _siwx$getRequired === void 0 ? void 0 : _siwx$getRequired.call(siwx);\n      if (isRequired) {\n        const lastNetwork = ChainController.getLastConnectedSIWECaipNetwork();\n        if (lastNetwork) {\n          const sessions = await (siwx === null || siwx === void 0 ? void 0 : siwx.getSessions(lastNetwork === null || lastNetwork === void 0 ? void 0 : lastNetwork.caipNetworkId, CoreHelperUtil.getPlainAddress(ChainController.getActiveCaipAddress()) || ''));\n          if (sessions && sessions.length > 0) {\n            await ChainController.switchActiveNetwork(lastNetwork);\n          } else {\n            await ConnectionController.disconnect();\n          }\n        } else {\n          await ConnectionController.disconnect();\n        }\n      } else {\n        ModalController.close();\n      }\n      ModalController.close();\n      EventsController.sendEvent({\n        event: 'CLICK_CANCEL_SIWX',\n        type: 'track',\n        properties: this.getSIWXEventProperties()\n      });\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error('SIWXUtil:cancelSignMessage', error);\n    }\n  },\n  async getAllSessions() {\n    const siwx = this.getSIWX();\n    const allRequestedCaipNetworks = ChainController.getAllRequestedCaipNetworks();\n    const sessions = [];\n    await Promise.all(allRequestedCaipNetworks.map(async caipNetwork => {\n      const session = await (siwx === null || siwx === void 0 ? void 0 : siwx.getSessions(caipNetwork.caipNetworkId, CoreHelperUtil.getPlainAddress(ChainController.getActiveCaipAddress()) || ''));\n      if (session) {\n        sessions.push(...session);\n      }\n    }));\n    return sessions;\n  },\n  async getSessions(args) {\n    const siwx = OptionsController.state.siwx;\n    let address = args === null || args === void 0 ? void 0 : args.address;\n    if (!address) {\n      const activeCaipAddress = ChainController.getActiveCaipAddress();\n      address = CoreHelperUtil.getPlainAddress(activeCaipAddress);\n    }\n    let network = args === null || args === void 0 ? void 0 : args.caipNetworkId;\n    if (!network) {\n      const activeCaipNetwork = ChainController.getActiveCaipNetwork();\n      network = activeCaipNetwork === null || activeCaipNetwork === void 0 ? void 0 : activeCaipNetwork.caipNetworkId;\n    }\n    if (!(siwx && address && network)) {\n      return [];\n    }\n    return siwx.getSessions(network, address);\n  },\n  async isSIWXCloseDisabled() {\n    const siwx = this.getSIWX();\n    if (siwx) {\n      const isApproveSignScreen = RouterController.state.view === 'ApproveTransaction';\n      const isSiwxSignMessage = RouterController.state.view === 'SIWXSignMessage';\n      if (isApproveSignScreen || isSiwxSignMessage) {\n        var _siwx$getRequired2;\n        return ((_siwx$getRequired2 = siwx.getRequired) === null || _siwx$getRequired2 === void 0 ? void 0 : _siwx$getRequired2.call(siwx)) && (await this.getSessions()).length === 0;\n      }\n    }\n    return false;\n  },\n  async authConnectorAuthenticate(_ref) {\n    var _OptionsController$st2;\n    let {\n      authConnector,\n      chainId,\n      socialUri,\n      preferredAccountType,\n      chainNamespace\n    } = _ref;\n    const siwx = SIWXUtil.getSIWX();\n    const network = getActiveCaipNetwork();\n    if (!siwx || !chainNamespace.includes(CommonConstantsUtil.CHAIN.EVM) || // Request to input email and sign message when email capture is enabled\n    (_OptionsController$st2 = OptionsController.state.remoteFeatures) !== null && _OptionsController$st2 !== void 0 && _OptionsController$st2.emailCapture) {\n      const result = await authConnector.connect({\n        chainId,\n        socialUri,\n        preferredAccountType\n      });\n      return {\n        address: result.address,\n        chainId: result.chainId,\n        accounts: result.accounts\n      };\n    }\n    const caipNetwork = \"\".concat(chainNamespace, \":\").concat(chainId);\n    const siwxMessage = await siwx.createMessage({\n      chainId: caipNetwork,\n      accountAddress: '<<AccountAddress>>'\n    });\n    // Extract only the serializable data properties for postMessage, toString() is not possible to include in the postMessage\n    const siwxMessageData = {\n      accountAddress: siwxMessage.accountAddress,\n      chainId: siwxMessage.chainId,\n      domain: siwxMessage.domain,\n      uri: siwxMessage.uri,\n      version: siwxMessage.version,\n      nonce: siwxMessage.nonce,\n      notBefore: siwxMessage.notBefore,\n      statement: siwxMessage.statement,\n      resources: siwxMessage.resources,\n      requestId: siwxMessage.requestId,\n      issuedAt: siwxMessage.issuedAt,\n      expirationTime: siwxMessage.expirationTime,\n      serializedMessage: siwxMessage.toString()\n    };\n    const result = await authConnector.connect({\n      chainId,\n      socialUri,\n      siwxMessage: siwxMessageData,\n      preferredAccountType\n    });\n    siwxMessageData.accountAddress = result.address;\n    siwxMessageData.serializedMessage = result.message || '';\n    if (result.signature && result.message) {\n      const promise = SIWXUtil.addEmbeddedWalletSession(siwxMessageData, result.message, result.signature);\n      await promise;\n    }\n    ChainController.setLastConnectedSIWECaipNetwork(network);\n    return {\n      address: result.address,\n      chainId: result.chainId,\n      accounts: result.accounts\n    };\n  },\n  async addEmbeddedWalletSession(siwxMessageData, message, signature) {\n    if (addEmbeddedWalletSessionPromise) {\n      return addEmbeddedWalletSessionPromise;\n    }\n    const siwx = SIWXUtil.getSIWX();\n    if (!siwx) {\n      return Promise.resolve();\n    }\n    addEmbeddedWalletSessionPromise = siwx.addSession({\n      data: siwxMessageData,\n      message,\n      signature\n    }).finally(() => {\n      addEmbeddedWalletSessionPromise = null;\n    });\n    return addEmbeddedWalletSessionPromise;\n  },\n  async universalProviderAuthenticate(_ref2) {\n    var _getActiveCaipNetwork, _result$session$peer$, _result$auths;\n    let {\n      universalProvider,\n      chains,\n      methods\n    } = _ref2;\n    const siwx = SIWXUtil.getSIWX();\n    const network = getActiveCaipNetwork();\n    const namespaces = new Set(chains.map(chain => chain.split(':')[0]));\n    if (!siwx || namespaces.size !== 1 || !namespaces.has('eip155')) {\n      return false;\n    }\n    // Ignores chainId and account address to get other message data\n    const siwxMessage = await siwx.createMessage({\n      chainId: ((_getActiveCaipNetwork = getActiveCaipNetwork()) === null || _getActiveCaipNetwork === void 0 ? void 0 : _getActiveCaipNetwork.caipNetworkId) || '',\n      accountAddress: ''\n    });\n    const result = await universalProvider.authenticate({\n      nonce: siwxMessage.nonce,\n      domain: siwxMessage.domain,\n      uri: siwxMessage.uri,\n      exp: siwxMessage.expirationTime,\n      iat: siwxMessage.issuedAt,\n      nbf: siwxMessage.notBefore,\n      requestId: siwxMessage.requestId,\n      version: siwxMessage.version,\n      resources: siwxMessage.resources,\n      statement: siwxMessage.statement,\n      chainId: siwxMessage.chainId,\n      methods,\n      // The first chainId is what is used for universal provider to build the message\n      chains: [siwxMessage.chainId, ...chains.filter(chain => chain !== siwxMessage.chainId)]\n    });\n    SnackController.showLoading('Authenticating...', {\n      autoClose: false\n    });\n    const walletInfo = _objectSpread(_objectSpread({}, result.session.peer.metadata), {}, {\n      name: result.session.peer.metadata.name,\n      icon: (_result$session$peer$ = result.session.peer.metadata.icons) === null || _result$session$peer$ === void 0 ? void 0 : _result$session$peer$[0],\n      type: 'WALLET_CONNECT'\n    });\n    ChainController.setAccountProp('connectedWalletInfo', walletInfo, Array.from(namespaces)[0]);\n    if (result !== null && result !== void 0 && (_result$auths = result.auths) !== null && _result$auths !== void 0 && _result$auths.length) {\n      const sessions = result.auths.map(cacao => {\n        const message = universalProvider.client.formatAuthMessage({\n          request: cacao.p,\n          iss: cacao.p.iss\n        });\n        return {\n          data: _objectSpread(_objectSpread({}, cacao.p), {}, {\n            accountAddress: cacao.p.iss.split(':').slice(-1).join(''),\n            chainId: cacao.p.iss.split(':').slice(2, 4).join(':'),\n            uri: cacao.p.aud,\n            version: cacao.p.version || siwxMessage.version,\n            expirationTime: cacao.p.exp,\n            issuedAt: cacao.p.iat,\n            notBefore: cacao.p.nbf\n          }),\n          message,\n          signature: cacao.s.s,\n          cacao\n        };\n      });\n      try {\n        await siwx.setSessions(sessions);\n        if (network) {\n          ChainController.setLastConnectedSIWECaipNetwork(network);\n        }\n        EventsController.sendEvent({\n          type: 'track',\n          event: 'SIWX_AUTH_SUCCESS',\n          properties: SIWXUtil.getSIWXEventProperties()\n        });\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('SIWX:universalProviderAuth - failed to set sessions', error);\n        EventsController.sendEvent({\n          type: 'track',\n          event: 'SIWX_AUTH_ERROR',\n          properties: SIWXUtil.getSIWXEventProperties(error)\n        });\n        // eslint-disable-next-line no-console\n        await universalProvider.disconnect().catch(console.error);\n        throw error;\n      } finally {\n        SnackController.hide();\n      }\n    }\n    return true;\n  },\n  getSIWXEventProperties(error) {\n    var _ChainController$stat;\n    const namespace = ChainController.state.activeChain;\n    if (!namespace) {\n      throw new Error('SIWXUtil:getSIWXEventProperties - namespace is required');\n    }\n    return {\n      network: ((_ChainController$stat = ChainController.state.activeCaipNetwork) === null || _ChainController$stat === void 0 ? void 0 : _ChainController$stat.caipNetworkId) || '',\n      isSmartAccount: getPreferredAccountType(namespace) === W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT,\n      message: error ? CoreHelperUtil.parseError(error) : undefined\n    };\n  },\n  async clearSessions() {\n    const siwx = this.getSIWX();\n    if (siwx) {\n      await siwx.setSessions([]);\n    }\n  }\n};","map":{"version":3,"names":["UniversalProvider","ConstantsUtil","CommonConstantsUtil","W3mFrameRpcConstants","ChainController","ConnectionController","ConnectorController","EventsController","ModalController","OptionsController","RouterController","SnackController","getActiveCaipNetwork","getPreferredAccountType","CoreHelperUtil","addEmbeddedWalletSessionPromise","SIWXUtil","getSIWX","state","siwx","initializeIfEnabled","caipAddress","arguments","length","undefined","getActiveCaipAddress","namespace","chainId","address","split","checkIfSupportedNetwork","concat","_OptionsController$st","remoteFeatures","emailCapture","_ChainController$getA","_user$email","user","getAccountData","open","view","data","email","sessions","getSessions","error","_ConnectionController","console","sendEvent","type","event","properties","getSIWXEventProperties","_getClient","disconnect","catch","reset","showError","requestSignMessage","getPlainAddress","network","client","Error","siwxMessage","createMessage","caipNetworkId","accountAddress","message","toString","connectorId","getConnectorId","chainNamespace","CONNECTOR_ID","AUTH","pushTransactionStack","signature","signMessage","addSession","setLastConnectedSIWECaipNetwork","close","cancelSignMessage","_siwx$getRequired","isRequired","getRequired","call","lastNetwork","getLastConnectedSIWECaipNetwork","switchActiveNetwork","getAllSessions","allRequestedCaipNetworks","getAllRequestedCaipNetworks","Promise","all","map","caipNetwork","session","push","args","activeCaipAddress","activeCaipNetwork","isSIWXCloseDisabled","isApproveSignScreen","isSiwxSignMessage","_siwx$getRequired2","authConnectorAuthenticate","_ref","_OptionsController$st2","authConnector","socialUri","preferredAccountType","includes","CHAIN","EVM","result","connect","accounts","siwxMessageData","domain","uri","version","nonce","notBefore","statement","resources","requestId","issuedAt","expirationTime","serializedMessage","promise","addEmbeddedWalletSession","resolve","finally","universalProviderAuthenticate","_ref2","_getActiveCaipNetwork","_result$session$peer$","_result$auths","universalProvider","chains","methods","namespaces","Set","chain","size","has","authenticate","exp","iat","nbf","filter","showLoading","autoClose","walletInfo","_objectSpread","peer","metadata","name","icon","icons","setAccountProp","Array","from","auths","cacao","formatAuthMessage","request","p","iss","slice","join","aud","s","setSessions","hide","_ChainController$stat","activeChain","isSmartAccount","ACCOUNT_TYPES","SMART_ACCOUNT","parseError","clearSessions"],"sources":["../../../../src/utils/SIWXUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}