{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport '@reown/appkit-common';\nimport { EnsUtil } from '../utils/EnsUtil.js';\nimport { StorageUtil } from '../utils/StorageUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { BlockchainApiController } from './BlockchainApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectionController } from './ConnectionController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { RouterController } from './RouterController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  suggestions: [],\n  loading: false\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  async resolveName(name) {\n    try {\n      return await BlockchainApiController.lookupEnsName(name);\n    } catch (e) {\n      const error = e;\n      throw new Error(error?.reasons?.[0]?.description || 'Error resolving name');\n    }\n  },\n  async isNameRegistered(name) {\n    try {\n      await BlockchainApiController.lookupEnsName(name);\n      return true;\n    } catch {\n      return false;\n    }\n  },\n  async getSuggestions(value) {\n    try {\n      state.loading = true;\n      state.suggestions = [];\n      const response = await BlockchainApiController.getEnsNameSuggestions(value);\n      state.suggestions = response.suggestions || [];\n      return state.suggestions;\n    } catch (e) {\n      const errorMessage = EnsController.parseEnsApiError(e, 'Error fetching name suggestions');\n      throw new Error(errorMessage);\n    } finally {\n      state.loading = false;\n    }\n  },\n  async getNamesForAddress(address) {\n    try {\n      const network = ChainController.state.activeCaipNetwork;\n      if (!network) {\n        return [];\n      }\n      const cachedEns = StorageUtil.getEnsFromCacheForAddress(address);\n      if (cachedEns) {\n        return cachedEns;\n      }\n      const response = await BlockchainApiController.reverseLookupEnsName({\n        address\n      });\n      StorageUtil.updateEnsCache({\n        address,\n        ens: response,\n        timestamp: Date.now()\n      });\n      return response;\n    } catch (e) {\n      const errorMessage = EnsController.parseEnsApiError(e, 'Error fetching names for address');\n      throw new Error(errorMessage);\n    }\n  },\n  async registerName(name) {\n    const network = ChainController.state.activeCaipNetwork;\n    const address = ChainController.getAccountData(network?.chainNamespace)?.address;\n    const emailConnector = ConnectorController.getAuthConnector();\n    if (!network) {\n      throw new Error('Network not found');\n    }\n    if (!address || !emailConnector) {\n      throw new Error('Address or auth connector not found');\n    }\n    state.loading = true;\n    try {\n      const message = JSON.stringify({\n        name,\n        attributes: {},\n        // Unix timestamp\n        timestamp: Math.floor(Date.now() / 1000)\n      });\n      RouterController.pushTransactionStack({\n        onCancel() {\n          RouterController.replace('RegisterAccountName');\n        }\n      });\n      const signature = await ConnectionController.signMessage(message);\n      state.loading = false;\n      const networkId = network.id;\n      if (!networkId) {\n        throw new Error('Network not found');\n      }\n      const coinType = EnsUtil.convertEVMChainIdToCoinType(Number(networkId));\n      await BlockchainApiController.registerEnsName({\n        coinType,\n        address: address,\n        signature: signature,\n        message\n      });\n      ChainController.setAccountProp('profileName', name, network.chainNamespace);\n      StorageUtil.updateEnsCache({\n        address,\n        ens: [{\n          name,\n          registered_at: new Date().toISOString(),\n          updated_at: undefined,\n          addresses: {},\n          attributes: []\n        }],\n        timestamp: Date.now()\n      });\n      RouterController.replace('RegisterAccountNameSuccess');\n    } catch (e) {\n      const errorMessage = EnsController.parseEnsApiError(e, `Error registering name ${name}`);\n      RouterController.replace('RegisterAccountName');\n      throw new Error(errorMessage);\n    } finally {\n      state.loading = false;\n    }\n  },\n  validateName(name) {\n    return /^[a-zA-Z0-9-]{4,}$/u.test(name);\n  },\n  parseEnsApiError(error, defaultError) {\n    const ensError = error;\n    return ensError?.reasons?.[0]?.description || defaultError;\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const EnsController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","EnsUtil","StorageUtil","withErrorBoundary","BlockchainApiController","ChainController","ConnectionController","ConnectorController","RouterController","state","suggestions","loading","controller","callback","key","resolveName","name","lookupEnsName","e","error","Error","reasons","description","isNameRegistered","getSuggestions","value","response","getEnsNameSuggestions","errorMessage","EnsController","parseEnsApiError","getNamesForAddress","address","network","activeCaipNetwork","cachedEns","getEnsFromCacheForAddress","reverseLookupEnsName","updateEnsCache","ens","timestamp","Date","now","registerName","getAccountData","chainNamespace","emailConnector","getAuthConnector","message","JSON","stringify","attributes","Math","floor","pushTransactionStack","onCancel","replace","signature","signMessage","networkId","id","coinType","convertEVMChainIdToCoinType","Number","registerEnsName","setAccountProp","registered_at","toISOString","updated_at","undefined","addresses","validateName","test","defaultError","ensError"],"sources":["../../../../src/controllers/EnsController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}