{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport '@reown/appkit-common';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { NetworkUtil } from '../utils/NetworkUtil.js';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { ApiController } from './ApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectionController } from './ConnectionController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { EventsController } from './EventsController.js';\nimport { OptionsController } from './OptionsController.js';\nimport { PublicStateController } from './PublicStateController.js';\nimport { RouterController } from './RouterController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  loading: false,\n  loadingNamespaceMap: new Map(),\n  open: false,\n  shake: false,\n  namespace: undefined\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  async open(options) {\n    var _ChainController$getA;\n    const namespace = options === null || options === void 0 ? void 0 : options.namespace;\n    const currentNamespace = ChainController.state.activeChain;\n    const isSwitchingNamespace = namespace && namespace !== currentNamespace;\n    const caipAddress = (_ChainController$getA = ChainController.getAccountData(options === null || options === void 0 ? void 0 : options.namespace)) === null || _ChainController$getA === void 0 ? void 0 : _ChainController$getA.caipAddress;\n    const hasNoAdapters = ChainController.state.noAdapters;\n    if (ConnectionController.state.wcBasic) {\n      // No need to add an await here if we are use basic\n      ApiController.prefetch({\n        fetchNetworkImages: false,\n        fetchConnectorImages: false,\n        fetchWalletRanks: false\n      });\n    } else {\n      await ApiController.prefetch();\n    }\n    ConnectorController.setFilterByNamespace(options === null || options === void 0 ? void 0 : options.namespace);\n    ModalController.setLoading(true, namespace);\n    if (namespace && isSwitchingNamespace) {\n      var _ChainController$getN;\n      const namespaceNetwork = ((_ChainController$getN = ChainController.getNetworkData(namespace)) === null || _ChainController$getN === void 0 ? void 0 : _ChainController$getN.caipNetwork) || ChainController.getRequestedCaipNetworks(namespace)[0];\n      if (namespaceNetwork) {\n        if (hasNoAdapters) {\n          await ChainController.switchActiveNetwork(namespaceNetwork);\n          RouterController.push('ConnectingWalletConnectBasic');\n        } else {\n          NetworkUtil.onSwitchNetwork({\n            network: namespaceNetwork,\n            ignoreSwitchConfirmation: true\n          });\n        }\n      }\n    } else if (OptionsController.state.manualWCControl || hasNoAdapters && !caipAddress) {\n      if (CoreHelperUtil.isMobile()) {\n        RouterController.reset('AllWallets');\n      } else {\n        RouterController.reset('ConnectingWalletConnectBasic');\n      }\n    } else if (options !== null && options !== void 0 && options.view) {\n      RouterController.reset(options.view, options.data);\n    } else if (caipAddress) {\n      RouterController.reset('Account');\n    } else {\n      RouterController.reset('Connect');\n    }\n    state.open = true;\n    PublicStateController.set({\n      open: true\n    });\n    EventsController.sendEvent({\n      type: 'track',\n      event: 'MODAL_OPEN',\n      properties: {\n        connected: Boolean(caipAddress)\n      }\n    });\n  },\n  close() {\n    const isEmbeddedEnabled = OptionsController.state.enableEmbedded;\n    const isConnected = Boolean(ChainController.state.activeCaipAddress);\n    // Only send the event if the modal is open and is about to be closed\n    if (state.open) {\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'MODAL_CLOSE',\n        properties: {\n          connected: isConnected\n        }\n      });\n    }\n    state.open = false;\n    RouterController.reset('Connect');\n    ModalController.clearLoading();\n    if (isEmbeddedEnabled) {\n      if (isConnected) {\n        RouterController.replace('Account');\n      } else {\n        RouterController.push('Connect');\n      }\n    } else {\n      PublicStateController.set({\n        open: false\n      });\n    }\n    ConnectionController.resetUri();\n  },\n  setLoading(loading, namespace) {\n    if (namespace) {\n      state.loadingNamespaceMap.set(namespace, loading);\n    }\n    state.loading = loading;\n    PublicStateController.set({\n      loading\n    });\n  },\n  clearLoading() {\n    state.loadingNamespaceMap.clear();\n    state.loading = false;\n    PublicStateController.set({\n      loading: false\n    });\n  },\n  shake() {\n    if (state.shake) {\n      return;\n    }\n    state.shake = true;\n    setTimeout(() => {\n      state.shake = false;\n    }, 500);\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const ModalController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","CoreHelperUtil","NetworkUtil","withErrorBoundary","ApiController","ChainController","ConnectionController","ConnectorController","EventsController","OptionsController","PublicStateController","RouterController","state","loading","loadingNamespaceMap","Map","open","shake","namespace","undefined","controller","callback","key","options","_ChainController$getA","currentNamespace","activeChain","isSwitchingNamespace","caipAddress","getAccountData","hasNoAdapters","noAdapters","wcBasic","prefetch","fetchNetworkImages","fetchConnectorImages","fetchWalletRanks","setFilterByNamespace","ModalController","setLoading","_ChainController$getN","namespaceNetwork","getNetworkData","caipNetwork","getRequestedCaipNetworks","switchActiveNetwork","push","onSwitchNetwork","network","ignoreSwitchConfirmation","manualWCControl","isMobile","reset","view","data","set","sendEvent","type","event","properties","connected","Boolean","close","isEmbeddedEnabled","enableEmbedded","isConnected","activeCaipAddress","clearLoading","replace","resetUri","clear","setTimeout"],"sources":["../../../../src/controllers/ModalController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}